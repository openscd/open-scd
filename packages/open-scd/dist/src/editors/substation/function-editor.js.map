{"version":3,"file":"function-editor.js","sourceRoot":"","sources":["../../../../src/editors/substation/function-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  html,\n  LitElement,\n  TemplateResult,\n  property,\n  customElement,\n  state,\n  css,\n  query,\n} from 'lit-element';\n\nimport '../../action-pane.js';\nimport './sub-function-editor.js';\nimport './general-equipment-editor.js';\nimport {\n  getChildElementsByTagName,\n  newActionEvent,\n  newWizardEvent,\n  SCLTag,\n  tags,\n} from '../../foundation.js';\nimport { translate } from 'lit-translate';\nimport { emptyWizard, wizards } from '../../wizards/wizard-library.js';\nimport { Menu } from '@material/mwc-menu';\nimport { ListItem } from '@material/mwc-list/mwc-list-item';\nimport { IconButton } from '@material/mwc-icon-button';\nimport { renderGeneralEquipment } from './foundation.js';\n\nfunction childTags(element: Element | null | undefined): SCLTag[] {\n  if (!element) return [];\n\n  return tags[<SCLTag>element.tagName].children.filter(\n    child => wizards[child].create !== emptyWizard\n  );\n}\n\n/** Pane rendering `Function` element with its children */\n@customElement('function-editor')\nexport class FunctionEditor extends LitElement {\n  /** The document being edited as provided to editor by [[`Zeroline`]]. */\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  @property({type: Number})\n  editCount = -1;\n  /** The edited `Function` element */\n  @property({ attribute: false })\n  element!: Element;\n\n  @property({ type: Boolean })\n  showfunctions = false;\n\n  @state()\n  private get header(): string {\n    const name = this.element.getAttribute('name');\n    const desc = this.element.getAttribute('desc');\n    const type = this.element.getAttribute('type');\n\n    return `${name}${desc ? ` - ${desc}` : ''}${type ? ` (${type})` : ''}`;\n  }\n\n  @query('mwc-menu') addMenu!: Menu;\n  @query('mwc-icon-button[icon=\"playlist_add\"]') addButton!: IconButton;\n\n  private openEditWizard(): void {\n    const wizard = wizards['Function'].edit(this.element);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  remove(): void {\n    if (this.element.parentElement)\n      this.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent: this.element.parentElement,\n            element: this.element,\n          },\n        })\n      );\n  }\n\n  private openCreateWizard(tagName: string): void {\n    const wizard = wizards[<SCLTag>tagName].create(this.element!);\n\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  updated(): void {\n    this.addMenu.anchor = <HTMLElement>this.addButton;\n  }\n\n  private renderLNodes(): TemplateResult {\n    const lNodes = getChildElementsByTagName(this.element, 'LNode');\n\n    return lNodes.length\n      ? html`<div class=\"container lnode\">\n          ${lNodes.map(\n            lNode =>\n              html`<l-node-editor\n                .editCount=${this.editCount} .doc=${this.doc}\n                .element=${lNode}\n              ></l-node-editor>`\n          )}\n        </div>`\n      : html``;\n  }\n\n  private renderSubFunctions(): TemplateResult {\n    const subfunctions = getChildElementsByTagName(this.element, 'SubFunction');\n    return html` ${subfunctions.map(\n      subFunction =>\n        html`<sub-function-editor\n          .editCount=${this.editCount} .doc=${this.doc}\n          .element=${subFunction}\n          ?showfunctions=${this.showfunctions}\n        ></sub-function-editor>`\n    )}`;\n  }\n\n  private renderAddButtons(): TemplateResult[] {\n    return childTags(this.element).map(\n      child =>\n        html`<mwc-list-item value=\"${child}\"\n          ><span>${child}</span></mwc-list-item\n        >`\n    );\n  }\n\n  render(): TemplateResult {\n    return html`<action-pane\n      label=\"${this.header}\"\n      icon=\"functions\"\n      secondary\n      highlighted\n      ><abbr slot=\"action\" title=\"${translate('edit')}\">\n        <mwc-icon-button\n          icon=\"edit\"\n          @click=${() => this.openEditWizard()}\n        ></mwc-icon-button> </abbr\n      ><abbr slot=\"action\" title=\"${translate('remove')}\">\n        <mwc-icon-button\n          icon=\"delete\"\n          @click=${() => this.remove()}\n        ></mwc-icon-button> </abbr\n      ><abbr\n        slot=\"action\"\n        style=\"position:relative;\"\n        title=\"${translate('add')}\"\n      >\n        <mwc-icon-button\n          icon=\"playlist_add\"\n          @click=${() => (this.addMenu.open = true)}\n        ></mwc-icon-button\n        ><mwc-menu\n          corner=\"BOTTOM_RIGHT\"\n          menuCorner=\"END\"\n          @action=${(e: Event) => {\n            const tagName = (<ListItem>(<Menu>e.target).selected).value;\n            this.openCreateWizard(tagName);\n          }}\n          >${this.renderAddButtons()}</mwc-menu\n        >\n      </abbr>\n      ${renderGeneralEquipment(this.doc, this.element, this.showfunctions)}\n      ${this.renderLNodes()}${this.renderSubFunctions()}</action-pane\n    >`;\n  }\n\n  static styles = css`\n    abbr {\n      text-decoration: none;\n      border-bottom: none;\n    }\n\n    .container.lnode {\n      display: grid;\n      grid-gap: 12px;\n      padding: 8px 12px 16px;\n      box-sizing: border-box;\n      grid-template-columns: repeat(auto-fit, minmax(64px, auto));\n    }\n  `;\n}\n"]}