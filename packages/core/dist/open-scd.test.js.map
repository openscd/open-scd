{"version":3,"file":"open-scd.test.js","sourceRoot":"","sources":["../open-scd.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { visualDiff } from '@web/test-runner-visual-regression';\n\nimport type { IconButton } from '@material/mwc-icon-button';\nimport type { ListItem } from '@material/mwc-list/mwc-list-item.js';\n\nimport './open-scd.js';\nimport { expect } from '@open-wc/testing';\nimport type { OpenSCD } from './open-scd.js';\n\nimport { Edit, newEditEvent, newOpenEvent } from './foundation.js';\nimport { allLocales } from './locales.js';\n\nconst factor = window.process && process.env.CI ? 4 : 2;\n\nfunction timeout(ms: number) {\n  return new Promise(res => setTimeout(res, ms * factor));\n}\n\nmocha.timeout(2000 * factor);\n\nconst doc = new DOMParser().parseFromString(\n  `<testdoc></testdoc>`,\n  'application/xml'\n);\n\nlet editor: OpenSCD;\nbeforeEach(() => {\n  editor = document.createElement('open-scd');\n  document.body.prepend(editor);\n});\n\nafterEach(() => {\n  editor.remove();\n});\n\nit(`changes locales on attribute change`, async () => {\n  editor.setAttribute('locale', 'invalid');\n  await editor.updateComplete;\n\n  expect(editor).to.have.property('locale', 'en');\n\n  editor.setAttribute('locale', 'de');\n  await editor.updateComplete;\n\n  await timeout(180);\n  await editor.updateComplete;\n  expect(editor).to.have.property('locale', 'de');\n});\n\nallLocales.forEach(lang =>\n  describe(`translated to ${lang}`, () => {\n    beforeEach(async () => {\n      editor.setAttribute('locale', lang);\n      await editor.updateComplete;\n      expect(editor).to.have.property('locale', lang);\n    });\n\n    it(`displays a top app bar`, async () => {\n      await editor.updateComplete;\n      await timeout(20);\n      await visualDiff(editor, `app-bar-${lang}`);\n    });\n\n    it(`displays a menu on button click`, async () => {\n      await editor.updateComplete;\n      editor.shadowRoot\n        ?.querySelector<IconButton>('mwc-icon-button[icon=\"menu\"]')\n        ?.click();\n\n      await editor.updateComplete;\n      await timeout(200);\n      await visualDiff(editor, `menu-drawer-${lang}`);\n    });\n\n    it(`displays a current document title`, async () => {\n      await editor.updateComplete;\n\n      editor.dispatchEvent(newOpenEvent(doc, 'test.xml'));\n      await editor.updateComplete;\n      await timeout(20);\n      await visualDiff(editor, `document-name-${lang}`);\n    });\n\n    it(`shows a log screen`, async () => {\n      await editor.updateComplete;\n      editor.shadowRoot\n        ?.querySelector<IconButton>('mwc-icon-button[icon=\"menu\"]')\n        ?.click();\n      editor.shadowRoot\n        ?.querySelector<ListItem>('mwc-list-item:last-child')\n        ?.click();\n\n      await editor.updateComplete;\n      await timeout(200);\n      await visualDiff(editor, `log-screen-${lang}`);\n    });\n\n    it(`shows log entries`, async () => {\n      const parent = doc.documentElement;\n      const node = doc.createElement('test');\n      const reference = doc.querySelector('testchild');\n      editor.dispatchEvent(newEditEvent({ parent, node, reference }));\n      editor.dispatchEvent(newEditEvent({ parent, node, reference: null }));\n\n      const element = doc.querySelector('testdoc')!;\n      editor.dispatchEvent(\n        newEditEvent({\n          element,\n          attributes: {\n            name: 'A2',\n            desc: null,\n            'myns:attr': {\n              value: 'namespaced value',\n              namespaceURI: 'http://example.org/myns',\n            },\n          },\n        })\n      );\n\n      editor.dispatchEvent(newEditEvent({ node }));\n      editor.dispatchEvent(\n        newEditEvent([\n          { parent, node, reference },\n          { parent, node, reference: null },\n          'invalid edit' as unknown as Edit,\n        ])\n      );\n\n      await editor.updateComplete;\n      editor.shadowRoot\n        ?.querySelector<IconButton>('mwc-icon-button[icon=\"history\"]')\n        ?.click();\n\n      await editor.updateComplete;\n      await timeout(200);\n      await visualDiff(editor, `log-entries-${lang}`);\n\n      editor.shadowRoot\n        ?.querySelector<IconButton>('mwc-icon-button[icon=\"undo\"]')\n        ?.click();\n      await editor.updateComplete;\n      editor.shadowRoot\n        ?.querySelector<IconButton>('mwc-icon-button[icon=\"undo\"]')\n        ?.click();\n      await editor.updateComplete;\n      editor.shadowRoot\n        ?.querySelector<IconButton>('mwc-icon-button[icon=\"undo\"]')\n        ?.click();\n      await editor.updateComplete;\n      editor.shadowRoot\n        ?.querySelector<IconButton>('mwc-icon-button[icon=\"undo\"]')\n        ?.click();\n      await editor.updateComplete;\n      editor.dispatchEvent(\n        new KeyboardEvent('keydown', {\n          key: 'z',\n          ctrlKey: true,\n          bubbles: true,\n          composed: true,\n        })\n      );\n      editor.dispatchEvent(\n        new KeyboardEvent('keydown', {\n          key: 'y',\n          ctrlKey: false,\n          bubbles: true,\n          composed: true,\n        })\n      );\n      editor.dispatchEvent(\n        new KeyboardEvent('keydown', {\n          key: 'X',\n          ctrlKey: true,\n          bubbles: true,\n          composed: true,\n        })\n      );\n      await editor.updateComplete;\n\n      await timeout(20);\n      await visualDiff(editor, `log-entries-undone-${lang}`);\n\n      editor.shadowRoot\n        ?.querySelector<IconButton>('mwc-icon-button[icon=\"redo\"]')\n        ?.click();\n      await editor.updateComplete;\n      editor.shadowRoot\n        ?.querySelector<IconButton>('mwc-icon-button[icon=\"redo\"]')\n        ?.click();\n      await editor.updateComplete;\n\n      await timeout(20);\n      await visualDiff(editor, `log-entries-redone-${lang}`);\n    });\n\n    describe('with menu plugins loaded', () => {\n      beforeEach(async () => {\n        editor.plugins = {\n          editor: [],\n          menu: [\n            {\n              name: 'Test Menu Plugin',\n              translations: { de: 'Test Menü Erweiterung' },\n              src: 'data:text/javascript;charset=utf-8,export%20default%20class%20TestPlugin%20extends%20HTMLElement%20%7B%0D%0A%20%20async%20run%28%29%20%7B%0D%0A%20%20%20%20return%20false%3B%0D%0A%20%20%7D%0D%0A%7D',\n              icon: 'android',\n              active: true,\n              requireDoc: true,\n            },\n            {\n              name: 'Test Menu Plugin 2',\n              src: 'data:text/javascript;charset=utf-8,export%20default%20class%20TestPlugin%20extends%20HTMLElement%20%7B%0D%0A%20%20async%20run%28%29%20%7B%0D%0A%20%20%20%20this.dispatchEvent%28new%20CustomEvent%28%27oscd-open%27%2C%20%7Bdetail%3A%20%7BdocName%3A%20%27testDoc%27%2C%20doc%3A%20window.document%7D%2C%20bubbles%3A%20true%2C%20composed%3A%20true%7D%29%29%3B%0D%0A%20%20%7D%0D%0A%7D',\n              icon: 'polymer',\n              active: true,\n              requireDoc: false,\n            },\n            {\n              name: 'Test Menu Plugin 3',\n              translations: { de: 'Test Menü Erweiterung 3' },\n              src: 'data:text/javascript;charset=utf-8,export%20default%20class%20BrokenTestPlugin%20extends%20HTMLElement%20%7B%0D%0A%20%20%2F%2F%20oh%20NO%21%20There%27s%20no%20run%20method%21%0D%0A%7D',\n              icon: 'dry',\n              active: true,\n              requireDoc: false,\n            },\n            {\n              name: 'Test Menu Plugin 4',\n              translations: { de: 'Test Menü Erweiterung 4' },\n              src: 'data:text/javascript;charset=utf-8,export%20default%20class%20BrokenTestPlugin%20extends%20HTMLElement%20%7B%0D%0A%20%20%2F%2F%20oh%20no%21%20There%27s%20no%20run%20method%21%0D%0A%7D',\n              icon: 'translate',\n              active: false,\n              requireDoc: true,\n            },\n          ],\n        };\n        await editor.updateComplete;\n      });\n\n      it('displays menu plugins in the menu', async () => {\n        editor.shadowRoot\n          ?.querySelector<IconButton>('mwc-icon-button[icon=\"menu\"]')\n          ?.click();\n\n        await editor.updateComplete;\n        await timeout(200);\n        await visualDiff(editor, `menu-plugins-${lang}`);\n      });\n\n      it('triggers menu plugins on menu entry click', async () => {\n        editor.shadowRoot\n          ?.querySelector<IconButton>('mwc-icon-button[icon=\"menu\"]')\n          ?.click();\n        await editor.updateComplete;\n        await timeout(200);\n        editor.menuUI\n          ?.querySelector<IconButton>('mwc-list-item:nth-of-type(2)')\n          ?.click();\n        editor.menuUI\n          ?.querySelector<IconButton>('mwc-list-item:nth-of-type(3)')\n          ?.click();\n\n        await editor.updateComplete;\n        await timeout(200);\n        expect(editor.docName).to.equal('testDoc');\n        await editor.updateComplete;\n        await visualDiff(editor, `menu-plugins-triggered-${lang}`);\n      });\n    });\n\n    describe('with editor plugins loaded', () => {\n      beforeEach(async () => {\n        editor.plugins = {\n          menu: [],\n          editor: [\n            {\n              name: 'Test Editor Plugin',\n              translations: { de: 'Test Editor Erweiterung' },\n              src: 'data:text/javascript;charset=utf-8,export%20default%20class%20TestEditorPlugin%20extends%20HTMLElement%20%7B%0D%0A%20%20constructor%20%28%29%20%7B%20super%28%29%3B%20this.innerHTML%20%3D%20%60%3Cp%3ETest%20Editor%20Plugin%3C%2Fp%3E%60%3B%20%7D%0D%0A%7D',\n              icon: 'edit',\n              active: true,\n              requireDoc: true,\n            },\n            {\n              name: 'Test Editor Plugin 2',\n              src: 'data:text/javascript;charset=utf-8,export%20default%20class%20TestEditorPlugin2%20extends%20HTMLElement%20%7B%0D%0A%20%20constructor%20%28%29%20%7B%20super%28%29%3B%20this.innerHTML%20%3D%20%60%3Cp%3ETest%20Editor%20Plugin%202%3C%2Fp%3E%60%3B%20%7D%0D%0A%7D',\n              icon: 'android',\n              active: true,\n              requireDoc: false,\n            },\n            {\n              name: 'Test Editor Plugin 3',\n              translations: { de: 'Test Editor Erweiterung 3' },\n              src: 'data:text/javascript;charset=utf-8,export%20default%20class%20EditorPluginTest3%20extends%20HTMLElement%20%7B%0D%0A%20%20%20%20constructor%20%28%29%20%7B%0D%0A%09%2F%2F%20Create%20a%20shadow%20root%0D%0A%09this.attachShadow%28%7B%20mode%3A%20%22open%22%20%7D%29%3B%20%2F%2F%20sets%20and%20returns%20%27this.shadowRoot%27%0D%0A%0D%0A%09const%20info%20%3D%20wrapper.appendChild%28document.createElement%28%22span%22%29%29%3B%0D%0A%09info.setAttribute%28%22class%22%2C%20%22info%22%29%3B%0D%0A%09%2F%2F%20Take%20attribute%20content%20and%20put%20it%20inside%20the%20info%20span%0D%0A%09info.textContent%20%3D%20this.getAttribute%28%22docName%22%29%20%7C%7C%20%27no%20docName%20Test3%27%3B%0D%0A%0D%0A%09%2F%2F%20attach%20the%20created%20elements%20to%20the%20shadow%20DOM%0D%0A%09this.shadowRoot.append%28style%2C%20info%29%3B%0D%0A%20%20%20%20%7D%0D%0A%7D%3B',\n              icon: 'polymer',\n              active: true,\n              requireDoc: false,\n            },\n            {\n              name: 'Test Editor Plugin 4',\n              translations: { de: 'Test Editor Erweiterung 4' },\n              src: 'data:text/javascript;charset=utf-8,export%20default%20class%20TestEditorPlugin4%20extends%20HTMLElement%20%7B%0D%0A%20%20constructor%20%28%29%20%7B%20super%28%29%3B%20this.innerHTML%20%3D%20%60%3Cp%3ETest%20Editor%20Plugin%204%3C%2Fp%3E%60%3B%20%7D%0D%0A%7D',\n              icon: 'edit',\n              active: false,\n              requireDoc: true,\n            },\n          ],\n        };\n        await editor.updateComplete;\n      });\n\n      it('displays editor plugins', async () => {\n        await visualDiff(editor, `editor-plugins-${lang}`);\n      });\n\n      it('displays more tabs with a doc loaded', async () => {\n        editor.dispatchEvent(newOpenEvent(doc, 'test.xml'));\n        await editor.updateComplete;\n        await visualDiff(editor, `editor-plugins-with-doc-${lang}`);\n      });\n\n      it('changes active editor plugin on tab click', async () => {\n        editor.shadowRoot\n          ?.querySelector<IconButton>('mwc-tab:nth-of-type(2)')\n          ?.click();\n\n        await editor.updateComplete;\n        await timeout(120);\n        await visualDiff(editor, `editor-plugins-selected-${lang}`);\n      });\n    });\n  })\n);\n"]}