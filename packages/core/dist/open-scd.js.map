{"version":3,"file":"open-scd.js","sourceRoot":"","sources":["../open-scd.ts"],"names":[],"mappings":";;AAAA,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE,UAAU,EAAE,OAAO,EAAkB,MAAM,KAAK,CAAC;AACrE,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAC;AAC1E,OAAO,EAAE,IAAI,IAAI,UAAU,EAAE,YAAY,EAAE,MAAM,oBAAoB,CAAC;AAEtE,OAAO,EAAE,qBAAqB,EAAE,SAAS,EAAE,GAAG,EAAE,GAAG,EAAE,MAAM,eAAe,CAAC;AAE3E,OAAO,EAAE,MAAM,EAAE,MAAM,sBAAsB,CAAC;AAE9C,OAAO,sBAAsB,CAAC;AAC9B,OAAO,sBAAsB,CAAC;AAC9B,OAAO,sBAAsB,CAAC;AAC9B,OAAO,oBAAoB,CAAC;AAC5B,OAAO,2BAA2B,CAAC;AACnC,OAAO,oBAAoB,CAAC;AAC5B,OAAO,uBAAuB,CAAC;AAC/B,OAAO,iCAAiC,CAAC;AAKzC,OAAO,EAAc,YAAY,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAEvE,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,iBAAiB,CAAC;AAE1E,OAAO,uBAAuB,CAAC;AAC/B,OAAO,EAAE,OAAO,EAAY,MAAM,uBAAuB,CAAC;AAC1D,OAAO,EAAE,QAAQ,EAAU,SAAS,EAAE,MAAM,sBAAsB,CAAC;AAEnE,OAAO,EAAE,QAAQ,EAAE,MAAM,sBAAsB,CAAC;AAChD,OAAO,EAAE,OAAO,EAAE,MAAM,uBAAuB,CAAC;AAehD,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG,qBAAqB,CAAC;IACrD,YAAY;IACZ,aAAa;IACb,UAAU,EAAE,MAAM,CAAC,EAAE,CACnB,MAAM,CAAC,IAAI,GAAG,CAAC,WAAW,MAAM,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;CAChE,CAAC,CAAC;AAEH,SAAS,QAAQ,CAAC,EAAE,IAAI,EAAE,IAAI,EAAY;IACxC,IAAI,MAAM,GAAG,GAAG,CAAC,gCAAgC,CAAC,CAAC;IACnD,IAAI,SAAS,CAAC,IAAI,CAAC;QAAE,MAAM,GAAG,GAAG,CAAC,GAAG,CAAA,KAAK,IAAI,CAAC,MAAM,gBAAgB,CAAC,CAAC;IACvE,IAAI,QAAQ,CAAC,IAAI,CAAC;QAChB,IAAI,QAAQ,CAAC,IAAI,CAAC;YAChB,MAAM,GAAG,GAAG,CAAC,GAAG,CAAA,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,aAAa,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;;YAE1E,MAAM,GAAG,GAAG,CACV,GAAG,CAAA,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,kBAAkB,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CACjE,CAAC;IACN,IAAI,QAAQ,CAAC,IAAI,CAAC;QAAE,MAAM,GAAG,GAAG,CAAC,GAAG,CAAA,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,UAAU,CAAC,CAAC;IACrE,IAAI,QAAQ,CAAC,IAAI,CAAC;QAAE,MAAM,GAAG,GAAG,CAAC,GAAG,CAAA,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,UAAU,CAAC,CAAC;IACvE,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,SAAS,gBAAgB,CACvB,OAAgB,EAChB,IAAI,GAAG,aAAa;IAEpB,OAAO,IAAI,CAAA;YACD,IAAI;YACJ,OAAO,CAAC,IAAI;aACX,OAAO,CAAC,OAAO,EAAE;gBACd,OAAO,CAAC,UAAU,EAAE;aACvB,OAAO,CAAC,MAAM;sBACL,CAAC;AACvB,CAAC;AAED,SAAS,cAAc,CAAC,OAAgB;IACtC,OAAO,IAAI,CAAA;8CACiC,OAAO,CAAC,UAAU,EAAE;kCAChC,OAAO,CAAC,IAAI;cAChC,OAAO,CAAC,OAAO,EAAE;;GAE5B,CAAC;AACJ,CAAC;AAED;;;;;;;;GAQG;AAGH,IAAa,OAAO,GAApB,MAAa,OAAQ,SAAQ,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;IAyHxD;QACE,KAAK,EAAE,CAAC;QArGF,gBAAW,GAAG,CAAC,CAAC;QAOhB,aAAQ,GAGZ;YACF,IAAI,EAAE;gBACJ,IAAI,EAAE,MAAM;gBACZ,OAAO,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC;gBAC1B,MAAM,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE;gBACzB,UAAU,EAAE,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO;aAChC;YACD,IAAI,EAAE;gBACJ,IAAI,EAAE,MAAM;gBACZ,OAAO,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC;gBAC1B,MAAM,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE;gBACzB,UAAU,EAAE,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO;aAChC;YACD,GAAG,EAAE;gBACH,IAAI,EAAE,SAAS;gBACf,OAAO,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,iBAAiB,CAAC;gBACrC,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;gBACxE,UAAU,EAAE,GAAG,EAAE,CAAC,KAAK;aACxB;YACD,IAAI,EAAE;gBACJ,IAAI,EAAE,MAAM;gBACZ,OAAO,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC;gBAC1B,MAAM,EAAE,KAAK,IAAI,EAAE;oBACjB,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;oBACrC,MAAM,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC;oBACjC,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI;wBAAE,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,UAAU,CAAE,CAAC,KAAK,EAAE,CAAC;gBACvE,CAAC;gBACD,UAAU,EAAE,GAAG,EAAE,CAAC,KAAK;aACxB;SACF,CAAC;QAEF,2BAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAC;QA4C/D,YAAO,GAAwC;YACrD,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM;YAC5B,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM;YAC5B,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM;YAC5B,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM;YAC5B,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM;SAC5B,CAAC;QAWA,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrD,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;IAC5D,CAAC;IArHD,IAAI,MAAM;QACR,OAAO,SAAS,EAAe,CAAC;IAClC,CAAC;IAED,IAAI,MAAM,CAAC,GAAc;QACvB,IAAI;YACF,SAAS,CAAC,GAAG,CAAC,CAAC;SAChB;QAAC,WAAM;YACN,wCAAwC;SACzC;IACH,CAAC;IAMD,IAAI,MAAM;;QACR,OAAO,MAAA,MAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,0CAAE,OAAO,mCAAI,EAAE,CAAC;IACvD,CAAC;IAuCD,IAAI,IAAI;;QACN,OAAO,CAAsB,MAAA,IAAI,CAAC,OAAO,CAAC,IAAI,0CAC1C,GAAG,CAAC,CAAC,MAAM,EAA8B,EAAE,CAC3C,MAAM,CAAC,MAAM;YACX,CAAC,CAAC;gBACE,IAAI,EAAE,MAAM,CAAC,IAAI;gBACjB,OAAO,EAAE,GAAG,EAAE;;oBACZ,OAAA,CAAA,MAAA,MAAM,CAAC,YAAY,0CACjB,IAAI,CAAC,MAAsC,CAC5C,KAAI,MAAM,CAAC,IAAI,CAAA;iBAAA;gBAClB,UAAU,EAAE,GAAG,EAAE,WAAC,OAAA,MAAA,CAAC,MAAM,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,mCAAI,KAAK,CAAA,EAAA;gBAC/D,OAAO,EAAE,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC;gBAC9B,MAAM,EAAE,GAAG,EAAE;;oBACX,OAAA,MAAA,MAAA,IAAI,CAAC,UAAW,CAAC,aAAa,CAE5B,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,CAAE,EAAC,GAAG,kDAAI,CAAA;iBAAA;aACpC;YACH,CAAC,CAAC,SAAS,EAEd,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,SAAS,CAAE,CAAA,CAAC,MAAM,CAAC,uBAAA,IAAI,wBAAS,CAAC,CAAC;IACzD,CAAC;IAGD,IAAI,OAAO;;QACT,OAAyB,MAAA,IAAI,CAAC,OAAO,CAAC,MAAM,0CACxC,GAAG,CAAC,CAAC,MAAM,EAA8B,EAAE,CAC3C,MAAM,CAAC,MAAM;YACX,CAAC,CAAC;gBACE,IAAI,EAAE,MAAM,CAAC,IAAI;gBACjB,OAAO,EAAE,GAAG,EAAE;;oBACZ,OAAA,CAAA,MAAA,MAAM,CAAC,YAAY,0CACjB,IAAI,CAAC,MAAsC,CAC5C,KAAI,MAAM,CAAC,IAAI,CAAA;iBAAA;gBAClB,UAAU,EAAE,GAAG,EAAE,WAAC,OAAA,MAAA,CAAC,MAAM,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,mCAAI,KAAK,CAAA,EAAA;gBAC/D,OAAO,EAAE,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC;aAC/B;YACH,CAAC,CAAC,SAAS,EAEd,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,SAAS,CAAC,CAAC;IAClC,CAAC;IAUO,cAAc,CAAC,CAAgB;QACrC,IAAI,CAAC,CAAC,CAAC,OAAO;YAAE,OAAO;QACvB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,GAAG,CAAC;YAAE,OAAO;QACvE,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAE,EAAE,CAAC;QACvB,CAAC,CAAC,cAAc,EAAE,CAAC;IACrB,CAAC;IAQO,cAAc,CAAC,KAAe;QACpC,OAAO,IAAI,CAAA,iBAAiB,QAAQ,CAAC,KAAK,CAAC;;;qBAG1B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,KAAK;;gBAEtC,QAAQ,CAAC,KAAK,CAAC;;;MAGzB,CAAC;IACL,CAAC;IAEO,aAAa;QACnB,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC;YACzB,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC,OAAO,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QACvE,OAAO,IAAI,CAAA;cACD,GAAG,CAAC,8CAA8C,CAAC;;qBAE5C,CAAC;IACpB,CAAC;IAES,gBAAgB,CAAC,OAAe;QACxC,OAAO;YACL,YAAY,EAAE,IAAI,CAAC,SAAS;YAC5B,MAAM,EAAE,IAAI,CAAC,GAAG;YAChB,SAAS,EAAE,IAAI,CAAC,MAAM;YACtB,UAAU,EAAE,IAAI,CAAC,OAAO;YACxB,OAAO,EAAE,IAAI,CAAC,IAAI;SACnB,CAAC;IACJ,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAA;;;;;;6BAMc,GAAG,CAAC,MAAM,CAAC;UAC9B,IAAI,CAAC,OAAO;YACZ,CAAC,CAAC,IAAI,CAAA,yBAAyB,IAAI,CAAC,OAAO,SAAS;YACpD,CAAC,CAAC,EAAE;;;oBAGM,CAAC,CAA4B,EAAE,EAAE,CACzC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAE,CAAC,MAAM,EAAE;;;YAGnC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC;;;YAG7B,gBAAgB,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,gBAAgB,CAAC;yCACzB,IAAI,CAAC,OAAO;YACzC,uBAAA,IAAI,wBAAS,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAC;;0BAE/B,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC,CAAC,MAAM;YAC5D,CAAC,CAAC,CAAC;YACH,CAAC,CAAC,CAAC,CAAC;mCACiB,CAAC,EACtB,MAAM,EAAE,EAAE,KAAK,EAAE,GAGlB,EAAE,EAAE;YACH,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QAC3B,CAAC;;cAEC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAC1B,MAAM,CAAC,UAAU,EAAE;YACjB,CAAC,CAAC,OAAO;YACT,CAAC,CAAC,IAAI,CAAA;6BACO,MAAM,CAAC,OAAO,EAAE;4BACjB,MAAM,CAAC,IAAI;8BACT,CACjB;;uCAE0B,IAAI,CAAC,OAAO,CAAC,MAAM;cAC5C,IAAI,CAAC,MAAM;YACX,CAAC,CAAC,UAAU,CAAA,IAAI,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,MAAM,CAC/C,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAE,CAAC,CAC5D,MAAM,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG;YACrC,CAAC,CAAC,OAAO;;;;sCAIe,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,EAAE;8BACnC,IAAI,CAAC,aAAa,EAAE;;;mBAG/B,GAAG,CAAC,MAAM,CAAC;sBACR,CAAC,IAAI,CAAC,OAAO;mBAChB,IAAI,CAAC,IAAI;;;;;mBAKT,GAAG,CAAC,MAAM,CAAC;sBACR,CAAC,IAAI,CAAC,OAAO;mBAChB,IAAI,CAAC,IAAI;;;;aAIf,GAAG,CAAC,OAAO,CAAC;;;;UAIf,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC,GAAG,CAC7B,MAAM,CAAC,EAAE,CACP,UAAU,CAAA,IAAI,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,MAAM,CACzD,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAC9B,MAAM,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAChD;eACM,CAAC;IACd,CAAC;CA2BF,CAAA;;AAzBQ,cAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;GAwBlB,CAAC;AAvQF;IADC,KAAK,CAAC,MAAM,CAAC;sCACC;AAGf;IADC,KAAK,CAAC,OAAO,CAAC;uCACC;AAGhB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;qCAGzC;AAWD;IADC,KAAK,EAAE;4CACgB;AAGxB;IADC,KAAK,EAAE;qCAGP;AAuCD;IADC,KAAK,EAAE;mCAqBP;AAGD;IADC,KAAK,EAAE;sCAiBP;AAxGU,OAAO;IAFnB,aAAa,CAAC,UAAU,CAAC;IACzB,SAAS,EAAE;GACC,OAAO,CA0QnB;SA1QY,OAAO","sourcesContent":["import { css, html, LitElement, nothing, TemplateResult } from 'lit';\nimport { customElement, property, query, state } from 'lit/decorators.js';\nimport { html as staticHtml, unsafeStatic } from 'lit/static-html.js';\n\nimport { configureLocalization, localized, msg, str } from '@lit/localize';\n\nimport { spread } from '@open-wc/lit-helpers';\n\nimport '@material/mwc-button';\nimport '@material/mwc-dialog';\nimport '@material/mwc-drawer';\nimport '@material/mwc-icon';\nimport '@material/mwc-icon-button';\nimport '@material/mwc-list';\nimport '@material/mwc-tab-bar';\nimport '@material/mwc-top-app-bar-fixed';\nimport type { ActionDetail } from '@material/mwc-list';\nimport type { Dialog } from '@material/mwc-dialog';\nimport type { Drawer } from '@material/mwc-drawer';\n\nimport { allLocales, sourceLocale, targetLocales } from './locales.js';\n\nimport { isComplex, isInsert, isRemove, isUpdate } from './foundation.js';\n\nimport './mixins/Wizarding.js';\nimport { Editing, LogEntry } from './mixins/EditingV2.js';\nimport { Plugging, Plugin, pluginTag } from './mixins/Plugging.js';\n\nexport { Plugging } from './mixins/Plugging.js';\nexport { Editing } from './mixins/EditingV2.js';\n\ntype Control = {\n  icon: string;\n  getName: () => string;\n  isDisabled: () => boolean;\n  action?: () => unknown;\n};\n\ntype RenderedPlugin = Control & { tagName: string };\n\ntype LocaleTag = typeof allLocales[number];\n\ntype PropertyType = string | boolean | number | object;\n\nconst { getLocale, setLocale } = configureLocalization({\n  sourceLocale,\n  targetLocales,\n  loadLocale: locale =>\n    import(new URL(`locales/${locale}.js`, import.meta.url).href),\n});\n\nfunction describe({ undo, redo }: LogEntry) {\n  let result = msg('Something unexpected happened!');\n  if (isComplex(redo)) result = msg(str`â‰¥ ${redo.length} nodes changed`);\n  if (isInsert(redo))\n    if (isInsert(undo))\n      result = msg(str`${redo.node.nodeName} moved to ${redo.parent.nodeName}`);\n    else\n      result = msg(\n        str`${redo.node.nodeName} inserted into ${redo.parent.nodeName}`\n      );\n  if (isRemove(redo)) result = msg(str`${redo.node.nodeName} removed`);\n  if (isUpdate(redo)) result = msg(str`${redo.element.tagName} updated`);\n  return result;\n}\n\nfunction renderActionItem(\n  control: Control,\n  slot = 'actionItems'\n): TemplateResult {\n  return html`<mwc-icon-button\n    slot=\"${slot}\"\n    icon=\"${control.icon}\"\n    label=\"${control.getName()}\"\n    ?disabled=${control.isDisabled()}\n    @click=${control.action}\n  ></mwc-icon-button>`;\n}\n\nfunction renderMenuItem(control: Control): TemplateResult {\n  return html`\n    <mwc-list-item graphic=\"icon\" .disabled=${control.isDisabled()}\n      ><mwc-icon slot=\"graphic\">${control.icon}</mwc-icon>\n      <span>${control.getName()}</span>\n    </mwc-list-item>\n  `;\n}\n\n/**\n *\n * @description Outer Shell for OpenSCD.\n *\n * @cssprop --oscd-theme-primary Primary color for OpenSCD\n * @cssprop --oscd-theme-app-bar-primary Primary color for OpenSCD appbar\n *\n * @tag open-scd\n */\n@customElement('open-scd')\n@localized()\nexport class OpenSCD extends Plugging(Editing(LitElement)) {\n  @query('#log')\n  logUI!: Dialog;\n\n  @query('#menu')\n  menuUI!: Drawer;\n\n  @property({ type: String, reflect: true })\n  get locale() {\n    return getLocale() as LocaleTag;\n  }\n\n  set locale(tag: LocaleTag) {\n    try {\n      setLocale(tag);\n    } catch {\n      // don't change locale if tag is invalid\n    }\n  }\n\n  @state()\n  private editorIndex = 0;\n\n  @state()\n  get editor() {\n    return this.editors[this.editorIndex]?.tagName ?? '';\n  }\n\n  private controls: Record<\n    'undo' | 'redo' | 'log' | 'menu',\n    Required<Control>\n  > = {\n    undo: {\n      icon: 'undo',\n      getName: () => msg('Undo'),\n      action: () => this.undo(),\n      isDisabled: () => !this.canUndo,\n    },\n    redo: {\n      icon: 'redo',\n      getName: () => msg('Redo'),\n      action: () => this.redo(),\n      isDisabled: () => !this.canRedo,\n    },\n    log: {\n      icon: 'history',\n      getName: () => msg('Editing history'),\n      action: () => (this.logUI.open ? this.logUI.close() : this.logUI.show()),\n      isDisabled: () => false,\n    },\n    menu: {\n      icon: 'menu',\n      getName: () => msg('Menu'),\n      action: async () => {\n        this.menuUI.open = !this.menuUI.open;\n        await this.menuUI.updateComplete;\n        if (this.menuUI.open) this.menuUI.querySelector('mwc-list')!.focus();\n      },\n      isDisabled: () => false,\n    },\n  };\n\n  #actions = [this.controls.undo, this.controls.redo, this.controls.log];\n\n  @state()\n  get menu() {\n    return (<Required<Control>[]>this.plugins.menu\n      ?.map((plugin): RenderedPlugin | undefined =>\n        plugin.active\n          ? {\n              icon: plugin.icon,\n              getName: () =>\n                plugin.translations?.[\n                  this.locale as typeof targetLocales[number]\n                ] || plugin.name,\n              isDisabled: () => (plugin.requireDoc && !this.docName) ?? false,\n              tagName: pluginTag(plugin.src),\n              action: () =>\n                this.shadowRoot!.querySelector<\n                  HTMLElement & { run: () => Promise<void> }\n                >(pluginTag(plugin.src))!.run?.(),\n            }\n          : undefined\n      )\n      .filter(p => p !== undefined)).concat(this.#actions);\n  }\n\n  @state()\n  get editors() {\n    return <RenderedPlugin[]>this.plugins.editor\n      ?.map((plugin): RenderedPlugin | undefined =>\n        plugin.active\n          ? {\n              icon: plugin.icon,\n              getName: () =>\n                plugin.translations?.[\n                  this.locale as typeof targetLocales[number]\n                ] || plugin.name,\n              isDisabled: () => (plugin.requireDoc && !this.docName) ?? false,\n              tagName: pluginTag(plugin.src),\n            }\n          : undefined\n      )\n      .filter(p => p !== undefined);\n  }\n\n  private hotkeys: Partial<Record<string, () => void>> = {\n    m: this.controls.menu.action,\n    z: this.controls.undo.action,\n    y: this.controls.redo.action,\n    Z: this.controls.redo.action,\n    l: this.controls.log.action,\n  };\n\n  private handleKeyPress(e: KeyboardEvent): void {\n    if (!e.ctrlKey) return;\n    if (!Object.prototype.hasOwnProperty.call(this.hotkeys, e.key)) return;\n    this.hotkeys[e.key]!();\n    e.preventDefault();\n  }\n\n  constructor() {\n    super();\n    this.handleKeyPress = this.handleKeyPress.bind(this);\n    document.addEventListener('keydown', this.handleKeyPress);\n  }\n\n  private renderLogEntry(entry: LogEntry) {\n    return html` <abbr title=\"${describe(entry)}\">\n      <mwc-list-item\n        graphic=\"icon\"\n        ?activated=${this.history[this.last] === entry}\n      >\n        <span>${describe(entry)}</span>\n        <mwc-icon slot=\"graphic\">history</mwc-icon>\n      </mwc-list-item></abbr\n    >`;\n  }\n\n  private renderHistory(): TemplateResult[] | TemplateResult {\n    if (this.history.length > 0)\n      return this.history.slice().reverse().map(this.renderLogEntry, this);\n    return html`<mwc-list-item disabled graphic=\"icon\">\n      <span>${msg('Your editing history will be displayed here.')}</span>\n      <mwc-icon slot=\"graphic\">info</mwc-icon>\n    </mwc-list-item>`;\n  }\n\n  protected pluginProperties(_plugin: Plugin): { [key: string]: PropertyType } {\n    return {\n      '.editCount': this.editCount,\n      '.doc': this.doc,\n      '.locale': this.locale,\n      '.docName': this.docName,\n      '.docs': this.docs,\n    };\n  }\n\n  render() {\n    return html`<mwc-drawer\n        class=\"mdc-theme--surface\"\n        hasheader\n        type=\"modal\"\n        id=\"menu\"\n      >\n        <span slot=\"title\">${msg('Menu')}</span>\n        ${this.docName\n          ? html`<span slot=\"subtitle\">${this.docName}</span>`\n          : ''}\n        <mwc-list\n          wrapFocus\n          @action=${(e: CustomEvent<ActionDetail>) =>\n            this.menu[e.detail.index]!.action()}\n        >\n          <li divider padded role=\"separator\"></li>\n          ${this.menu.map(renderMenuItem)}\n        </mwc-list>\n        <mwc-top-app-bar-fixed slot=\"appContent\">\n          ${renderActionItem(this.controls.menu, 'navigationIcon')}\n          <div slot=\"title\" id=\"title\">${this.docName}</div>\n          ${this.#actions.map(op => renderActionItem(op))}\n          <mwc-tab-bar\n            activeIndex=${this.editors.filter(p => !p.isDisabled()).length\n              ? 0\n              : -1}\n            @MDCTabBar:activated=${({\n              detail: { index },\n            }: {\n              detail: { index: number };\n            }) => {\n              this.editorIndex = index;\n            }}\n          >\n            ${this.editors.map(editor =>\n              editor.isDisabled()\n                ? nothing\n                : html`<mwc-tab\n                    label=\"${editor.getName()}\"\n                    icon=\"${editor.icon}\"\n                  ></mwc-tab>`\n            )}\n          </mwc-tab-bar>\n          <oscd-wizard-host .wizards=${this.plugins.wizard}>\n            ${this.editor\n              ? staticHtml`<${unsafeStatic(this.editor)} ${spread(\n                  this.pluginProperties(this.loadedPlugins.get(this.editor)!)\n                )}></${unsafeStatic(this.editor)}>`\n              : nothing}\n          </oscd-wizard-host>\n        </mwc-top-app-bar-fixed>\n      </mwc-drawer>\n      <mwc-dialog id=\"log\" heading=\"${this.controls.log.getName()}\">\n        <mwc-list wrapFocus>${this.renderHistory()}</mwc-list>\n        <mwc-button\n          icon=\"undo\"\n          label=\"${msg('Undo')}\"\n          ?disabled=${!this.canUndo}\n          @click=${this.undo}\n          slot=\"secondaryAction\"\n        ></mwc-button>\n        <mwc-button\n          icon=\"redo\"\n          label=\"${msg('Redo')}\"\n          ?disabled=${!this.canRedo}\n          @click=${this.redo}\n          slot=\"secondaryAction\"\n        ></mwc-button>\n        <mwc-button slot=\"primaryAction\" dialogaction=\"close\"\n          >${msg('Close')}</mwc-button\n        >\n      </mwc-dialog>\n      <aside>\n        ${(this.plugins.menu || []).map(\n          plugin =>\n            staticHtml`<${unsafeStatic(pluginTag(plugin.src))} ${spread(\n              this.pluginProperties(plugin)\n            )}></${unsafeStatic(pluginTag(plugin.src))}>`\n        )}\n      </aside>`;\n  }\n\n  static styles = css`\n    aside {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 0;\n      height: 0;\n      overflow: hidden;\n      margin: 0;\n      padding: 0;\n    }\n\n    abbr {\n      text-decoration: none;\n    }\n\n    mwc-top-app-bar-fixed {\n      --mdc-theme-primary: var(\n        --oscd-theme-app-bar-primary,\n        var(--oscd-theme-primary)\n      );\n\n      --mdc-theme-text-disabled-on-light: rgba(255, 255, 255, 0.38);\n    } /* hack to fix disabled icon buttons rendering black */\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'open-scd': OpenSCD;\n  }\n}\n"]}