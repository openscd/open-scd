{"version":3,"file":"fcda.js","sourceRoot":"","sources":["../../src/wizards/fcda.ts"],"names":[],"mappings":"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","sourcesContent":["import { html } from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport {\n  find,\n  Wizard,\n  WizardAction,\n  WizardActor,\n  WizardInputElement,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport {\n  createElement,\n} from '@openscd/xml';\n\nimport { FinderList } from '@openscd/open-scd/src/finder-list.js';\nimport {\n  dataAttributePicker,\n  getDataModelChildren,\n} from './foundation/finder.js';\n\nexport function newFCDA(parent: Element, path: string[]): Element | undefined {\n  const [leafTag, leafId] = path[path.length - 1].split(': ');\n  const leaf = find(parent.ownerDocument, leafTag, leafId);\n  if (!leaf || getDataModelChildren(leaf).length > 0) return;\n\n  const lnSegment = path.find(segment => segment.startsWith('LN'));\n  if (!lnSegment) return;\n\n  const [lnTag, lnId] = lnSegment.split(': ');\n\n  const ln = find(parent.ownerDocument, lnTag, lnId);\n  if (!ln) return;\n\n  const ldInst = ln.closest('LDevice')?.getAttribute('inst');\n  const prefix = ln.getAttribute('prefix') ?? '';\n  const lnClass = ln.getAttribute('lnClass');\n  const lnInst =\n    ln.getAttribute('inst') && ln.getAttribute('inst') !== ''\n      ? ln.getAttribute('inst')\n      : null;\n\n  let doName = '';\n  let daName = '';\n  let fc = '';\n\n  for (const segment of path) {\n    const [tagName, id] = segment.split(': ');\n    if (!['DO', 'DA', 'SDO', 'BDA'].includes(tagName)) continue;\n\n    const element = find(parent.ownerDocument, tagName, id);\n\n    if (!element) return;\n\n    const name = element.getAttribute('name')!;\n\n    if (tagName === 'DO') doName = name;\n    if (tagName === 'SDO') doName = doName + '.' + name;\n    if (tagName === 'DA') {\n      daName = name;\n      fc = element.getAttribute('fc') ?? '';\n    }\n    if (tagName === 'BDA') daName = daName + '.' + name;\n  }\n\n  if (!ldInst || !lnClass || !doName || !daName || !fc) return;\n\n  return createElement(parent.ownerDocument, 'FCDA', {\n    ldInst,\n    prefix,\n    lnClass,\n    lnInst,\n    doName,\n    daName,\n    fc,\n  });\n}\n\nfunction createFCDAsAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[], wizard: Element): WizardAction[] => {\n    const finder = wizard.shadowRoot!.querySelector<FinderList>('finder-list');\n    const paths = finder?.paths ?? [];\n\n    const actions = [];\n    for (const path of paths) {\n      const element = newFCDA(parent, path);\n\n      if (!element) continue;\n\n      actions.push({\n        new: {\n          parent,\n          element,\n          reference: null,\n        },\n      });\n    }\n\n    return actions;\n  };\n}\n\nexport function createFCDAsWizard(parent: Element): Wizard {\n  const server = parent.closest('Server');\n\n  return [\n    {\n      title: get('wizard.title.add', { tagName: 'FCDA' }),\n      primary: {\n        label: 'add',\n        icon: 'add',\n        action: createFCDAsAction(parent),\n      },\n      content: [server ? dataAttributePicker(server) : html``],\n    },\n  ];\n}\n"]}