{"version":3,"file":"smv-list.js","sourceRoot":"","sources":["../../../../src/editors/subscription/sampledvalues/smv-list.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n} from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-icon';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item';\n\nimport {\n  getNameAttribute,\n  identity,\n  newWizardEvent,\n} from '@openscd/open-scd/src/foundation.js';\nimport { newSmvSelectEvent } from './foundation.js';\nimport { smvIcon } from '@openscd/open-scd/src/icons/icons.js';\nimport { getOrderedIeds, styles } from '../foundation.js';\nimport { classMap } from 'lit-html/directives/class-map.js';\nimport { wizards } from '../../../wizards/wizard-library.js';\n\nlet selectedSmvMsg: Element | undefined;\nlet selectedDataSet: Element | undefined | null;\n\nfunction onOpenDocResetSelectedSmvMsg() {\n  selectedSmvMsg = undefined;\n  selectedDataSet = undefined;\n}\naddEventListener('open-doc', onOpenDocResetSelectedSmvMsg);\n\n/** An sub element for showing all Sampled Values per IED. */\n@customElement('smv-list')\nexport class SmvPublisherList extends LitElement {\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  @property({ type: Number })\n  editCount = -1;\n\n  private onSelect(smvControl: Element) {\n    const ln = smvControl.parentElement;\n    const dataset = ln?.querySelector(\n      `DataSet[name=${smvControl.getAttribute('datSet')}]`\n    );\n\n    selectedSmvMsg = smvControl;\n    selectedDataSet = dataset;\n\n    this.dispatchEvent(newSmvSelectEvent(selectedSmvMsg, selectedDataSet!));\n\n    this.requestUpdate();\n  }\n\n  private openEditWizard(smvControl: Element): void {\n    const wizard = wizards['SampledValueControl'].edit(smvControl);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  protected updated(): void {\n    this.dispatchEvent(\n      newSmvSelectEvent(selectedSmvMsg, selectedDataSet ?? undefined)\n    );\n  }\n\n  protected firstUpdated(): void {\n    selectedSmvMsg = undefined;\n    selectedDataSet = undefined;\n  }\n\n  renderSmv(smvControl: Element): TemplateResult {\n    return html`<mwc-list-item\n      @click=${() => this.onSelect(smvControl)}\n      graphic=\"large\"\n      hasMeta\n      value=\"${identity(smvControl)}\"\n    >\n      <mwc-icon slot=\"graphic\">${smvIcon}</mwc-icon>\n      <span>${smvControl.getAttribute('name')}</span>\n      <mwc-icon-button\n        class=\"${classMap({\n          hidden: smvControl !== selectedSmvMsg,\n        })}\"\n        slot=\"meta\"\n        icon=\"edit\"\n        @click=${() => this.openEditWizard(smvControl)}\n      ></mwc-icon-button>\n    </mwc-list-item>`;\n  }\n\n  render(): TemplateResult {\n    return html` <section tabindex=\"0\">\n      <h1>${get('subscription.smv.publisher.title')}</h1>\n      <filtered-list activatable>\n        ${getOrderedIeds(this.doc).map(\n          ied =>\n            html`\n              <mwc-list-item\n                noninteractive\n                graphic=\"icon\"\n                value=\"${Array.from(ied.querySelectorAll('SampledValueControl'))\n                  .filter(cb => cb.hasAttribute('datSet'))\n                  .map(element => {\n                    const id = identity(element) as string;\n                    return typeof id === 'string' ? id : '';\n                  })\n                  .join(' ')}\"\n              >\n                <span>${getNameAttribute(ied)}</span>\n                <mwc-icon slot=\"graphic\">developer_board</mwc-icon>\n              </mwc-list-item>\n              <li divider role=\"separator\"></li>\n              ${Array.from(\n                ied.querySelectorAll(\n                  ':scope > AccessPoint > Server > LDevice > LN0 > SampledValueControl'\n                )\n              )\n                .filter(cb => cb.hasAttribute('datSet'))\n                .map(control => this.renderSmv(control))}\n            `\n        )}\n      </filtered-list>\n    </section>`;\n  }\n\n  static styles = css`\n    ${styles}\n\n    mwc-list-item {\n      --mdc-list-item-meta-size: 48px;\n    }\n\n    mwc-icon-button.hidden {\n      display: none;\n    }\n\n    mwc-list-item.hidden[noninteractive] + li[divider] {\n      display: none;\n    }\n  `;\n}\n"]}