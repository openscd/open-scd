{"version":3,"file":"subnetwork.js","sourceRoot":"","sources":["../../src/wizards/subnetwork.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, TemplateResult } from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport { cloneElement, createElement } from '@openscd/xml';\n\nimport '@openscd/open-scd/src/wizard-textfield.js';\nimport {\n  getMultiplier,\n  getValue,\n  patterns,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '@openscd/open-scd/src/foundation.js';\nimport { EditorAction } from '@openscd/core/foundation/deprecated/editor';\n\n/** Initial attribute values suggested for `SubNetwork` creation */\nconst initial = {\n  type: '8-MMS',\n  bitrate: '100',\n  multiplier: 'M',\n};\n\ninterface ContentOptions {\n  name: string | null;\n  desc: string | null;\n  type: string | null;\n  BitRate: string | null;\n  multiplier: string | null;\n}\n\nfunction contentSubNetwork(options: ContentOptions): TemplateResult[] {\n  return [\n    html`<wizard-textfield\n      label=\"name\"\n      .maybeValue=${options.name}\n      helper=\"${get('subnetwork.wizard.nameHelper')}\"\n      required\n      validationMessage=\"${get('textfield.required')}\"\n      dialogInitialFocus\n    ></wizard-textfield>`,\n    html`<wizard-textfield\n      label=\"desc\"\n      .maybeValue=${options.desc}\n      nullable\n      helper=\"${get('subnetwork.wizard.descHelper')}\"\n    ></wizard-textfield>`,\n    html`<wizard-textfield\n      label=\"type\"\n      .maybeValue=${options.type}\n      nullable\n      helper=\"${get('subnetwork.wizard.typeHelper')}\"\n      pattern=\"${patterns.normalizedString}\"\n    ></wizard-textfield>`,\n    html`<wizard-textfield\n      label=\"BitRate\"\n      .maybeValue=${options.BitRate}\n      nullable\n      unit=\"b/s\"\n      .multipliers=${[null, 'M']}\n      .multiplier=${options.multiplier}\n      helper=\"${get('subnetwork.wizard.bitrateHelper')}\"\n      required\n      validationMessage=\"${get('textfield.nonempty')}\"\n      pattern=\"${patterns.decimal}\"\n    ></wizard-textfield>`,\n  ];\n}\n\nexport function createSubNetworkAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditorAction[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!);\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const type = getValue(inputs.find(i => i.label === 'type')!);\n    const BitRate = getValue(inputs.find(i => i.label === 'BitRate')!);\n    const multiplier = getMultiplier(inputs.find(i => i.label === 'BitRate')!);\n\n    const element = createElement(parent.ownerDocument, 'SubNetwork', {\n      name,\n      desc,\n      type,\n    });\n\n    if (BitRate !== null) {\n      const bitRateElement = createElement(parent.ownerDocument, 'BitRate', {\n        unit: 'b/s',\n        multiplier,\n      });\n      bitRateElement.textContent = BitRate;\n      element.appendChild(bitRateElement);\n    }\n\n    const action = {\n      new: {\n        parent,\n        element,\n      },\n    };\n\n    return [action];\n  };\n}\n\nexport function createSubNetworkWizard(parent: Element): Wizard {\n  return [\n    {\n      title: get('wizard.title.add', { tagName: 'SubNetwork' }),\n      primary: {\n        icon: 'add',\n        label: get('add'),\n        action: createSubNetworkAction(parent),\n      },\n      content: contentSubNetwork({\n        name: '',\n        desc: '',\n        type: initial.type,\n        BitRate: initial.bitrate,\n        multiplier: initial.multiplier,\n      }),\n    },\n  ];\n}\n\nfunction getBitRateAction(\n  oldBitRate: Element | null,\n  BitRate: string | null,\n  multiplier: string | null,\n  SubNetwork: Element\n): EditorAction {\n  if (oldBitRate === null) {\n    const bitRateElement = createElement(SubNetwork.ownerDocument, 'BitRate', {\n      unit: 'b/s',\n    });\n\n    if (multiplier) bitRateElement.setAttribute('multiplier', multiplier);\n    if (BitRate) bitRateElement.textContent = BitRate;\n\n    return {\n      new: {\n        parent: SubNetwork,\n        element: bitRateElement,\n        reference: SubNetwork.firstElementChild,\n      },\n    };\n  }\n\n  if (BitRate === null)\n    return {\n      old: {\n        parent: SubNetwork,\n        element: oldBitRate,\n        reference: oldBitRate.nextSibling,\n      },\n    };\n\n  const newBitRate = cloneElement(oldBitRate, { multiplier });\n  newBitRate.textContent = BitRate;\n\n  return {\n    old: { element: oldBitRate },\n    new: { element: newBitRate },\n  };\n}\n\nfunction updateSubNetworkAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditorAction[] => {\n    const name = inputs.find(i => i.label === 'name')!.value!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const type = getValue(inputs.find(i => i.label === 'type')!);\n    const BitRate = getValue(inputs.find(i => i.label === 'BitRate')!);\n    const multiplier = getMultiplier(inputs.find(i => i.label === 'BitRate')!);\n\n    let subNetworkAction: EditorAction | null;\n    let bitRateAction: EditorAction | null;\n\n    if (\n      name === element.getAttribute('name') &&\n      desc === element.getAttribute('desc') &&\n      type === element.getAttribute('type')\n    ) {\n      subNetworkAction = null;\n    } else {\n      const newElement = cloneElement(element, { name, desc, type });\n      subNetworkAction = { old: { element }, new: { element: newElement } };\n    }\n\n    if (\n      BitRate ===\n        (element.querySelector('SubNetwork > BitRate')?.textContent?.trim() ??\n          null) &&\n      multiplier ===\n        (element\n          .querySelector('SubNetwork > BitRate')\n          ?.getAttribute('multiplier') ?? null)\n    ) {\n      bitRateAction = null;\n    } else {\n      bitRateAction = getBitRateAction(\n        element.querySelector('SubNetwork > BitRate'),\n        BitRate,\n        multiplier,\n        subNetworkAction?.new.element ?? element\n      );\n    }\n\n    const actions: EditorAction[] = [];\n    if (subNetworkAction) actions.push(subNetworkAction);\n    if (bitRateAction) actions.push(bitRateAction);\n    return actions;\n  };\n}\n\nexport function editSubNetworkWizard(element: Element): Wizard {\n  const name = element.getAttribute('name');\n  const desc = element.getAttribute('desc');\n  const type = element.getAttribute('type');\n  const BitRate =\n    element.querySelector('SubNetwork > BitRate')?.textContent?.trim() ?? null;\n  const multiplier =\n    element.querySelector('SubNetwork > BitRate')?.getAttribute('multiplier') ??\n    null;\n\n  return [\n    {\n      title: get('wizard.title.edit', { tagName: element.tagName }),\n      element,\n      primary: {\n        icon: 'save',\n        label: get('save'),\n        action: updateSubNetworkAction(element),\n      },\n      content: contentSubNetwork({ name, desc, type, BitRate, multiplier }),\n    },\n  ];\n}\n"]}