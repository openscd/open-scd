{"version":3,"file":"do-container.js","sourceRoot":"","sources":["../../../src/editors/ied/do-container.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  customElement,\n  html,\n  property,\n  query,\n  TemplateResult,\n} from 'lit-element';\nimport { nothing } from 'lit-html';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-icon-button-toggle';\nimport { IconButtonToggle } from '@material/mwc-icon-button-toggle';\n\nimport '@openscd/open-scd/src/action-pane.js';\nimport './da-container.js';\n\nimport {\n  getDescriptionAttribute,\n  getNameAttribute,\n  newWizardEvent,\n} from '@openscd/open-scd/src/foundation.js';\nimport { createDoInfoWizard } from './do-wizard.js';\nimport {\n  Container,\n  findDOTypeElement,\n  getInstanceDAElement,\n} from './foundation.js';\n\n/** [[`IED`]] plugin subeditor for editing `DO` element. */\n@customElement('do-container')\nexport class DOContainer extends Container {\n  /**\n   * The optional DOI of this DO.\n   */\n  @property({ attribute: false })\n  instanceElement!: Element;\n\n  @query('#toggleButton') toggleButton: IconButtonToggle | undefined;\n\n  private header(): TemplateResult {\n    const name = getNameAttribute(this.element);\n    const desc = getDescriptionAttribute(this.element);\n\n    if (this.instanceElement != null) {\n      return html`<b>${name}${desc ? html` &mdash; ${desc}` : nothing}</b>`;\n    } else {\n      return html`${name}${desc ? html` &mdash; ${desc}` : nothing}`;\n    }\n  }\n\n  /**\n   * Get the nested SDO element(s).\n   * @returns The nested SDO element(s) of this DO container.\n   */\n  private getDOElements(): Element[] {\n    const doType = findDOTypeElement(this.element);\n    if (doType != null) {\n      return Array.from(doType.querySelectorAll(':scope > SDO'));\n    }\n    return [];\n  }\n\n  /**\n   * Get the nested (B)DA element(s).\n   * @returns The nested (B)DA element(s) of this DO container.\n   */\n  private getDAElements(): Element[] {\n    const type = this.element.getAttribute('type') ?? undefined;\n    const doType = this.element\n      .closest('SCL')!\n      .querySelector(`:root > DataTypeTemplates > DOType[id=\"${type}\"]`);\n    if (doType != null) {\n      return Array.from(doType!.querySelectorAll(':scope > DA'));\n    }\n    return [];\n  }\n\n  /**\n   * Get the instance element (SDI) of a (S)DO element (if available)\n   * @param dO - The (S)DO object to search with.\n   * @returns The optional SDI element.\n   */\n  private getInstanceDOElement(dO: Element): Element | null {\n    const sdoName = getNameAttribute(dO);\n    if (this.instanceElement) {\n      return this.instanceElement.querySelector(\n        `:scope > SDI[name=\"${sdoName}\"]`\n      );\n    }\n    return null;\n  }\n\n  render(): TemplateResult {\n    const daElements = this.getDAElements();\n    const doElements = this.getDOElements();\n\n    return html`<action-pane\n      .label=\"${this.header()}\"\n      icon=\"${this.instanceElement != null ? 'done' : ''}\"\n    >\n      <abbr slot=\"action\">\n        <mwc-icon-button\n          title=${this.nsdoc.getDataDescription(this.element).label}\n          icon=\"info\"\n          @click=${() =>\n            this.dispatchEvent(\n              newWizardEvent(\n                createDoInfoWizard(\n                  this.element,\n                  this.instanceElement,\n                  this.ancestors,\n                  this.nsdoc\n                )\n              )\n            )}\n        ></mwc-icon-button>\n      </abbr>\n      ${daElements.length > 0 || doElements.length > 0\n        ? html`<abbr\n            slot=\"action\"\n            title=\"${get('iededitor.toggleChildElements')}\"\n          >\n            <mwc-icon-button-toggle\n              id=\"toggleButton\"\n              onIcon=\"keyboard_arrow_up\"\n              offIcon=\"keyboard_arrow_down\"\n              @click=${() => this.requestUpdate()}\n            ></mwc-icon-button-toggle>\n          </abbr>`\n        : nothing}\n      ${this.toggleButton?.on\n        ? daElements.map(\n            daElement =>\n              html`<da-container\n                .editCount=${this.editCount}\n                .doc=${this.doc}\n                .element=${daElement}\n                .instanceElement=${getInstanceDAElement(\n                  this.instanceElement,\n                  daElement\n                )}\n                .nsdoc=${this.nsdoc}\n                .ancestors=${[...this.ancestors, this.element]}\n              ></da-container>`\n          )\n        : nothing}\n      ${this.toggleButton?.on\n        ? doElements.map(\n            doElement =>\n              html`<do-container\n                .editCount=${this.editCount}\n                .doc=${this.doc}\n                .element=${doElement}\n                .instanceElement=${this.getInstanceDOElement(doElement)}\n                .nsdoc=${this.nsdoc}\n                .ancestors=${[...this.ancestors, this.element]}\n              ></do-container>`\n          )\n        : nothing}\n    </action-pane> `;\n  }\n}\n"]}