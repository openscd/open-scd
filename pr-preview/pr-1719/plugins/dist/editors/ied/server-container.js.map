{"version":3,"file":"server-container.js","sourceRoot":"","sources":["../../../src/editors/ied/server-container.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  customElement,\n  html,\n  property,\n  PropertyValues,\n  query,\n  state,\n  TemplateResult,\n} from 'lit-element';\nimport { nothing } from 'lit-html';\nimport { translate } from 'lit-translate';\n\nimport { serverIcon } from '@openscd/open-scd/src/icons/ied-icons.js';\nimport { getDescriptionAttribute } from '@openscd/open-scd/src/foundation.js';\nimport { createElement } from '@openscd/xml';\nimport { newEditEventV2 } from '@openscd/core';\n\nimport {\n  Container,\n  findLLN0LNodeType,\n  createLLN0LNodeType,\n} from './foundation.js';\nimport { AddLDeviceDialog, LDeviceData } from './add-ldevice-dialog.js';\n\nimport '@openscd/open-scd/src/action-pane.js';\nimport './ldevice-container.js';\nimport './add-ldevice-dialog.js';\n\n/** [[`IED`]] plugin subeditor for editing `Server` element. */\n@customElement('server-container')\nexport class ServerContainer extends Container {\n  @property()\n  selectedLNClasses: string[] = [];\n\n  @query('add-ldevice-dialog')\n  addAccessPointDialog!: AddLDeviceDialog;\n\n  private header(): TemplateResult {\n    const desc = getDescriptionAttribute(this.element);\n\n    return html`Server${desc ? html` &mdash; ${desc}` : nothing}`;\n  }\n\n  protected updated(_changedProperties: PropertyValues): void {\n    super.updated(_changedProperties);\n\n    // When the LN Classes filter is updated, we also want to trigger rendering for the LN Elements.\n    if (_changedProperties.has('selectedLNClasses')) {\n      this.requestUpdate('lDeviceElements');\n    }\n  }\n\n  @state()\n  private get lDeviceElements(): Element[] {\n    return Array.from(this.element.querySelectorAll(':scope > LDevice')).filter(\n      element => {\n        return (\n          Array.from(element.querySelectorAll(':scope > LN,LN0')).filter(\n            element => {\n              const lnClass = element.getAttribute('lnClass') ?? '';\n              return this.selectedLNClasses.includes(lnClass);\n            }\n          ).length > 0\n        );\n      }\n    );\n  }\n\n  private handleAddLDevice(data: LDeviceData) {\n    const inserts: any[] = [];\n    const lln0Type = findLLN0LNodeType(this.doc);\n    const lnTypeId = lln0Type?.getAttribute('id') || 'PlaceholderLLN0';\n\n    if (!lln0Type) {\n      const lnodeTypeInserts = createLLN0LNodeType(this.doc, lnTypeId);\n      inserts.push(...lnodeTypeInserts);\n    }\n    const lDevice = createElement(this.doc, 'LDevice', {\n      inst: data.inst,\n    });\n\n    const ln0 = createElement(this.doc, 'LN0', {\n      lnClass: 'LLN0',\n      inst: '',\n      lnType: lnTypeId,\n    });\n\n    lDevice.appendChild(ln0);\n    inserts.push({ parent: this.element, node: lDevice, reference: null });\n    this.dispatchEvent(newEditEventV2(inserts));\n  }\n\n  render(): TemplateResult {\n    return html`<action-pane .label=\"${this.header()}\">\n      <mwc-icon slot=\"icon\">${serverIcon}</mwc-icon>\n      <abbr\n        slot=\"action\"\n        title=${translate('iededitor.addLDeviceDialog.title')}\n      >\n        <mwc-icon-button\n          icon=\"playlist_add\"\n          @click=${() => this.addAccessPointDialog.show()}\n        ></mwc-icon-button>\n      </abbr>\n      ${this.lDeviceElements.map(\n        server =>\n          html`<ldevice-container\n            .editCount=${this.editCount}\n            .doc=${this.doc}\n            .element=${server}\n            .nsdoc=${this.nsdoc}\n            .selectedLNClasses=${this.selectedLNClasses}\n            .ancestors=${[...this.ancestors, this.element]}\n          ></ldevice-container>`\n      )}\n      <add-ldevice-dialog\n        .server=${this.element}\n        .onConfirm=${(data: LDeviceData) => this.handleAddLDevice(data)}\n      ></add-ldevice-dialog>\n    </action-pane>`;\n  }\n}\n"]}