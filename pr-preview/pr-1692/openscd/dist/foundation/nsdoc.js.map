{"version":3,"file":"nsdoc.js","sourceRoot":"","sources":["../../src/foundation/nsdoc.ts"],"names":[],"mappings":"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","sourcesContent":["import { iec6185072, iec6185073, iec6185074, iec6185081 } from \"./nsd.js\";\n\nexport interface Nsdoc {\n  nsdoc72?: XMLDocument;\n  nsdoc73?: XMLDocument;\n  nsdoc74?: XMLDocument;\n  nsdoc81?: XMLDocument;\n  getDataDescription: (element: Element, ancestors?: Element[]) => { label: string; }\n}\n\nconst [nsd72, nsd73, nsd74, nsd81] = await Promise.all([iec6185072, iec6185073, iec6185074, iec6185081]);\n\nlet nsdoc72: Document | undefined = undefined;\nlet nsdoc73: Document | undefined = undefined;\nlet nsdoc74: Document | undefined = undefined;\nlet nsdoc81: Document | undefined = undefined;\n\n/**\n * Initialize the full Nsdoc object.\n * @returns A fully initialized Nsdoc object for wizards/editors to use.\n */\nexport function initializeNsdoc(): Nsdoc {\n  [nsdoc72, nsdoc73, nsdoc74, nsdoc81] = [\n    localStorage.getItem('IEC 61850-7-2') ? new DOMParser().parseFromString(localStorage.getItem('IEC 61850-7-2')!, 'application/xml') : undefined,\n    localStorage.getItem('IEC 61850-7-3') ? new DOMParser().parseFromString(localStorage.getItem('IEC 61850-7-3')!, 'application/xml') : undefined,\n    localStorage.getItem('IEC 61850-7-4') ? new DOMParser().parseFromString(localStorage.getItem('IEC 61850-7-4')!, 'application/xml') : undefined,\n    localStorage.getItem('IEC 61850-8-1') ? new DOMParser().parseFromString(localStorage.getItem('IEC 61850-8-1')!, 'application/xml') : undefined\n  ]\n\n  const iedElementTagNames = ['LN', 'LN0', 'DO', 'SDO', 'DOI', 'DA', 'BDA', 'DAI'] as const;\n  type IEDElementTagNames = typeof iedElementTagNames[number];\n  type GetDataDescription = (element: Element, ancestors?: Element[]) => { label: string; };\n\n  const getDataDescriptions: Record<\n  IEDElementTagNames,\n    {\n      getDataDescription: GetDataDescription;\n    }\n  > = {\n    LN: {\n      getDataDescription: getLNDataDescription\n    },\n    LN0: {\n      getDataDescription: getLNDataDescription\n    },\n    DO: {\n      getDataDescription: getDODataDescription\n    },\n    SDO: {\n      getDataDescription: getSDODataDescription\n    },\n    DOI: {\n      getDataDescription: getDODataDescription\n    },\n    DA: {\n      getDataDescription: getDADataDescription\n    },\n    BDA: {\n      getDataDescription: getBDADataDescription\n    },\n    DAI: {\n      getDataDescription: getDADataDescription\n    }\n  };\n\n  /**\n   * Getting data descriptions for LN(0) elements out of the IEC 61850-7-4 .nsdoc file.\n   * @param element - The element to use for searching the LN description.\n   * @returns Documentation from the .nsdoc file for this LN(0) file, or the lnClass attribute in case no description can be found.\n   */\n  function getLNDataDescription(element: Element): { label: string; } {\n    const lnClassAttribute = element.getAttribute('lnClass')!;\n    const lnClass = nsd74.querySelector(`NS > LNClasses > LNClass[name=\"${lnClassAttribute}\"]`);\n    const lnClassDescription = getNsdocDocumentation(nsdoc74!, lnClass?.getAttribute('titleID'));\n\n    return {\n      label: lnClassDescription ? lnClassDescription + ' (' + lnClassAttribute + ')' : lnClassAttribute\n    };\n  }\n\n  /**\n   * Getting data descriptions for DO(I) elements out of the IEC 61850-7-4 .nsdoc file.\n   * @param element - The element to use for searching the DO description.\n   * @returns Documentation from the .nsdoc file for this DO(I) file, or the name attribute in case no description can be found.\n   */\n  function getDODataDescription(element: Element): { label: string; } {\n    const doName = element.getAttribute('name')!;\n    const lnClass = nsd74.querySelector(`NS > LNClasses > LNClass[name=\"${element.parentElement?.getAttribute('lnClass')}\"]`);\n    const base = lnClass?.getAttribute('base');\n    const dObject = lnClass?.querySelector(`DataObject[name=\"${doName}\"]`) ?? getInheritedDataObject(base!, doName);\n\n    return {\n      label: getNsdocDocumentation(nsdoc74!, dObject?.getAttribute('descID')) ?? doName\n    };\n  }\n\n  /**\n   * Getting data descriptions for SDO elements out of the IEC 61850-7-3 .nsdoc file.\n   * @param element - The element to use for searching the SDO description.\n   * @returns Documentation from the .nsdoc file for this SDO element, or the name attribute in case no description can be found.\n   */\n  function getSDODataDescription(element: Element): { label: string; } {\n    const sdoName = element.getAttribute('name')!;\n    const subDataObject = nsd73.querySelector(`CDCs > CDC[name=\"${element.parentElement?.getAttribute('cdc')}\"] > SubDataObject[name=\"${sdoName}\"]`);\n\n    return {\n      label: getNsdocDocumentation(nsdoc73!, subDataObject?.getAttribute('descID')) ?? sdoName\n    };\n  }\n\n  /**\n   * Getting data descriptions for DA(I) elements out of the IEC 61850-7-3 and IEC 61850-8-1 .nsdoc file.\n   * @param element - The element to use for searching the DA description.\n   * @returns Documentation from the .nsdoc file for this DA(I) element, or the name attribute in case no description can be found.\n   */\n  function getDADataDescription(element: Element): { label: string; } {\n    const daElementName = element.getAttribute('name')!;\n    const cdcName = element.closest('DOType')!.getAttribute('cdc');\n    const serviceDataAttr = nsd81.querySelector(`ServiceCDCs > ServiceCDC[cdc=\"${cdcName}\"] > ServiceDataAttribute[name=\"${daElementName}\"]`);\n\n    if (serviceDataAttr) {\n      const id = serviceDataAttr?.getAttribute('descID') ??\n        nsd81.querySelector(`ServiceConstructedAttributes > ServiceConstructedAttribute[name=\"${daElementName}\"]`)?.getAttribute('titleID') ?? '';\n      return {\n        label: getNsdocDocumentation(nsdoc81!, id) ?? daElementName\n      };\n    } else {\n      const dataAttr = nsd73.querySelector(`NS > CDCs > CDC[name=\"${cdcName}\"] > DataAttribute[name=\"${daElementName}\"]`);\n      return {\n        label: getNsdocDocumentation(nsdoc73!, dataAttr?.getAttribute('descID')) ?? daElementName\n      };\n    }\n  }\n\n  /**\n   * Getting data descriptions for BDA elements out of the IEC 61850-7-3 and IEC 61850-8-1 .nsdoc file.\n   * @param element - The element to use for searching the BDA description.\n   * @param ancestors - In this function, we need an ancestor to get a 'CDC' attribute.\n   * @returns Documentation from the .nsdoc file for this BDA element, or the name attribute in case no description can be found.\n   */\n  function getBDADataDescription(element: Element, ancestors?: Element[]): { label: string; } {\n    const bdaElementName = element.getAttribute('name')!;\n    const daParent = ancestors?.filter(x => x.tagName === 'DA')[0];\n    const serviceDataAttr = nsd81.querySelector(`ServiceConstructedAttributes > ServiceConstructedAttribute[name=\"${daParent!.getAttribute('name')}\"]`);\n\n    if (serviceDataAttr) {\n      if (serviceDataAttr.querySelector(`SubDataAttribute[name=\"${ancestors![0].getAttribute('name')}\"]`)?.getAttribute('type') == 'Originator') {\n        const subDataAttr = nsd72.querySelector(`ConstructedAttributes > ConstructedAttribute[name=\"Originator\"] > SubDataAttribute[name=\"${bdaElementName}\"]`);\n        return {\n          label: getNsdocDocumentation(nsdoc72!, subDataAttr?.getAttribute('descID')) ?? bdaElementName\n        };\n      }\n      return {\n        label: getNsdocDocumentation(nsdoc81!,\n          serviceDataAttr.querySelector(`SubDataAttribute[name=\"${bdaElementName}\"]`)?.getAttribute('descID')) ?? bdaElementName\n      };\n    } else {\n      const dataAttrParent = nsd73.querySelector(`NS > CDCs > CDC[name=\"${daParent!.closest('DOType')?.getAttribute('cdc')}\"] >\n        DataAttribute[name=\"${daParent!.getAttribute('name')}\"]`);\n      return {\n        label: getNsdocDocumentation(nsdoc73!, getSubDataAttribute(dataAttrParent!, bdaElementName)?.getAttribute('descID')) ?? bdaElementName\n      };\n    }\n  }\n\n  /**\n   * Get the SubDataAttribute from the IEC-61850-7-3.\n   * @param parent - The parent element in which to search for a SubDataAttribute.\n   * @param bdaElementName - The name of the element to search.\n   * @returns A SubDataAttribute, or null.\n   */\n  function getSubDataAttribute(parent: Element | undefined, bdaElementName: string): Element | null {\n    if (!parent) return null;\n    const subDataAttr = nsd73.querySelector(`ConstructedAttributes > ConstructedAttribute[name=\"${parent?.getAttribute('type')}\"] > SubDataAttribute[name=\"${bdaElementName}\"]`);\n    return subDataAttr ?? getSubDataAttribute(nsd73.querySelector(`ConstructedAttributes > ConstructedAttribute[name=\"${parent?.getAttribute('type')}\"] > SubDataAttribute`)!, bdaElementName);\n  }\n\n  /**\n   * Get the potential inherited data object based on a LNClass base.\n   * @param lnClassBase - The base of a LNClass element.\n   * @param doName - The name of the DO(I) to search for.\n   * @returns the DataObject in case found, otherwise null.\n   */\n  function getInheritedDataObject(lnClassBase: string, doName: string): Element | null {\n    if (!lnClassBase) return null;\n    const lnClass = nsd74.querySelector(`NS > LNClasses > AbstractLNClass[name=\"${lnClassBase}\"]`);\n    const base = lnClass?.getAttribute('base');\n\n    return lnClass?.querySelector(`DataObject[name=\"${doName}\"]`) ?? getInheritedDataObject(base!, doName);\n  }\n\n  return {\n    nsdoc72: nsdoc72,\n    nsdoc73: nsdoc73,\n    nsdoc74: nsdoc74,\n    nsdoc81: nsdoc81,\n    getDataDescription: function getDataDescription(element: Element, ancestors?: Element[]): { label: string; } {\n      return getDataDescriptions[element.tagName as keyof Record<IEDElementTagNames,\n        {\n          getDataDescription: GetDataDescription;\n        }\n        >].getDataDescription(element, ancestors);\n    }\n\n  }\n}\n\n/**\n * Get the documentation from a given nsdoc file.\n * @param nsdoc - The .nsdoc file to use for searching\n * @param id - The id of the doc to search for.\n * @returns - The documentation belonging to the id.\n */\nfunction getNsdocDocumentation(nsdoc: XMLDocument, id: string | null | undefined): string | null | undefined {\n  return nsdoc?.querySelector(`NSDoc > Doc[id=\"${id ?? ''}\"]`)?.textContent;\n}\n"]}