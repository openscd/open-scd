{"version":3,"file":"wizard-textfield.js","sourceRoot":"","sources":["../src/wizard-textfield.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  customElement,\n  html,\n  state,\n  property,\n  query,\n  TemplateResult,\n} from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-icon-button';\nimport '@material/mwc-list/mwc-list-item';\nimport '@material/mwc-menu';\nimport '@material/mwc-switch';\nimport { IconButton } from '@material/mwc-icon-button';\nimport { Menu } from '@material/mwc-menu';\nimport { SingleSelectedEvent } from '@material/mwc-list/mwc-list-foundation';\nimport { Switch } from '@material/mwc-switch';\nimport { TextField } from '@material/mwc-textfield';\n\n/** A potentially `nullable` `TextField` that allows for selection of an SI\n * `multiplier` if an SI `unit` is given.\n *\n * NB: Use `maybeValue: string | null` instead of `value` if `nullable`!*/\n@customElement('wizard-textfield')\nexport class WizardTextField extends TextField {\n  /** Whether [[`maybeValue`]] may be `null` */\n  @property({ type: Boolean })\n  nullable = false;\n  /** Selectable SI multipliers for a non-empty [[`unit`]]. */\n  @property({ type: Array })\n  multipliers = [null, ''];\n  private multiplierIndex = 0;\n  @property({ type: String })\n  get multiplier(): string | null {\n    if (this.unit == '') return null;\n    return (\n      this.multipliers[this.multiplierIndex] ?? this.multipliers[0] ?? null\n    );\n  }\n  set multiplier(value: string | null) {\n    const index = this.multipliers.indexOf(value);\n    if (index >= 0) this.multiplierIndex = index;\n    this.suffix = (this.multiplier ?? '') + this.unit;\n  }\n  /** SI Unit, must be non-empty to allow for selecting a [[`multiplier`]].\n   * Overrides `suffix`. */\n  @property({ type: String })\n  unit = '';\n  private isNull = false;\n  @state()\n  private get null(): boolean {\n    return this.nullable && this.isNull;\n  }\n  private set null(value: boolean) {\n    if (!this.nullable || value === this.isNull) return;\n    this.isNull = value;\n    if (this.null) this.disable();\n    else this.enable();\n  }\n  /** Replacement for `value`, can only be `null` if [[`nullable`]]. */\n  @property({ type: String })\n  get maybeValue(): string | null {\n    return this.null ? null : this.value;\n  }\n  set maybeValue(value: string | null) {\n    if (value === null) this.null = true;\n    else {\n      this.null = false;\n      this.value = value;\n    }\n  }\n  /** The default `value` displayed if [[`maybeValue`]] is `null`. */\n  @property({ type: String })\n  defaultValue = '';\n  /** Additional values that cause validation to fail. */\n  @property({ type: Array })\n  reservedValues: string[] = [];\n\n  // FIXME: workaround to allow disable of the whole component - need basic refactor\n  private disabledSwitch = false;\n\n  @query('mwc-switch') nullSwitch?: Switch;\n  @query('mwc-menu') multiplierMenu?: Menu;\n  @query('mwc-icon-button') multiplierButton?: IconButton;\n\n  private nulled: string | null = null;\n\n  private selectMultiplier(se: SingleSelectedEvent): void {\n    this.multiplier = this.multipliers[se.detail.index];\n  }\n\n  private enable(): void {\n    if (this.nulled === null) return;\n    this.value = this.nulled;\n    this.nulled = null;\n    this.helperPersistent = false;\n    this.disabled = false;\n  }\n\n  private disable(): void {\n    if (this.nulled !== null) return;\n    this.nulled = this.value;\n    this.value = this.defaultValue;\n    this.helperPersistent = true;\n    this.disabled = true;\n  }\n\n  async firstUpdated(): Promise<void> {\n    await super.firstUpdated();\n    if (this.multiplierMenu)\n      this.multiplierMenu.anchor =\n        (this.multiplierButton as HTMLElement) ?? null;\n  }\n\n  checkValidity(): boolean {\n    if (\n      this.reservedValues &&\n      this.reservedValues.some(array => array === this.value)\n    ) {\n      this.setCustomValidity(get('textfield.unique'));\n      return false;\n    }\n    this.setCustomValidity(''); //Reset. Otherwise super.checkValidity always falseM\n    return super.checkValidity();\n  }\n\n  constructor() {\n    super();\n\n    this.disabledSwitch = this.hasAttribute('disabled');\n  }\n\n  renderUnitSelector(): TemplateResult {\n    if (this.multipliers.length && this.unit)\n      return html`<div style=\"position:relative;\">\n        <mwc-icon-button\n          style=\"margin:5px;\"\n          icon=\"more\"\n          ?disabled=${this.null || this.disabledSwitch}\n          @click=${() => this.multiplierMenu?.show()}\n        ></mwc-icon-button>\n        <mwc-menu\n          @selected=${this.selectMultiplier}\n          fixed\n          .anchor=${this.multiplierButton ?? null}\n          >${this.renderMulplierList()}</mwc-menu\n        >\n      </div>`;\n    else return html``;\n  }\n\n  renderMulplierList(): TemplateResult {\n    return html`${this.multipliers.map(\n      multiplier =>\n        html`<mwc-list-item ?selected=${multiplier === this.multiplier}\n          >${multiplier === null\n            ? get('textfield.noMultiplier')\n            : multiplier}</mwc-list-item\n        >`\n    )}`;\n  }\n\n  renderSwitch(): TemplateResult {\n    if (this.nullable) {\n      return html`<mwc-switch\n        style=\"margin-left: 12px;\"\n        ?checked=${!this.null}\n        ?disabled=${this.disabledSwitch}\n        @change=${() => {\n          this.null = !this.nullSwitch!.checked;\n        }}\n      ></mwc-switch>`;\n    }\n    return html``;\n  }\n\n  render(): TemplateResult {\n    return html`\n      <div style=\"display: flex; flex-direction: row;\">\n        <div style=\"flex: auto;\">${super.render()}</div>\n        ${this.renderUnitSelector()}\n        <div style=\"display: flex; align-items: center; height: 56px;\">\n          ${this.renderSwitch()}\n        </div>\n      </div>\n    `;\n  }\n}\n"]}