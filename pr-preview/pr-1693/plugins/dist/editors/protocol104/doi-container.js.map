{"version":3,"file":"doi-container.js","sourceRoot":"","sources":["../../../src/editors/protocol104/doi-container.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  property,\n  query,\n  TemplateResult,\n} from 'lit-element';\nimport { get } from 'lit-translate';\nimport { nothing } from 'lit-html';\n\nimport { IconButtonToggle } from '@material/mwc-icon-button-toggle';\n\nimport '@material/mwc-icon';\nimport '@material/mwc-icon-button';\nimport '@material/mwc-icon-button-toggle';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item';\n\nimport { newWizardEvent } from '@openscd/open-scd/src/foundation.js';\n\nimport '@openscd/open-scd/src/action-pane.js';\n\nimport {\n  get104DetailsLine,\n  getCdcValueFromDOIElement,\n  getFullPath,\n} from './foundation/foundation.js';\nimport { editAddressWizard } from './wizards/address.js';\nimport { showDOIInfoWizard } from './wizards/doi.js';\nimport { PROTOCOL_104_PRIVATE } from './foundation/private.js';\nimport { Base104Container } from './base-container.js';\n\n/**\n * Container showing all the DAI Elements, related to the 104 Protocol, of the passed DOI Element in a list.\n * The DAI Element can be edited by pressing the Edit button at the end of the line.\n */\n@customElement('doi-104-container')\nexport class Doi104Container extends Base104Container {\n  @property()\n  element!: Element;\n\n  @query('#toggleButton')\n  toggleButton!: IconButtonToggle | undefined;\n\n  @property()\n  get daiElements(): Element[] {\n    return Array.from(this.element.querySelectorAll(`DAI`))\n      .filter(\n        daiElement =>\n          daiElement.querySelector(\n            `Private[type=\"${PROTOCOL_104_PRIVATE}\"] > Address`\n          ) !== null\n      )\n      .sort((dai1, dai2) =>\n        getFullPath(dai1, 'DOI').localeCompare(getFullPath(dai2, 'DOI'))\n      );\n  }\n\n  private getAddressElements(daiElement: Element): Element[] {\n    return Array.from(\n      daiElement.querySelectorAll(\n        `Private[type=\"${PROTOCOL_104_PRIVATE}\"] > Address`\n      )\n    ).sort(\n      (addr1, addr2) =>\n        (addr1.getAttribute('casdu') ?? '').localeCompare(\n          addr2.getAttribute('casdu') ?? ''\n        ) &&\n        (addr1.getAttribute('ioa') ?? '').localeCompare(\n          addr2.getAttribute('ioa') ?? ''\n        )\n    );\n  }\n\n  protected firstUpdated(): void {\n    this.requestUpdate();\n  }\n\n  private openEditAddressWizard(\n    daiElement: Element,\n    addressElement: Element\n  ): void {\n    const doiElement = daiElement.closest('DOI')!;\n    const iedElement = doiElement.closest('IED')!;\n    this.dispatchEvent(\n      newWizardEvent(\n        editAddressWizard(iedElement, doiElement, daiElement, addressElement)\n      )\n    );\n  }\n\n  private openEditTiWizard(): void {\n    this.dispatchEvent(newWizardEvent(showDOIInfoWizard(this.element)));\n  }\n\n  @property()\n  get header(): TemplateResult {\n    const fullPath = getFullPath(this.element, 'IED');\n    const cdc = getCdcValueFromDOIElement(this.element);\n\n    return html`${fullPath}${cdc ? html` (${cdc})` : nothing}`;\n  }\n\n  private renderAddressList(daiElement: Element): TemplateResult {\n    const addresses = this.getAddressElements(daiElement);\n    return html`${addresses.map(addressElement => {\n      return html`\n        <mwc-list-item graphic=\"icon\" hasMeta>\n          <span slot=\"graphic\">&nbsp;</span>\n          <span>${get104DetailsLine(daiElement, addressElement)}</span>\n          <span slot=\"meta\">\n            <mwc-icon-button\n              icon=\"edit\"\n              @click=${() =>\n                this.openEditAddressWizard(daiElement, addressElement)}\n            >\n            </mwc-icon-button>\n          </span>\n        </mwc-list-item>\n      `;\n    })}`;\n  }\n\n  private renderDaiList(): TemplateResult {\n    const daiElements = this.daiElements;\n    return html`${daiElements.map(daiElement => {\n      return html`\n        <mwc-list-item noninteractive>\n          <span>${getFullPath(daiElement, 'DOI')}</span>\n        </mwc-list-item>\n        ${this.renderAddressList(daiElement)}\n      `;\n    })}`;\n  }\n\n  render(): TemplateResult {\n    return html`\n      <action-pane .label=\"${this.header}\">\n        <abbr slot=\"action\" title=\"${get('edit')}\">\n          <mwc-icon-button\n            icon=\"info\"\n            @click=${() => this.openEditTiWizard()}\n          ></mwc-icon-button>\n        </abbr>\n        <abbr slot=\"action\" title=\"${get('protocol104.toggleChildElements')}\">\n          <mwc-icon-button-toggle\n            id=\"toggleButton\"\n            on\n            onIcon=\"keyboard_arrow_up\"\n            offIcon=\"keyboard_arrow_down\"\n            @click=${() => this.requestUpdate()}\n          >\n          </mwc-icon-button-toggle>\n        </abbr>\n        ${this.toggleButton?.on\n          ? html` <mwc-list id=\"dailist\"> ${this.renderDaiList()} </mwc-list>`\n          : nothing}\n      </action-pane>\n    `;\n  }\n\n  static styles = css`\n    abbr {\n      text-decoration: none;\n      border-bottom: none;\n    }\n\n    mwc-list-item {\n      --mdc-list-item-meta-size: 48px;\n    }\n  `;\n}\n"]}