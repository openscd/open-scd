{"version":3,"file":"general-equipment-editor.js","sourceRoot":"","sources":["../../../src/editors/substation/general-equipment-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  customElement,\n  html,\n  LitElement,\n  TemplateResult,\n  property,\n  state,\n  css,\n  query,\n} from 'lit-element';\n\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-icon-button';\nimport '@material/mwc-list/mwc-list-item';\nimport '@material/mwc-menu';\nimport '@material/mwc-fab';\nimport { IconButton } from '@material/mwc-icon-button';\nimport { ListItem } from '@material/mwc-list/mwc-list-item';\nimport { Menu } from '@material/mwc-menu';\n\nimport '@openscd/open-scd/src/action-pane.js';\nimport '../../editors/substation/eq-function-editor.js';\nimport '../../editors/substation/l-node-editor.js';\nimport { generalConductingEquipmentIcon } from '@openscd/open-scd/src/icons/icons.js';\nimport {\n  newWizardEvent,\n  SCLTag,\n  tags,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport {\n  getChildElementsByTagName,\n} from '@openscd/xml';\n\nimport { newActionEvent } from '@openscd/core/foundation/deprecated/editor.js';\nimport { emptyWizard, wizards } from '../../wizards/wizard-library.js';\n\nfunction childTags(element: Element | null | undefined): SCLTag[] {\n  if (!element) return [];\n\n  return tags[<SCLTag>element.tagName].children.filter(\n    child => wizards[child].create !== emptyWizard\n  );\n}\n\n@customElement('general-equipment-editor')\nexport class GeneralEquipmentEditor extends LitElement {\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  @property({ type: Number })\n  editCount = -1;\n  @property({ attribute: false })\n  element!: Element;\n\n  /** Whether `Function` and `SubFunction` are rendered */\n  @property({ type: Boolean })\n  showfunctions = false;\n\n  @state()\n  get header(): string {\n    const name = this.element.getAttribute('name') ?? '';\n    const desc = this.element.getAttribute('desc');\n\n    if (!this.showfunctions) return `${name}`;\n\n    return `${name} ${desc ? `â€”  ${desc}` : ''}`;\n  }\n\n  @query('mwc-menu') addMenu!: Menu;\n  @query('mwc-icon-button[icon=\"playlist_add\"]') addButton!: IconButton;\n\n  openEditWizard(): void {\n    const wizard = wizards['GeneralEquipment'].edit(this.element);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  private openCreateWizard(tagName: string): void {\n    const wizard = wizards[<SCLTag>tagName].create(this.element!);\n\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  updated(): void {\n    if (this.addMenu && this.addButton)\n      this.addMenu.anchor = <HTMLElement>this.addButton;\n  }\n\n  remove(): void {\n    if (this.element.parentElement)\n      this.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent: this.element.parentElement,\n            element: this.element,\n          },\n        })\n      );\n  }\n\n  private renderLNodes(): TemplateResult {\n    const lNodes = getChildElementsByTagName(this.element, 'LNode');\n\n    return lNodes.length\n      ? html`<div class=\"container lnode\">\n          ${lNodes.map(\n            lNode =>\n              html`<l-node-editor\n                .editCount=${this.editCount}\n                .doc=${this.doc}\n                .element=${lNode}\n              ></l-node-editor>`\n          )}\n        </div>`\n      : html``;\n  }\n\n  private renderEqFunctions(): TemplateResult {\n    const eFunctions = getChildElementsByTagName(this.element, 'EqFunction');\n\n    return eFunctions.length\n      ? html`${eFunctions.map(\n          eFunction =>\n            html` <eq-function-editor\n              .editCount=${this.editCount}\n              .doc=${this.doc}\n              .element=${eFunction}\n            ></eq-function-editor>`\n        )}`\n      : html``;\n  }\n\n  private renderAddButtons(): TemplateResult[] {\n    return childTags(this.element).map(\n      child =>\n        html`<mwc-list-item value=\"${child}\"\n          ><span>${child}</span></mwc-list-item\n        >`\n    );\n  }\n\n  render(): TemplateResult {\n    if (this.showfunctions)\n      return html`<action-pane label=${this.header}>\n        <abbr slot=\"action\" title=\"${get('edit')}\">\n          <mwc-icon-button\n            icon=\"edit\"\n            @click=${() => this.openEditWizard()}\n          ></mwc-icon-button>\n        </abbr>\n        <abbr slot=\"action\" title=\"${get('remove')}\">\n          <mwc-icon-button\n            icon=\"delete\"\n            @click=${() => this.remove()}\n          ></mwc-icon-button>\n        </abbr>\n        <abbr slot=\"action\" style=\"position:relative;\" title=\"${get('add')}\">\n          <mwc-icon-button\n            icon=\"playlist_add\"\n            @click=${() => (this.addMenu.open = true)}\n          ></mwc-icon-button\n          ><mwc-menu\n            corner=\"BOTTOM_RIGHT\"\n            menuCorner=\"END\"\n            @action=${(e: Event) => {\n              const tagName = (<ListItem>(<Menu>e.target).selected).value;\n              this.openCreateWizard(tagName);\n            }}\n            >${this.renderAddButtons()}</mwc-menu\n          ></abbr\n        >\n        ${this.renderLNodes()} ${this.renderEqFunctions()}\n      </action-pane>`;\n\n    return html`<action-icon label=${this.header}>\n      <mwc-icon slot=\"icon\">${generalConductingEquipmentIcon}</mwc-icon>\n      <mwc-fab\n        slot=\"action\"\n        mini\n        icon=\"edit\"\n        @click=\"${() => this.openEditWizard()}}\"\n      ></mwc-fab>\n      <mwc-fab\n        slot=\"action\"\n        mini\n        icon=\"delete\"\n        @click=\"${() => this.remove()}}\"\n      ></mwc-fab>\n    </action-icon>`;\n  }\n\n  static styles = css`\n    abbr {\n      text-decoration: none;\n      border-bottom: none;\n    }\n    .container.lnode {\n      display: grid;\n      grid-gap: 12px;\n      padding: 8px 12px 16px;\n      box-sizing: border-box;\n      grid-template-columns: repeat(auto-fit, minmax(64px, auto));\n    }\n  `;\n}\n"]}