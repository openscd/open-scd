{"version":3,"file":"gse.js","sourceRoot":"","sources":["../../src/wizards/gse.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,IAAI,EAAE,MAAM,aAAa,CAAC;AACnC,OAAO,EAAE,GAAG,EAAE,MAAM,eAAe,CAAC;AAIpC,OAAO,2CAA2C,CAAC;AACnD,OAAO,EACL,QAAQ,EACR,QAAQ,GAIT,MAAM,qCAAqC,CAAC;AAE7C,OAAO,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAE7C,OAAO,EAAE,qBAAqB,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAOpE,MAAM,UAAU,cAAc,CAC5B,IAA2B,EAC3B,OAAuB,EACvB,IAAmB,EACnB,GAAY;IAEZ,IAAI,OAAO,KAAK,IAAI,EAAE;QACpB,MAAM,OAAO,GAAG,aAAa,CAAC,GAAG,CAAC,aAAa,EAAE,IAAI,EAAE;YACrD,IAAI,EAAE,GAAG;YACT,UAAU,EAAE,GAAG;SAChB,CAAC,CAAC;QACH,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC;QAC3B,OAAO;YACL,GAAG,EAAE;gBACH,MAAM,EAAE,GAAG;gBACX,OAAO;gBACP,SAAS,EAAE,GAAG,CAAC,iBAAiB;aACjC;SACF,CAAC;KACH;IAED,IAAI,IAAI,KAAK,IAAI;QACf,OAAO;YACL,GAAG,EAAE;gBACH,MAAM,EAAE,GAAG;gBACX,OAAO,EAAE,OAAO;gBAChB,SAAS,EAAE,OAAO,CAAC,WAAW;aAC/B;SACF,CAAC;IAEJ,MAAM,OAAO,GAAY,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;IAClD,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC;IAC3B,OAAO;QACL,GAAG,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE;QACzB,GAAG,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE;KAC1B,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,eAAe,CAAC,OAAgB;IAC9C,OAAO,CAAC,MAA4B,EAAE,MAAe,EAAkB,EAAE;QACvE,MAAM,aAAa,GAAkB;YACnC,OAAO,EAAE,EAAE;YACX,KAAK,EAAE,GAAG,CAAC,uBAAuB,EAAE;gBAClC,QAAQ,EAAE,QAAQ,CAAC,OAAO,CAAC;aAC5B,CAAC;SACH,CAAC;QAEF,MAAM,QAAQ,GACD,MAAM,CAAC,UAAU,EAAE,aAAa,CAAC,WAAW,CAAE,EAAE,OAAO;YAClE,KAAK,CAAC;QAER,MAAM,cAAc,GAAkC,EAAE,CAAC;QACzD,cAAc,CAAC,aAAa,CAAC,GAAG,QAAQ,CACtC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,KAAK,aAAa,CAAE,CAC7C,CAAC;QACF,cAAc,CAAC,OAAO,CAAC,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,KAAK,OAAO,CAAE,CAAC,CAAC;QAC3E,cAAc,CAAC,SAAS,CAAC,GAAG,QAAQ,CAClC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,KAAK,SAAS,CAAE,CACzC,CAAC;QACF,cAAc,CAAC,eAAe,CAAC,GAAG,QAAQ,CACxC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,KAAK,eAAe,CAAE,CAC/C,CAAC;QAEF,MAAM,cAAc,GAAG,aAAa,CAAC,OAAO,EAAE,cAAc,EAAE,QAAQ,CAAC,CAAC;QAExE,cAAc,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;YAC9B,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,MAAM,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,KAAK,SAAS,CAAE,CAAC,CAAC;QACnE,MAAM,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,KAAK,SAAS,CAAE,CAAC,CAAC;QACnE,IACE,OAAO;YACP,CAAC,OAAO,CAAC,aAAa,CAAC,SAAS,CAAC,EAAE,WAAW,EAAE,IAAI,EAAE,IAAI,IAAI,CAAC,EAC/D;YACA,aAAa,CAAC,OAAO,CAAC,IAAI,CACxB,cAAc,CACZ,SAAS,EACT,OAAO,CAAC,aAAa,CAAC,SAAS,CAAC,EAChC,OAAO,EACP,OAAO,CACR,CACF,CAAC;SACH;QACD,IACE,OAAO;YACP,CAAC,OAAO,CAAC,aAAa,CAAC,SAAS,CAAC,EAAE,WAAW,EAAE,IAAI,EAAE,IAAI,IAAI,CAAC,EAC/D;YACA,aAAa,CAAC,OAAO,CAAC,IAAI,CACxB,cAAc,CACZ,SAAS,EACT,OAAO,CAAC,aAAa,CAAC,SAAS,CAAC,EAChC,OAAO,EACP,OAAO,CACR,CACF,CAAC;SACH;QAED,OAAO,CAAC,aAAa,CAAC,CAAC;IACzB,CAAC,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,aAAa,CAAC,OAAgB;IAC5C,MAAM,OAAO,GAAG,OAAO,CAAC,aAAa,CAAC,SAAS,CAAC,EAAE,SAAS,CAAC,IAAI,EAAE,IAAI,IAAI,CAAC;IAC3E,MAAM,OAAO,GAAG,OAAO,CAAC,aAAa,CAAC,SAAS,CAAC,EAAE,SAAS,CAAC,IAAI,EAAE,IAAI,IAAI,CAAC;IAE3E,MAAM,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAC1E,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,CACxC,CAAC;IAEF,MAAM,UAAU,GAAkC,EAAE,CAAC;IAErD,CAAC,aAAa,EAAE,OAAO,EAAE,SAAS,EAAE,eAAe,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;QACjE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC;YAClB,UAAU,CAAC,GAAG,CAAC;gBACb,OAAO,CAAC,aAAa,CAAC,qBAAqB,GAAG,IAAI,CAAC,EAAE,SAAS,CAAC,IAAI,EAAE;oBACrE,IAAI,CAAC;IACX,CAAC,CAAC,CAAC;IAEH,OAAO;QACL;YACE,KAAK,EAAE,GAAG,CAAC,mBAAmB,EAAE,EAAE,OAAO,EAAE,OAAO,CAAC,OAAO,EAAE,CAAC;YAC7D,OAAO;YACP,OAAO,EAAE;gBACP,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC;gBAClB,IAAI,EAAE,MAAM;gBACZ,MAAM,EAAE,eAAe,CAAC,OAAO,CAAC;aACjC;YACD,OAAO,EAAE;gBACP,GAAG,qBAAqB,CAAC,EAAE,WAAW,EAAE,UAAU,EAAE,CAAC;gBACrD,IAAI,CAAA;;wBAEY,OAAO;;;;6BAIF;gBACrB,IAAI,CAAA;;wBAEY,OAAO;;;;6BAIF;aACtB;SACF;KACF,CAAC;AACJ,CAAC","sourcesContent":["import { html } from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport { Checkbox } from '@material/mwc-checkbox';\n\nimport '@openscd/open-scd/src/wizard-textfield.js';\nimport {\n  getValue,\n  identity,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport { createElement } from '@openscd/xml';\n\nimport { contentGseOrSmvWizard, updateAddress } from './address.js';\nimport {\n  ComplexAction,\n  SimpleAction,\n  EditorAction,\n} from '@openscd/core/foundation/deprecated/editor.js';\n\nexport function getMTimeAction(\n  type: 'MinTime' | 'MaxTime',\n  oldTime: Element | null,\n  Time: string | null,\n  gse: Element\n): SimpleAction {\n  if (oldTime === null) {\n    const element = createElement(gse.ownerDocument, type, {\n      unit: 's',\n      multiplier: 'm',\n    });\n    element.textContent = Time;\n    return {\n      new: {\n        parent: gse,\n        element,\n        reference: gse.firstElementChild,\n      },\n    };\n  }\n\n  if (Time === null)\n    return {\n      old: {\n        parent: gse,\n        element: oldTime,\n        reference: oldTime.nextSibling,\n      },\n    };\n\n  const newTime = <Element>oldTime.cloneNode(false);\n  newTime.textContent = Time;\n  return {\n    old: { element: oldTime },\n    new: { element: newTime },\n  };\n}\n\nexport function updateGSEAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[], wizard: Element): EditorAction[] => {\n    const complexAction: ComplexAction = {\n      actions: [],\n      title: get('gse.action.addaddress', {\n        identity: identity(element),\n      }),\n    };\n\n    const instType: boolean =\n      (<Checkbox>wizard.shadowRoot?.querySelector('#instType'))?.checked ??\n      false;\n\n    const addressContent: Record<string, string | null> = {};\n    addressContent['MAC-Address'] = getValue(\n      inputs.find(i => i.label === 'MAC-Address')!\n    );\n    addressContent['APPID'] = getValue(inputs.find(i => i.label === 'APPID')!);\n    addressContent['VLAN-ID'] = getValue(\n      inputs.find(i => i.label === 'VLAN-ID')!\n    );\n    addressContent['VLAN-PRIORITY'] = getValue(\n      inputs.find(i => i.label === 'VLAN-PRIORITY')!\n    );\n\n    const addressActions = updateAddress(element, addressContent, instType);\n\n    addressActions.forEach(action => {\n      complexAction.actions.push(action);\n    });\n\n    const MinTime = getValue(inputs.find(i => i.label === 'MinTime')!);\n    const MaxTime = getValue(inputs.find(i => i.label === 'MaxTime')!);\n    if (\n      MinTime !==\n      (element.querySelector('MinTime')?.textContent?.trim() ?? null)\n    ) {\n      complexAction.actions.push(\n        getMTimeAction(\n          'MinTime',\n          element.querySelector('MinTime'),\n          MinTime,\n          element\n        )\n      );\n    }\n    if (\n      MaxTime !==\n      (element.querySelector('MaxTime')?.textContent?.trim() ?? null)\n    ) {\n      complexAction.actions.push(\n        getMTimeAction(\n          'MaxTime',\n          element.querySelector('MaxTime'),\n          MaxTime,\n          element\n        )\n      );\n    }\n\n    return [complexAction];\n  };\n}\n\nexport function editGseWizard(element: Element): Wizard {\n  const minTime = element.querySelector('MinTime')?.innerHTML.trim() ?? null;\n  const maxTime = element.querySelector('MaxTime')?.innerHTML.trim() ?? null;\n\n  const hasInstType = Array.from(element.querySelectorAll('Address > P')).some(\n    pType => pType.getAttribute('xsi:type')\n  );\n\n  const attributes: Record<string, string | null> = {};\n\n  ['MAC-Address', 'APPID', 'VLAN-ID', 'VLAN-PRIORITY'].forEach(key => {\n    if (!attributes[key])\n      attributes[key] =\n        element.querySelector(`Address > P[type=\"${key}\"]`)?.innerHTML.trim() ??\n        null;\n  });\n\n  return [\n    {\n      title: get('wizard.title.edit', { tagName: element.tagName }),\n      element,\n      primary: {\n        label: get('save'),\n        icon: 'save',\n        action: updateGSEAction(element),\n      },\n      content: [\n        ...contentGseOrSmvWizard({ hasInstType, attributes }),\n        html`<wizard-textfield\n          label=\"MinTime\"\n          .maybeValue=${minTime}\n          nullable\n          suffix=\"ms\"\n          type=\"number\"\n        ></wizard-textfield>`,\n        html`<wizard-textfield\n          label=\"MaxTime\"\n          .maybeValue=${maxTime}\n          nullable\n          suffix=\"ms\"\n          type=\"number\"\n        ></wizard-textfield>`,\n      ],\n    },\n  ];\n}\n"]}