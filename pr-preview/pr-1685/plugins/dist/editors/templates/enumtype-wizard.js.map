{"version":3,"file":"enumtype-wizard.js","sourceRoot":"","sources":["../../../src/editors/templates/enumtype-wizard.ts"],"names":[],"mappings":"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","sourcesContent":["import { html } from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-button';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item';\nimport '@material/mwc-select';\nimport { List } from '@material/mwc-list';\nimport { ListItem } from '@material/mwc-list/mwc-list-item';\nimport { SingleSelectedEvent } from '@material/mwc-list/mwc-list-foundation';\nimport { Select } from '@material/mwc-select';\n\nimport '@openscd/open-scd/src/wizard-textfield.js';\nimport {\n  find,\n  getValue,\n  identity,\n  newSubWizardEvent,\n  newWizardEvent,\n  patterns,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n  WizardMenuActor,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport { cloneElement, createElement } from '@openscd/xml';\n\nimport {\n  EditorAction,\n  newActionEvent,\n  Replace,\n} from '@openscd/core/foundation/deprecated/editor.js';\nimport { CreateOptions, UpdateOptions, WizardOptions } from './foundation.js';\n\nfunction remove(element: Element): WizardMenuActor {\n  return (wizard: Element): void => {\n    wizard.dispatchEvent(\n      newActionEvent({ old: { parent: element.parentElement!, element } })\n    );\n    wizard.dispatchEvent(newWizardEvent());\n  };\n}\n\nfunction nextOrd(parent: Element): string {\n  const maxOrd = Math.max(\n    ...Array.from(parent.children).map(child =>\n      parseInt(child.getAttribute('ord') ?? '-2', 10)\n    )\n  );\n  return isFinite(maxOrd) ? (maxOrd + 1).toString(10) : '0';\n}\n\nfunction createEnumValAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditorAction[] => {\n    const value = getValue(inputs.find(i => i.label === 'value')!);\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const ord =\n      getValue(inputs.find(i => i.label === 'ord')!) || nextOrd(parent);\n\n    const element = createElement(parent.ownerDocument, 'EnumVal', {\n      ord,\n      desc,\n    });\n\n    element.textContent = value;\n\n    const action = {\n      new: {\n        parent,\n        element,\n      },\n    };\n\n    return [action];\n  };\n}\n\nfunction updateEnumValAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditorAction[] => {\n    const value = getValue(inputs.find(i => i.label === 'value')!) ?? '';\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const ord =\n      getValue(inputs.find(i => i.label === 'ord')!) ||\n      element.getAttribute('ord') ||\n      nextOrd(element.parentElement!);\n\n    if (\n      value === element.textContent &&\n      desc === element.getAttribute('desc') &&\n      ord === element.getAttribute('ord')\n    )\n      return [];\n\n    const newElement = cloneElement(element, { desc, ord });\n    newElement.textContent = value;\n\n    return [{ old: { element }, new: { element: newElement } }];\n  };\n}\n\nfunction eNumValWizard(options: WizardOptions): Wizard {\n  const doc = (<UpdateOptions>options).doc\n    ? (<UpdateOptions>options).doc\n    : (<CreateOptions>options).parent.ownerDocument;\n  const enumval = find(\n    doc,\n    'EnumVal',\n    (<UpdateOptions>options).identity ?? NaN\n  );\n\n  const [title, action, ord, desc, value, menuActions] = enumval\n    ? [\n        get('enum-val.wizard.title.edit'),\n        updateEnumValAction(enumval),\n        enumval.getAttribute('ord'),\n        enumval.getAttribute('desc'),\n        enumval.textContent,\n        [\n          {\n            icon: 'delete',\n            label: get('remove'),\n            action: remove(enumval),\n          },\n        ],\n      ]\n    : [\n        get('enum-val.wizard.title.add'),\n        createEnumValAction((<CreateOptions>options).parent),\n        nextOrd((<CreateOptions>options).parent),\n        null, // desc is uncommon on EnumVal\n        '',\n        undefined,\n      ];\n\n  return [\n    {\n      title,\n      element: enumval ?? undefined,\n      primary: {\n        icon: '',\n        label: 'Save',\n        action: action,\n      },\n      menuActions,\n      content: [\n        html`<wizard-textfield\n          label=\"ord\"\n          helper=\"${get('scl.ord')}\"\n          .maybeValue=${ord}\n          required\n          type=\"number\"\n        ></wizard-textfield>`,\n        html`<wizard-textfield\n          label=\"value\"\n          helper=\"${get('scl.value')}\"\n          .maybeValue=${value}\n          pattern=\"${patterns.normalizedString}\"\n          dialogInitialFocus\n        ></wizard-textfield>`,\n        html`<wizard-textfield\n          id=\"evDesc\"\n          label=\"desc\"\n          helper=\"${get('scl.desc')}\"\n          .maybeValue=${desc}\n          nullable\n          pattern=\"${patterns.normalizedString}\"\n        ></wizard-textfield>`,\n      ],\n    },\n  ];\n}\n\nfunction createAction(parent: Element, templates: XMLDocument): WizardActor {\n  return (inputs: WizardInputElement[]): EditorAction[] => {\n    const id = getValue(inputs.find(i => i.label === 'id')!);\n\n    if (!id) return [];\n\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const values = <Select>inputs.find(i => i.label === 'values');\n    const element = values.selected\n      ? <Element>(\n          templates\n            .querySelector(`EnumType[id=\"${values.selected.value}\"]`)!\n            .cloneNode(true)\n        )\n      : createElement(parent.ownerDocument, 'EnumType', {});\n\n    element.setAttribute('id', id);\n    if (desc) element.setAttribute('desc', desc);\n\n    const action = {\n      new: {\n        parent,\n        element,\n      },\n    };\n\n    return [action];\n  };\n}\n\nexport function createEnumTypeWizard(\n  parent: Element,\n  templates: Document\n): Wizard {\n  return [\n    {\n      title: get('enum.wizard.title.add'),\n      primary: {\n        icon: 'add',\n        label: get('add'),\n        action: createAction(parent, templates),\n      },\n      content: [\n        html`<mwc-select\n          style=\"--mdc-menu-max-height: 196px;\"\n          outlined\n          icon=\"playlist_add_check\"\n          label=\"values\"\n          helper=\"Default enumerations\"\n        >\n          ${Array.from(templates.querySelectorAll('EnumType')).map(\n            e =>\n              html`<mwc-list-item\n                graphic=\"icon\"\n                hasMeta\n                value=\"${e.getAttribute('id') ?? ''}\"\n                ><span>${e.getAttribute('id')}</span>\n                <span slot=\"meta\">${e.querySelectorAll('EnumVal').length}</span>\n              </mwc-list-item>`\n          )}\n        </mwc-select>`,\n        html`<wizard-textfield\n          label=\"id\"\n          helper=\"${get('scl.id')}\"\n          .maybeValue=${''}\n          required\n          maxlength=\"127\"\n          minlength=\"1\"\n          pattern=\"${patterns.nmToken}\"\n          dialogInitialFocus\n        ></wizard-textfield>`,\n        html`<wizard-textfield\n          label=\"desc\"\n          helper=\"${get('scl.desc')}\"\n          .maybeValue=${null}\n          nullable\n          pattern=\"${patterns.normalizedString}\"\n        ></wizard-textfield>`,\n      ],\n    },\n  ];\n}\n\nfunction openAddEnumVal(parent: Element): WizardMenuActor {\n  return (wizard: Element): void => {\n    wizard.dispatchEvent(newSubWizardEvent(() => eNumValWizard({ parent })));\n  };\n}\n\nfunction updateEnumTpyeAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditorAction[] => {\n    const id = getValue(inputs.find(i => i.label === 'id')!)!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n\n    if (\n      id === element.getAttribute('id') &&\n      desc === element.getAttribute('desc')\n    )\n      return [];\n\n    const newElement = cloneElement(element, { id, desc });\n\n    const actions: Replace[] = [];\n    actions.push({ old: { element }, new: { element: newElement } });\n\n    const oldId = element.getAttribute('id')!;\n    Array.from(\n      element.ownerDocument.querySelectorAll(\n        `DOType > DA[type=\"${oldId}\"], DAType > BDA[type=\"${oldId}\"]`\n      )\n    ).forEach(oldDa => {\n      const newDa = <Element>oldDa.cloneNode(false);\n      newDa.setAttribute('type', id);\n\n      actions.push({ old: { element: oldDa }, new: { element: newDa } });\n    });\n\n    return [{ title: get('enum.action.edit', { oldId, newId: id }), actions }];\n  };\n}\n\nexport function eNumTypeEditWizard(\n  eNumTypeIdentity: string,\n  doc: XMLDocument\n): Wizard | undefined {\n  const enumtype = find(doc, 'EnumType', eNumTypeIdentity);\n  if (!enumtype) return undefined;\n\n  return [\n    {\n      title: get('enum.wizard.title.edit'),\n      element: enumtype,\n      primary: {\n        icon: '',\n        label: get('save'),\n        action: updateEnumTpyeAction(enumtype),\n      },\n      menuActions: [\n        {\n          label: get('remove'),\n          icon: 'delete',\n          action: remove(enumtype),\n        },\n        {\n          label: get('scl.EnumVal'),\n          icon: 'playlist_add',\n          action: openAddEnumVal(enumtype),\n        },\n      ],\n      content: [\n        html`<wizard-textfield\n          label=\"id\"\n          helper=\"${get('scl.id')}\"\n          .maybeValue=${enumtype.getAttribute('id')}\n          required\n          maxlength=\"127\"\n          minlength=\"1\"\n          pattern=\"${patterns.nmToken}\"\n          dialogInitialFocus\n        ></wizard-textfield>`,\n        html`<wizard-textfield\n          label=\"desc\"\n          helper=\"${get('scl.desc')}\"\n          .maybeValue=${enumtype.getAttribute('desc')}\n          nullable\n          pattern=\"${patterns.normalizedString}\"\n        ></wizard-textfield>`,\n        html`<mwc-list\n          style=\"margin-top: 0px;\"\n          @selected=${(e: SingleSelectedEvent) => {\n            const wizard = eNumValWizard({\n              identity: (<ListItem>(<List>e.target).selected).value,\n              doc,\n            });\n            if (wizard) e.target!.dispatchEvent(newSubWizardEvent(wizard));\n          }}\n          >${Array.from(enumtype.querySelectorAll('EnumVal')).map(\n            enumval =>\n              html`<mwc-list-item\n                graphic=\"icon\"\n                hasMeta\n                tabindex=\"0\"\n                value=\"${identity(enumval)}\"\n              >\n                <span>${enumval.textContent ?? ''}</span>\n                <span slot=\"graphic\"\n                  >${enumval.getAttribute('ord') ?? '-1'}</span\n                >\n              </mwc-list-item>`\n          )}</mwc-list\n        > `,\n      ],\n    },\n  ];\n}\n"]}