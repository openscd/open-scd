{"version":3,"file":"foundation.js","sourceRoot":"","sources":["../../../src/editors/communication/foundation.ts"],"names":[],"mappings":"AAAA;;;;GAIG;AACH,MAAM,UAAU,qBAAqB,CAAC,OAAgB;IACpD,OAAO,OAAO,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;AACxC,CAAC;AAED;;;;;;GAMG;AACH,MAAM,UAAU,2BAA2B,CACzC,OAAgB,EAChB,GAAgB;IAEhB,IAAI,CAAC,OAAO,IAAI,CAAC,GAAG,EAAE;QACpB,OAAO,EAAE,CAAC;KACX;IAED,MAAM,kBAAkB,GAAG,qBAAqB,CAAC,OAAO,CAAC,CAAC;IAC1D,IAAI,CAAC,kBAAkB,EAAE;QACvB,OAAO,EAAE,CAAC;KACX;IAED,MAAM,OAAO,GAAG,kBAAkB,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;IAE3D,OAAO,KAAK,CAAC,IAAI,CACf,GAAG,CAAC,gBAAgB,CAAC,oCAAoC,OAAO,EAAE,CAAC,CACpE,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,wCAAwC,CACtD,oBAA6B,EAC7B,WAAoB,EACpB,GAAgB;IAEhB,MAAM,kBAAkB,GAAG,qBAAqB,CAAC,oBAAoB,CAAC,CAAC;IAEvE,IAAI,CAAC,kBAAkB,IAAI,kBAAkB,KAAK,WAAW,EAAE;QAC7D,OAAO,KAAK,CAAC;KACd;IAED,MAAM,MAAM,GAAG,kBAAkB,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;IACzD,MAAM,OAAO,GAAG,kBAAkB,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;IAE3D,IAAI,CAAC,MAAM,IAAI,CAAC,OAAO,EAAE;QACvB,OAAO,KAAK,CAAC;KACd;IAED,MAAM,GAAG,GAAG,GAAG,CAAC,aAAa,CAAC,YAAY,OAAO,GAAG,CAAC,CAAC;IAEtD,IAAI,CAAC,GAAG,EAAE;QACR,OAAO,KAAK,CAAC;KACd;IAED,MAAM,YAAY,GAAG,WAAW,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;IACxD,MAAM,QAAQ,GAAG,GAAG,CAAC,aAAa,CAAC,6BAA6B,YAAY,GAAG,CAAC,CAAC;IAEjF,IAAI,CAAC,QAAQ,EAAE;QACb,OAAO,KAAK,CAAC;KACd;IAED,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,iBAAiB,CAAC,KAAK,IAAI,CAAC;IACrE,MAAM,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,4BAA4B,MAAM,GAAG,CAAC,KAAK,IAAI,CAAC;IAE3F,OAAO,SAAS,IAAI,WAAW,CAAC;AAClC,CAAC","sourcesContent":["/**\r\n * Returns the first element of type ConnectedAP in the provided element's hierarchy.\r\n * @param element - The reference element to search from\r\n * @returns An element of type ConnectedAP or null\r\n */\r\nexport function getCurrentConnectedAP(element: Element): Element | null {\r\n  return element.closest('ConnectedAP');\r\n}\r\n\r\n/**\r\n * Retrieves all ConnectedAP elements within the same IED as the provided element.\r\n *\r\n * @param element - The reference element to find the current ConnectedAP and its IED.\r\n * @param doc - The XML document containing the SubNetwork and ConnectedAP elements.\r\n * @returns An array of ConnectedAP elements belonging to the same IED as the provided element.\r\n */\r\nexport function getAllConnectedAPsOfSameIED(\r\n  element: Element,\r\n  doc: XMLDocument\r\n): Element[] {\r\n  if (!element || !doc) {\r\n    return [];\r\n  }\r\n\r\n  const currentConnectedAP = getCurrentConnectedAP(element);\r\n  if (!currentConnectedAP) {\r\n    return [];\r\n  }\r\n\r\n  const iedName = currentConnectedAP.getAttribute('iedName');\r\n\r\n  return Array.from(\r\n    doc.querySelectorAll(`SubNetwork > ConnectedAP[iedName=${iedName}`)\r\n  );\r\n}\r\n\r\nexport function canMoveCommunicationElementToConnectedAP(\r\n  communicationElement: Element,\r\n  connectedAP: Element,\r\n  doc: XMLDocument\r\n): boolean {\r\n  const currentConnectedAP = getCurrentConnectedAP(communicationElement);\r\n\r\n  if (!currentConnectedAP || currentConnectedAP === connectedAP) {\r\n    return false;\r\n  }\r\n\r\n  const apName = currentConnectedAP.getAttribute('apName');\r\n  const iedName = currentConnectedAP.getAttribute('iedName');\r\n\r\n  if (!apName || !iedName) {\r\n    return false;\r\n  }\r\n\r\n  const ied = doc.querySelector(`IED[name=${iedName}]`);\r\n\r\n  if (!ied) {\r\n    return false;\r\n  }\r\n\r\n  const targetApName = connectedAP.getAttribute('apName');\r\n  const targetAp = ied.querySelector(`:scope > AccessPoint[name=${targetApName}]`);\r\n\r\n  if (!targetAp) {\r\n    return false;\r\n  }\r\n\r\n  const hasServer = targetAp.querySelector(':scope > Server') !== null;\r\n  const hasServerAt = targetAp.querySelector(`:scope > ServerAt[apName=${apName}]`) !== null;\r\n\r\n  return hasServer || hasServerAt;\r\n}\r\n"]}