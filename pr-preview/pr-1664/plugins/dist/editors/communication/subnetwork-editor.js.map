{"version":3,"file":"subnetwork-editor.js","sourceRoot":"","sources":["../../../src/editors/communication/subnetwork-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  LitElement,\n  TemplateResult,\n  customElement,\n  html,\n  property,\n  css,\n} from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-icon-button';\n\nimport './connectedap-editor.js';\nimport './gse-editor.js';\nimport './smv-editor.js';\nimport {\n  newWizardEvent,\n  compareNames,\n} from '@openscd/open-scd/src/foundation.js';\nimport { newActionEvent } from '@openscd/core/foundation/deprecated/editor.js';\nimport { createConnectedApWizard } from '../../wizards/connectedap.js';\nimport { wizards } from '../../wizards/wizard-library.js';\n\n/** [[`Communication`]] subeditor for a `SubNetwork` element. */\n@customElement('subnetwork-editor')\nexport class SubNetworkEditor extends LitElement {\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  @property({ type: Number })\n  editCount = -1;\n  /** SCL element SubNetwork */\n  @property({ attribute: false })\n  element!: Element;\n  /** SubNetwork attribute name */\n  @property({ type: String })\n  get name(): string {\n    return this.element.getAttribute('name') ?? 'UNDEFINED';\n  }\n  /** SubNetwork attribute desc */\n  @property({ type: String })\n  get desc(): string | null {\n    return this.element.getAttribute('desc') ?? null;\n  }\n  /** SubNetwork attribute type */\n  @property({ type: String })\n  get type(): string | null {\n    return this.element.getAttribute('type') ?? null;\n  }\n  /** SubNetwork child elements BitRate label */\n  @property({ type: String })\n  get bitrate(): string | null {\n    const bitRate = this.element.querySelector('BitRate');\n    if (bitRate === null) return null;\n    const bitRateValue = bitRate.textContent ?? '';\n    const m = bitRate.getAttribute('multiplier');\n    const unit = ` ${m ?? ''}b/s`;\n    return bitRateValue ? bitRateValue + unit : null;\n  }\n\n  private openConnectedAPwizard(): void {\n    this.dispatchEvent(newWizardEvent(createConnectedApWizard(this.element)));\n  }\n\n  private openEditWizard(): void {\n    const wizard = wizards['SubNetwork'].edit(this.element);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  remove(): void {\n    if (this.element)\n      this.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent: this.element.parentElement!,\n            element: this.element,\n            reference: this.element.nextSibling,\n          },\n        })\n      );\n  }\n\n  private renderSmvEditors(iedName: string): TemplateResult[] {\n    return Array.from(\n      this.element\n        .closest('Communication')\n        ?.querySelectorAll(`ConnectedAP[iedName=\"${iedName}\"] > SMV`) ?? []\n    ).map(\n      smv => html`<smv-editor\n        class=\"${smv.closest('SubNetwork') !== this.element ? 'disabled' : ''}\"\n        .editCount=${this.editCount}\n        .doc=${this.doc}\n        .element=${smv}\n      ></smv-editor>`\n    );\n  }\n\n  private renderGseEditors(iedName: string): TemplateResult[] {\n    return Array.from(\n      this.element\n        .closest('Communication')\n        ?.querySelectorAll(`ConnectedAP[iedName=\"${iedName}\"] > GSE`) ?? []\n    ).map(\n      gse => html`<gse-editor\n        class=\"${gse.closest('SubNetwork') !== this.element ? 'disabled' : ''}\"\n        .editCount=${this.editCount}\n        .doc=${this.doc}\n        .element=${gse}\n      ></gse-editor>`\n    );\n  }\n\n  private renderConnectedApEditors(iedName: string): TemplateResult[] {\n    return Array.from(\n      this.element.parentElement?.querySelectorAll(\n        `:scope > SubNetwork > ConnectedAP[iedName=\"${iedName}\"]`\n      ) ?? []\n    ).map(\n      connectedAP =>\n        html`<connectedap-editor\n          class=\"${connectedAP.parentElement !== this.element\n            ? 'disabled'\n            : ''}\"\n          .element=${connectedAP}\n        ></connectedap-editor>`\n    );\n  }\n\n  private renderIEDs(): TemplateResult[] {\n    return Array.from(this.element.querySelectorAll(':scope > ConnectedAP'))\n      .map(connAP => connAP.getAttribute('iedName')!)\n      .filter((v, i, a) => a.indexOf(v) === i)\n      .sort(compareNames)\n      .map(\n        iedName => html` <action-pane id=\"iedSection\" label=\"${iedName}\">\n          ${this.renderConnectedApEditors(iedName)}${this.renderGseEditors(\n            iedName\n          )}${this.renderSmvEditors(iedName)}\n        </action-pane>`\n      );\n  }\n\n  private subNetworkSpecs(): string {\n    if (!this.type && !this.bitrate) return '';\n\n    return `(${[this.type, this.bitrate].filter(text => !!text).join(' — ')})`;\n  }\n\n  private header(): string {\n    return `${this.name} ${this.desc === null ? '' : `— ${this.desc}`}\n    ${this.subNetworkSpecs()}`;\n  }\n\n  render(): TemplateResult {\n    return html`<action-pane label=\"${this.header()}\">\n      <abbr slot=\"action\" title=\"${get('edit')}\">\n        <mwc-icon-button\n          icon=\"edit\"\n          @click=${() => this.openEditWizard()}\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=\"${get('remove')}\">\n        <mwc-icon-button\n          icon=\"delete\"\n          @click=${() => this.remove()}\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=\"${get('add')}\">\n        <mwc-icon-button\n          icon=\"playlist_add\"\n          @click=\"${() => this.openConnectedAPwizard()}\"\n        ></mwc-icon-button>\n      </abbr>\n      <div id=\"iedContainer\">${this.renderIEDs()}</div>\n    </action-pane> `;\n  }\n\n  static styles = css`\n    #iedContainer {\n      display: grid;\n      box-sizing: border-box;\n      gap: 12px;\n      padding: 8px 12px 16px;\n      grid-template-columns: repeat(auto-fit, minmax(150px, auto));\n    }\n\n    #iedSection:not(:focus):not(:focus-within) .disabled {\n      display: none;\n    }\n\n    #iedSection:not(:focus):not(:focus-within) gse-editor {\n      display: none;\n    }\n\n    #iedSection:not(:focus):not(:focus-within) smv-editor {\n      display: none;\n    }\n\n    #iedSection .disabled {\n      pointer-events: none;\n      opacity: 0.5;\n    }\n\n    abbr {\n      text-decoration: none;\n      border-bottom: none;\n    }\n  `;\n}\n"]}