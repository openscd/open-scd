{"version":3,"file":"l-node-editor.js","sourceRoot":"","sources":["../../../src/editors/substation/l-node-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  html,\n  LitElement,\n  TemplateResult,\n  property,\n  customElement,\n  state,\n} from 'lit-element';\n\nimport '@openscd/open-scd/src/action-icon.js';\nimport {\n  identity,\n  newLnInstGenerator,\n  newWizardEvent,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport {\n  cloneElement,\n} from '@openscd/xml';\n\nimport { newActionEvent } from '@openscd/core/foundation/deprecated/editor.js';\nimport {\n  automationLogicalNode,\n  controlLogicalNode,\n  functionalLogicalNode,\n  furtherPowerSystemEquipmentLogicalNode,\n  generalLogicalNode,\n  interfacingLogicalNode,\n  measurementLogicalNode,\n  nonElectricalLogicalNode,\n  powerTransformerLogicalNode,\n  protectionLogicalNode,\n  protectionRelatedLogicalNode,\n  qualityLogicalNode,\n  supervisionLogicalNode,\n  switchgearLogicalNode,\n  systemLogicalNode,\n  transformerLogicalNode,\n} from '@openscd/open-scd/src/icons/lnode.js';\nimport { wizards } from '../../wizards/wizard-library.js';\n\nexport function getLNodeIcon(lNode: Element): TemplateResult {\n  const lnClassGroup = lNode.getAttribute('lnClass')?.charAt(0) ?? '';\n  return lnClassIcons[lnClassGroup] ?? systemLogicalNode;\n}\n\nconst lnClassIcons: Partial<Record<string, TemplateResult>> = {\n  L: systemLogicalNode,\n  A: automationLogicalNode,\n  C: controlLogicalNode,\n  F: functionalLogicalNode,\n  G: generalLogicalNode,\n  I: interfacingLogicalNode,\n  K: nonElectricalLogicalNode,\n  M: measurementLogicalNode,\n  P: protectionLogicalNode,\n  Q: qualityLogicalNode,\n  R: protectionRelatedLogicalNode,\n  S: supervisionLogicalNode,\n  T: transformerLogicalNode,\n  X: switchgearLogicalNode,\n  Y: powerTransformerLogicalNode,\n  Z: furtherPowerSystemEquipmentLogicalNode,\n};\n\n/** Pane rendering `LNode` element with its children */\n@customElement('l-node-editor')\nexport class LNodeEditor extends LitElement {\n  /** The document being edited as provided to editor by [[`Zeroline`]]. */\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  /** The edited `LNode` element */\n  @property({ attribute: false })\n  element!: Element;\n  @state()\n  private get header(): string {\n    const prefix = this.element.getAttribute('prefix') ?? '';\n    const lnClass = this.element.getAttribute('lnClass');\n    const lnInst = this.element.getAttribute('lnInst');\n\n    const header = this.missingIedReference\n      ? `${prefix} ${lnClass} ${lnInst}`\n      : identity(this.element);\n\n    return typeof header === 'string' ? header : '';\n  }\n  @state()\n  private get missingIedReference(): boolean {\n    return this.element.getAttribute('iedName') === 'None' ?? false;\n  }\n  @state()\n  private get isIEDReference(): boolean {\n    return this.element.getAttribute('iedName') !== 'None';\n  }\n\n  private cloneLNodeElement(): void {\n    const lnClass = this.element.getAttribute('lnClass');\n    if (!lnClass) return;\n\n    const uniqueLnInst = newLnInstGenerator(this.element.parentElement!)(\n      lnClass\n    );\n    if (!uniqueLnInst) return;\n\n    const newElement = cloneElement(this.element, { lnInst: uniqueLnInst });\n    this.dispatchEvent(\n      newActionEvent({\n        new: { parent: this.element.parentElement!, element: newElement },\n      })\n    );\n  }\n\n  private openEditWizard(): void {\n    const wizard = wizards['LNode'].edit(this.element);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  remove(): void {\n    if (this.element)\n      this.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent: this.element.parentElement!,\n            element: this.element,\n          },\n        })\n      );\n  }\n\n  render(): TemplateResult {\n    return html`<action-icon\n      label=\"${this.header}\"\n      ?secondary=${this.missingIedReference}\n      ?highlighted=${this.missingIedReference}\n      ><mwc-icon slot=\"icon\">${getLNodeIcon(this.element)}</mwc-icon\n      ><mwc-fab\n        slot=\"action\"\n        mini\n        icon=\"edit\"\n        @click=\"${() => this.openEditWizard()}}\"\n      ></mwc-fab\n      ><mwc-fab\n        slot=\"action\"\n        mini\n        icon=\"delete\"\n        @click=\"${() => this.remove()}}\"\n      ></mwc-fab\n      >${this.isIEDReference\n        ? html``\n        : html`<mwc-fab\n            slot=\"action\"\n            mini\n            icon=\"content_copy\"\n            @click=${() => this.cloneLNodeElement()}\n          ></mwc-fab>`}\n    </action-icon>`;\n  }\n}\n"]}