{"version":3,"file":"bda.js","sourceRoot":"","sources":["../../src/wizards/bda.ts"],"names":[],"mappings":"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","sourcesContent":["import { get } from 'lit-translate';\n\nimport '@material/mwc-button';\n\nimport {\n  getValue,\n  isPublic,\n  newWizardEvent,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n  WizardMenuActor,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport {\n  cloneElement,\n  createElement,\n} from '@openscd/xml';\n\nimport { EditorAction, newActionEvent } from '@openscd/core/foundation/deprecated/editor.js';\nimport { getValAction, wizardContent } from './abstractda.js';\n\nfunction remove(element: Element): WizardMenuActor {\n  return (wizard: Element): void => {\n    wizard.dispatchEvent(\n      newActionEvent({ old: { parent: element.parentElement!, element } })\n    );\n    wizard.dispatchEvent(newWizardEvent());\n  };\n}\n\nexport function updateBDaAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditorAction[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!)!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const bType = getValue(inputs.find(i => i.label === 'bType')!)!;\n    const type =\n      bType === 'Enum' || bType === 'Struct'\n        ? getValue(inputs.find(i => i.label === 'type')!)\n        : null;\n    const sAddr = getValue(inputs.find(i => i.label === 'sAddr')!);\n    const valKind = getValue(inputs.find(i => i.label === 'valKind')!);\n    const valImport = getValue(inputs.find(i => i.label === 'valImport')!);\n    const valField = inputs.find(\n      i => i.label === 'Val' && i.style.display !== 'none'\n    );\n    const Val = valField ? getValue(valField) : null;\n\n    let bdaAction: EditorAction | null;\n    let valAction: EditorAction | null;\n\n    if (\n      name === element.getAttribute('name') &&\n      desc === element.getAttribute('desc') &&\n      bType === element.getAttribute('bType') &&\n      type === element.getAttribute('type') &&\n      sAddr === element.getAttribute('sAddr') &&\n      valKind === element.getAttribute('valKind') &&\n      valImport === element.getAttribute('valImprot')\n    ) {\n      bdaAction = null;\n    } else {\n      const newElement = cloneElement(element, {\n        name,\n        desc,\n        bType,\n        type,\n        sAddr,\n        valKind,\n        valImport,\n      });\n      bdaAction = { old: { element }, new: { element: newElement } };\n    }\n\n    if (Val === (element.querySelector('Val')?.textContent?.trim() ?? null)) {\n      valAction = null;\n    } else {\n      valAction = getValAction(\n        element.querySelector('Val'),\n        Val,\n        bdaAction?.new.element ?? element\n      );\n    }\n\n    const actions: EditorAction[] = [];\n    if (bdaAction) actions.push(bdaAction);\n    if (valAction) actions.push(valAction);\n    return actions;\n  };\n}\n\nexport function editBDAWizard(element: Element): Wizard {\n  const doc = element.ownerDocument;\n  const type = element.getAttribute('type');\n  const name = element.getAttribute('name');\n  const desc = element.getAttribute('desc');\n  const bType = element.getAttribute('bType') ?? '';\n  const sAddr = element.getAttribute('sAddr');\n  const Val = element.querySelector('Val')?.innerHTML.trim() ?? null;\n  const valKind = element.getAttribute('valKind');\n  const valImport = element.getAttribute('valImport');\n\n  const types = Array.from(doc.querySelectorAll('DAType, EnumType'))\n    .filter(isPublic)\n    .filter(type => type.getAttribute('id'));\n\n  const data = element.closest('DataTypeTemplates')!;\n\n  return [\n    {\n      title: get('bda.wizard.title.edit'),\n      element: element,\n      primary: {\n        icon: '',\n        label: get('save'),\n        action: updateBDaAction(element),\n      },\n      menuActions: [\n        {\n          icon: 'delete',\n          label: get('remove'),\n          action: remove(element),\n        },\n      ],\n      content: [\n        ...wizardContent(\n          name,\n          desc,\n          bType,\n          types,\n          type,\n          sAddr,\n          valKind,\n          valImport,\n          Val,\n          data\n        ),\n      ],\n    },\n  ];\n}\n\nexport function createBDaAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]): EditorAction[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!)!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const bType = getValue(inputs.find(i => i.label === 'bType')!)!;\n    const type =\n      bType === 'Enum' || bType === 'Struct'\n        ? getValue(inputs.find(i => i.label === 'type')!)\n        : null;\n    const sAddr = getValue(inputs.find(i => i.label === 'sAddr')!);\n    const valKind =\n      getValue(inputs.find(i => i.label === 'valKind')!) !== ''\n        ? getValue(inputs.find(i => i.label === 'valKind')!)\n        : null;\n    const valImport =\n      getValue(inputs.find(i => i.label === 'valImport')!) !== ''\n        ? getValue(inputs.find(i => i.label === 'valImport')!)\n        : null;\n\n    const valField = inputs.find(\n      i => i.label === 'Val' && i.style.display !== 'none'\n    );\n    const Val = valField ? getValue(valField) : null;\n\n    const element = createElement(parent.ownerDocument, 'BDA', {\n      name,\n      desc,\n      bType,\n      type,\n      sAddr,\n      valKind,\n      valImport,\n    });\n\n    if (Val !== null) {\n      const valElement = createElement(parent.ownerDocument, 'Val', {});\n      valElement.textContent = Val;\n      element.appendChild(valElement);\n    }\n\n    return [\n      {\n        new: {\n          parent,\n          element,\n        },\n      },\n    ];\n  };\n}\n\nexport function createBDAWizard(element: Element): Wizard {\n  const doc = element.ownerDocument;\n\n  const name = '';\n  const desc = null;\n  const bType = '';\n  const type = null;\n  const sAddr = null;\n  const Val = null;\n  const valKind = null;\n  const valImport = null;\n\n  const types = Array.from(doc.querySelectorAll('DAType, EnumType'))\n    .filter(isPublic)\n    .filter(type => type.getAttribute('id'));\n\n  const data = element.closest('DataTypeTemplates')!;\n\n  return [\n    {\n      title: get('bda.wizard.title.edit'),\n      primary: {\n        icon: '',\n        label: get('save'),\n        action: createBDaAction(element),\n      },\n      content: [\n        ...wizardContent(\n          name,\n          desc,\n          bType,\n          types,\n          type,\n          sAddr,\n          valKind,\n          valImport,\n          Val,\n          data\n        ),\n      ],\n    },\n  ];\n}\n"]}