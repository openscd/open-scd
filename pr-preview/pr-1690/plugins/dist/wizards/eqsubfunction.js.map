{"version":3,"file":"eqsubfunction.js","sourceRoot":"","sources":["../../src/wizards/eqsubfunction.ts"],"names":[],"mappings":"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","sourcesContent":["import { get } from 'lit-translate';\n\nimport {\n  getValue,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport {\n  cloneElement,\n  createElement,\n  getChildElementsByTagName,\n} from '@openscd/xml';\n\nimport { SimpleAction } from '@openscd/core/foundation/deprecated/editor.js';\nimport { contentFunctionWizard } from './function.js';\n\nfunction updateEqSubFunctionAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): SimpleAction[] => {\n    const functionAttrs: Record<string, string | null> = {};\n    const functionKeys = ['name', 'desc', 'type'];\n    functionKeys.forEach(key => {\n      functionAttrs[key] = getValue(inputs.find(i => i.label === key)!);\n    });\n\n    if (\n      functionKeys.some(key => functionAttrs[key] !== element.getAttribute(key))\n    ) {\n      const newElement = cloneElement(element, functionAttrs);\n      return [\n        {\n          old: { element },\n          new: { element: newElement },\n        },\n      ];\n    }\n\n    return [];\n  };\n}\n\nexport function editEqSubFunctionWizard(element: Element): Wizard {\n  const name = element.getAttribute('name');\n  const desc = element.getAttribute('desc');\n  const type = element.getAttribute('type');\n  const reservedNames: string[] = getChildElementsByTagName(\n    element.parentElement!,\n    'EqSubFunction'\n  )\n    .filter(sibling => sibling !== element)\n    .map(sibling => sibling.getAttribute('name')!);\n\n  return [\n    {\n      title: get('wizard.title.edit', { tagName: 'EqSubFunction' }),\n      element: element,\n      primary: {\n        icon: 'save',\n        label: get('save'),\n        action: updateEqSubFunctionAction(element),\n      },\n      content: [\n        ...contentFunctionWizard({\n          name,\n          desc,\n          type,\n          reservedNames,\n        }),\n      ],\n    },\n  ];\n}\n\nfunction createEqSubFunctionAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]) => {\n    const eqSubFunctionAttrs: Record<string, string | null> = {};\n    const eqSubFunctionKeys = ['name', 'desc', 'type'];\n    eqSubFunctionKeys.forEach(key => {\n      eqSubFunctionAttrs[key] = getValue(inputs.find(i => i.label === key)!);\n    });\n\n    const eqSubFunction = createElement(\n      parent.ownerDocument,\n      'EqSubFunction',\n      eqSubFunctionAttrs\n    );\n\n    return [{ new: { parent, element: eqSubFunction } }];\n  };\n}\n\nexport function createEqSubFunctionWizard(parent: Element): Wizard {\n  const name = '';\n  const desc = null;\n  const type = null;\n  const reservedNames = Array.from(\n    parent.querySelectorAll('EqSubFunction')\n  ).map(eqSubFunction => eqSubFunction.getAttribute('name')!);\n\n  return [\n    {\n      title: get('wizard.title.add', { tagName: 'EqSubFunction' }),\n      primary: {\n        icon: 'save',\n        label: get('save'),\n        action: createEqSubFunctionAction(parent),\n      },\n      content: [\n        ...contentFunctionWizard({\n          name,\n          desc,\n          type,\n          reservedNames,\n        }),\n      ],\n    },\n  ];\n}\n"]}