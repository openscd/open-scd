{"version":3,"file":"subequipment.js","sourceRoot":"","sources":["../../src/wizards/subequipment.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, TemplateResult } from 'lit-html';\nimport { get } from 'lit-translate';\n\nimport {\n  cloneElement,\n  createElement,\n  getChildElementsByTagName,\n} from '@openscd/xml';\n\nimport {\n  getValue,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '@openscd/open-scd/src/foundation.js';\nimport { SimpleAction } from '@openscd/core/foundation/deprecated/editor';\nimport '@openscd/open-scd/src/wizard-textfield.js';\nimport '@openscd/open-scd/src/wizard-select.js';\n\ninterface ContentOptions {\n  name: string | null;\n  desc: string | null;\n  phase: string | null;\n  virtual: string | null;\n  reservedNames: string[];\n}\n\nexport function contentSubEquipmentWizard(\n  content: ContentOptions\n): TemplateResult[] {\n  return [\n    html`<wizard-textfield\n      label=\"name\"\n      .maybeValue=${content.name}\n      .reservedValues=${content.reservedNames}\n      helper=\"${get('scl.name')}\"\n      required\n      validationMessage=\"${get('textfield.required')}\"\n      dialogInitialFocus\n    ></wizard-textfield>`,\n    html`<wizard-textfield\n      label=\"desc\"\n      .maybeValue=${content.desc}\n      nullable\n      helper=\"${get('scl.desc')}\"\n    ></wizard-textfield>`,\n    html`<wizard-select\n      label=\"phase\"\n      fixedMenuPosition\n      .maybeValue=${content.phase}\n      nullable\n      helper=\"${get('scl.phase')}\"\n    >\n      ${['A', 'B', 'C', 'N', 'all', 'none', 'AB', 'BC', 'CA'].map(\n        value =>\n          html`<mwc-list-item value=\"${value}\">\n            ${value.charAt(0).toUpperCase() + value.slice(1)}\n          </mwc-list-item>`\n      )}\n    </wizard-select> `,\n    html`<wizard-checkbox\n      label=\"virtual\"\n      .maybeValue=${content.virtual}\n      nullable\n      helper=\"${get('scl.virtual')}\"\n    ></wizard-checkbox>`,\n  ];\n}\n\nfunction updateSubEquipmentAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): SimpleAction[] => {\n    const subfunctionAttrs: Record<string, string | null> = {};\n    const subFunctionKeys = ['name', 'desc', 'phase', 'virtual'];\n    subFunctionKeys.forEach(key => {\n      subfunctionAttrs[key] = getValue(inputs.find(i => i.label === key)!);\n    });\n\n    if (\n      subFunctionKeys.some(\n        key => subfunctionAttrs[key] !== element.getAttribute(key)\n      )\n    ) {\n      const newElement = cloneElement(element, subfunctionAttrs);\n      return [\n        {\n          old: { element },\n          new: { element: newElement },\n        },\n      ];\n    }\n\n    return [];\n  };\n}\n\nexport function editSubEquipmentWizard(element: Element): Wizard {\n  const name = element.getAttribute('name');\n  const desc = element.getAttribute('desc');\n  const phase = element.getAttribute('phase');\n  const virtual = element.getAttribute('virtual');\n\n  const reservedNames: string[] = getChildElementsByTagName(\n    element.parentElement!,\n    'SubEquipment'\n  )\n    .filter(sibling => sibling !== element)\n    .map(sibling => sibling.getAttribute('name')!);\n\n  return [\n    {\n      title: get('wizard.title.edit', { tagName: 'SubEquipment' }),\n      primary: {\n        icon: 'save',\n        label: get('save'),\n        action: updateSubEquipmentAction(element),\n      },\n      content: [\n        ...contentSubEquipmentWizard({\n          name,\n          desc,\n          phase,\n          virtual,\n          reservedNames,\n        }),\n      ],\n    },\n  ];\n}\n\nfunction createSubEquipmentAction(parent: Element): WizardActor {\n  return (inputs: WizardInputElement[]) => {\n    const subEquipmentAttrs: Record<string, string | null> = {};\n    const subEquipmentKeys = ['name', 'desc', 'phase', 'virtual'];\n    subEquipmentKeys.forEach(key => {\n      subEquipmentAttrs[key] = getValue(inputs.find(i => i.label === key)!);\n    });\n\n    const subEquipment = createElement(\n      parent.ownerDocument,\n      'SubEquipment',\n      subEquipmentAttrs\n    );\n\n    return [{ new: { parent, element: subEquipment } }];\n  };\n}\n\nexport function createSubEquipmentWizard(parent: Element): Wizard {\n  const name = '';\n  const desc = null;\n  const phase = null;\n  const virtual = null;\n  const reservedNames = Array.from(parent.querySelectorAll('SubEquipment')).map(\n    subEquipment => subEquipment.getAttribute('name')!\n  );\n\n  return [\n    {\n      title: get('wizard.title.add', { tagName: 'SubEquipment' }),\n      primary: {\n        icon: 'save',\n        label: get('save'),\n        action: createSubEquipmentAction(parent),\n      },\n      content: [\n        ...contentSubEquipmentWizard({\n          name,\n          desc,\n          phase,\n          virtual,\n          reservedNames,\n        }),\n      ],\n    },\n  ];\n}\n"]}