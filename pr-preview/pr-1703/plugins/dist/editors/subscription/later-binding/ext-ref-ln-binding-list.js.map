{"version":3,"file":"ext-ref-ln-binding-list.js","sourceRoot":"","sources":["../../../../src/editors/subscription/later-binding/ext-ref-ln-binding-list.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  state,\n  TemplateResult,\n} from 'lit-element';\nimport { nothing } from 'lit-html';\nimport { get } from 'lit-translate';\n\nimport {\n  identity,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport {\n  createElement,\n} from '@openscd/xml';\n\nimport {\n  ComplexAction,\n  Delete,\n  newActionEvent,\n} from '@openscd/core/foundation/deprecated/editor.js';\nimport { Nsdoc } from '@openscd/open-scd/src/foundation/nsdoc.js';\n\nimport {\n  canCreateValidExtRef,\n  createExtRefElement,\n  existExtRef,\n  FcdaSelectEvent,\n  getExtRef,\n  getExistingSupervision,\n  newSubscriptionChangedEvent,\n  removeSubscriptionSupervision,\n  instantiateSubscriptionSupervision,\n  styles,\n  canRemoveSubscriptionSupervision,\n} from '../foundation.js';\nimport { getSubscribedExtRefElements } from './foundation.js';\nimport { emptyInputsDeleteActions } from '@openscd/open-scd/src/foundation/ied.js';\n\n/**\n * A sub element for showing all Ext Refs from a FCDA Element.\n * The List reacts on a custom event to know which FCDA Element was selected and updated the view.\n */\n@customElement('extref-ln-binding-list')\nexport class ExtRefLnBindingList extends LitElement {\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  @property({ type: Number })\n  editCount = -1;\n  @property()\n  nsdoc!: Nsdoc;\n  @property()\n  controlTag!: 'SampledValueControl' | 'GSEControl';\n\n  @state()\n  currentSelectedControlElement: Element | undefined;\n  @state()\n  currentSelectedFcdaElement: Element | undefined;\n  @state()\n  currentIedElement: Element | undefined;\n\n  constructor() {\n    super();\n\n    const parentDiv = this.closest('.container');\n    if (parentDiv) {\n      this.onFcdaSelectEvent = this.onFcdaSelectEvent.bind(this);\n      parentDiv.addEventListener('fcda-select', this.onFcdaSelectEvent);\n    }\n  }\n\n  private getLNElements(): Element[] {\n    if (this.doc) {\n      return Array.from(\n        this.doc.querySelectorAll('LDevice > LN0, LDevice > LN')\n      ).filter(element => element.closest('IED') !== this.currentIedElement);\n    }\n    return [];\n  }\n\n  private getSubscribedLNElements(): Element[] {\n    return this.getLNElements().filter(\n      element =>\n        getSubscribedExtRefElements(\n          element,\n          this.controlTag,\n          this.currentSelectedFcdaElement,\n          this.currentSelectedControlElement,\n          false\n        ).length > 0\n    );\n  }\n\n  private getAvailableLNElements(): Element[] {\n    return this.getLNElements().filter(\n      element =>\n        getSubscribedExtRefElements(\n          element,\n          this.controlTag,\n          this.currentSelectedFcdaElement,\n          this.currentSelectedControlElement,\n          false\n        ).length == 0\n    );\n  }\n\n  private async onFcdaSelectEvent(event: FcdaSelectEvent) {\n    this.currentSelectedControlElement = event.detail.control;\n    this.currentSelectedFcdaElement = event.detail.fcda;\n\n    // Retrieve the IED Element to which the FCDA belongs.\n    // These LN Elements will be excluded.\n    this.currentIedElement = this.currentSelectedFcdaElement\n      ? this.currentSelectedFcdaElement.closest('IED') ?? undefined\n      : undefined;\n  }\n\n  private subscribe(lnElement: Element): ComplexAction | null {\n    if (\n      !this.currentIedElement ||\n      !this.currentSelectedFcdaElement ||\n      !this.currentSelectedControlElement!\n    ) {\n      return null;\n    }\n\n    const complexAction: ComplexAction = {\n      actions: [],\n      title: get(`subscription.connect`),\n    };\n\n    let inputsElement = lnElement.querySelector(':scope > Inputs');\n    if (!inputsElement) {\n      inputsElement = createElement(lnElement.ownerDocument, 'Inputs', {});\n      complexAction.actions.push({\n        new: { parent: lnElement, element: inputsElement },\n      });\n    }\n\n    if (\n      !existExtRef(\n        inputsElement!,\n        this.currentSelectedFcdaElement,\n        this.currentSelectedControlElement\n      ) &&\n      canCreateValidExtRef(\n        this.currentSelectedFcdaElement,\n        this.currentSelectedControlElement\n      )\n    ) {\n      const extRef = createExtRefElement(\n        this.currentSelectedControlElement,\n        this.currentSelectedFcdaElement\n      );\n      complexAction.actions.push({\n        new: { parent: inputsElement, element: extRef },\n      });\n    }\n\n    // we need to extend the actions array with the actions for the instation of the LGOS\n    const subscriberIed = lnElement.closest('IED') || undefined;\n    complexAction.actions.push(\n      ...instantiateSubscriptionSupervision(\n        this.currentSelectedControlElement,\n        subscriberIed\n      )\n    );\n\n    return complexAction;\n  }\n\n  private unsubscribe(lnElement: Element): ComplexAction | null {\n    if (\n      !this.currentIedElement ||\n      !this.currentSelectedFcdaElement ||\n      !this.currentSelectedControlElement!\n    ) {\n      return null;\n    }\n\n    const actions: Delete[] = [];\n    const inputElement = lnElement.querySelector(':scope > Inputs')!;\n    const extRefElement = getExtRef(\n      inputElement,\n      this.currentSelectedFcdaElement,\n      this.currentSelectedControlElement\n    );\n    if (extRefElement) {\n      actions.push({ old: { parent: inputElement, element: extRefElement } });\n    }\n\n    // Check if empty Input Element should also be removed.\n    actions.push(...emptyInputsDeleteActions(actions));\n\n    // we need to extend the actions array with the actions for removing the supervision\n    const subscriberIed = lnElement.closest('IED') || undefined;\n    if (extRefElement && canRemoveSubscriptionSupervision(extRefElement))\n      actions.push(\n        ...removeSubscriptionSupervision(\n          this.currentSelectedControlElement,\n          subscriberIed\n        )\n      );\n\n    return {\n      title: get('subscription.disconnect'),\n      actions: actions,\n    };\n  }\n\n  private bindingNotSupported(lnElement: Element): boolean {\n    const iedElement = lnElement.closest('IED')!;\n    return (\n      (iedElement\n        .querySelector(\n          ':scope > AccessPoint > Services > ClientServices, :scope > Services > ClientServices'\n        )\n        ?.getAttribute('noIctBinding') ?? 'false') === 'true'\n    );\n  }\n\n  private buildLNTitle(lnElement: Element): string {\n    const prefix = lnElement.getAttribute('prefix');\n    const inst = lnElement.getAttribute('inst');\n\n    const data = this.nsdoc.getDataDescription(lnElement);\n\n    return `${prefix ? `${prefix} - ` : ''}${data.label} ${\n      inst ? ` - ${inst}` : ''\n    }`;\n  }\n\n  private renderTitle(): TemplateResult {\n    return html`<h1>${get(`subscription.binding.extRefList.title`)}</h1>`;\n  }\n\n  private renderSubscribedLN(lnElement: Element): TemplateResult {\n    const extRefs = getSubscribedExtRefElements(\n      lnElement,\n      this.controlTag,\n      this.currentSelectedFcdaElement,\n      this.currentSelectedControlElement,\n      false\n    );\n    const supervisionNode = getExistingSupervision(extRefs[0]);\n    return html`<mwc-list-item\n      graphic=\"large\"\n      ?hasMeta=${supervisionNode !== null}\n      ?disabled=${this.bindingNotSupported(lnElement)}\n      twoline\n      value=\"${identity(lnElement)}\"\n      @click=${() => {\n        const replaceAction = this.unsubscribe(lnElement);\n        if (replaceAction) {\n          this.dispatchEvent(newActionEvent(replaceAction));\n          this.dispatchEvent(\n            newSubscriptionChangedEvent(\n              this.currentSelectedControlElement,\n              this.currentSelectedFcdaElement\n            )\n          );\n        }\n      }}\n    >\n      <span>${this.buildLNTitle(lnElement)}</span>\n      <span slot=\"secondary\"> ${identity(lnElement.closest('LDevice'))} </span>\n      <mwc-icon slot=\"graphic\">close</mwc-icon>\n      ${supervisionNode !== null\n        ? html`<mwc-icon title=\"${identity(supervisionNode)}\" slot=\"meta\"\n            >monitor_heart</mwc-icon\n          >`\n        : nothing}</mwc-list-item\n    >`;\n  }\n\n  private renderSubscribedLNs(): TemplateResult {\n    const subscribedLNs = this.getSubscribedLNElements();\n    return html`\n      <mwc-list-item\n        noninteractive\n        value=\"${subscribedLNs\n          .map(\n            lnElement =>\n              this.buildLNTitle(lnElement) +\n              ' ' +\n              identity(lnElement.closest('LDevice'))\n          )\n          .join(' ')}\"\n      >\n        <span>${get('subscription.subscriber.subscribed')}</span>\n      </mwc-list-item>\n      <li divider role=\"separator\"></li>\n      ${subscribedLNs.length > 0\n        ? html`${subscribedLNs.map(lN => this.renderSubscribedLN(lN))}`\n        : html`<mwc-list-item graphic=\"large\" noninteractive>\n            ${get('subscription.binding.extRefList.noSubscribedLNs')}\n          </mwc-list-item>`}\n    `;\n  }\n\n  private renderAvailableLNs(): TemplateResult {\n    const availableLNs = this.getAvailableLNElements();\n    return html`\n      <mwc-list-item\n        noninteractive\n        value=\"${availableLNs\n          .map(\n            lnElement =>\n              this.buildLNTitle(lnElement) +\n              ' ' +\n              identity(lnElement.closest('LDevice'))\n          )\n          .join(' ')}\"\n      >\n        <span> ${get('subscription.subscriber.availableToSubscribe')} </span>\n      </mwc-list-item>\n      <li divider role=\"separator\"></li>\n      ${availableLNs.length > 0\n        ? html`${availableLNs.map(\n            lnElement => html` <mwc-list-item\n              graphic=\"large\"\n              ?disabled=${this.bindingNotSupported(lnElement)}\n              twoline\n              value=\"${identity(lnElement)}\"\n              @click=${() => {\n                const replaceAction = this.subscribe(lnElement);\n                if (replaceAction) {\n                  this.dispatchEvent(newActionEvent(replaceAction));\n                  this.dispatchEvent(\n                    newSubscriptionChangedEvent(\n                      this.currentSelectedControlElement,\n                      this.currentSelectedFcdaElement\n                    )\n                  );\n                }\n              }}\n            >\n              <span>${this.buildLNTitle(lnElement)}</span>\n              <span slot=\"secondary\">\n                ${identity(lnElement.closest('LDevice'))}\n              </span>\n              <mwc-icon slot=\"graphic\">add</mwc-icon>\n            </mwc-list-item>`\n          )}`\n        : html`<mwc-list-item graphic=\"large\" noninteractive>\n            ${get('subscription.binding.extRefList.noAvailableLNs')}\n          </mwc-list-item>`}\n    `;\n  }\n\n  render(): TemplateResult {\n    return html` <section tabindex=\"0\">\n      ${this.currentSelectedControlElement && this.currentSelectedFcdaElement\n        ? html`\n            ${this.renderTitle()}\n            <filtered-list>\n              ${this.renderSubscribedLNs()} ${this.renderAvailableLNs()}\n            </filtered-list>\n          `\n        : html`\n            <h1>${get('subscription.binding.extRefList.noSelection')}</h1>\n          `}\n    </section>`;\n  }\n\n  static styles = css`\n    ${styles}\n\n    mwc-list-item.hidden[noninteractive] + li[divider] {\n      display: none;\n    }\n  `;\n}\n"]}