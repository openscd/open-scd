{"version":3,"file":"dataset.js","sourceRoot":"","sources":["../../src/wizards/dataset.ts"],"names":[],"mappings":"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","sourcesContent":["import { CheckListItem } from '@material/mwc-list/mwc-check-list-item';\nimport { html } from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-button';\nimport '@material/mwc-list/mwc-check-list-item';\n\nimport '@openscd/open-scd/src/wizard-textfield.js';\nimport '@openscd/open-scd/src/filtered-list.js';\nimport {\n  find,\n  getValue,\n  identity,\n  Wizard,\n  WizardAction,\n  WizardActor,\n  WizardInputElement,\n  WizardMenuActor,\n  newSubWizardEvent,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport { cloneElement } from '@openscd/xml';\n\nimport { Replace } from '@openscd/core/foundation/deprecated/editor.js';\nimport { createFCDAsWizard } from './fcda.js';\n\nfunction openFcdaWizard(element: Element): WizardMenuActor {\n  return (wizard: Element): void => {\n    wizard.dispatchEvent(newSubWizardEvent(() => createFCDAsWizard(element)));\n  };\n}\n\nfunction updateDataSetAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[], wizard: Element): WizardAction[] => {\n    const name = inputs.find(i => i.label === 'name')!.value!;\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const oldName = element.getAttribute('name');\n\n    const dataSetUpdateAction: Replace[] = [];\n    if (!(name === oldName && desc === element.getAttribute('desc'))) {\n      const newElement = cloneElement(element, { name, desc });\n\n      dataSetUpdateAction.push({\n        old: { element },\n        new: { element: newElement },\n      });\n    }\n\n    const controlBlockUpdateActions =\n      name !== oldName\n        ? Array.from(\n            element.parentElement?.querySelectorAll(\n              `ReportControlBock[datSet=${oldName}], GSEControl[datSet=${oldName}],SampledValueControl[datSet=${oldName}] `\n            ) ?? []\n          ).map(cb => {\n            const newCb = cloneElement(cb, { datSet: name });\n            return { old: { element: cb }, new: { element: newCb } };\n          })\n        : [];\n\n    const fCDARemoveActions = Array.from(\n      wizard.shadowRoot!.querySelectorAll(\n        'filtered-list > mwc-check-list-item:not([selected])'\n      )\n    )\n      .map(listItem => find(element, 'FCDA', (<CheckListItem>listItem).value))\n      .filter(fcda => fcda)\n      .map(fcda => {\n        return {\n          old: {\n            parent: element,\n            element: fcda!,\n            reference: fcda!.nextSibling,\n          },\n        };\n      });\n\n    return [\n      ...fCDARemoveActions,\n      ...dataSetUpdateAction,\n      ...controlBlockUpdateActions,\n    ];\n  };\n}\n\nexport function editDataSetWizard(element: Element): Wizard {\n  const name = element.getAttribute('name');\n  const desc = element.getAttribute('desc');\n\n  return [\n    {\n      title: get('wizard.title.edit', { tagName: element.tagName }),\n      element,\n      primary: {\n        label: get('save'),\n        icon: 'save',\n        action: updateDataSetAction(element),\n      },\n      menuActions: [\n        {\n          icon: 'add',\n          label: get('dataset.fcda.add'),\n          action: openFcdaWizard(element),\n        },\n      ],\n      content: [\n        html`<wizard-textfield\n          label=\"name\"\n          .maybeValue=${name}\n          helper=\"${get('scl.name')}\"\n          required\n          disabled=\"true\"\n        >\n        </wizard-textfield>`,\n        html`<wizard-textfield\n          label=\"desc\"\n          .maybeValue=${desc}\n          helper=\"${get('scl.desc')}\"\n          nullable\n          required\n        >\n        </wizard-textfield>`,\n        html`<filtered-list multi\n          >${Array.from(element.querySelectorAll('FCDA')).map(\n            fcda =>\n              html`<mwc-check-list-item selected value=\"${identity(fcda)}\"\n                >${(<string>identity(fcda))\n                  .split('>')\n                  .pop()}</mwc-check-list-item\n              >`\n          )}</filtered-list\n        >`,\n      ],\n    },\n  ];\n}\n"]}