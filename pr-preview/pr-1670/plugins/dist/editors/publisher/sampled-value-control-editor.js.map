{"version":3,"file":"sampled-value-control-editor.js","sourceRoot":"","sources":["../../../src/editors/publisher/sampled-value-control-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  query,\n  state,\n  TemplateResult,\n} from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-button';\nimport '@material/mwc-list/mwc-list-item';\nimport { Button } from '@material/mwc-button';\nimport { ListItem } from '@material/mwc-list/mwc-list-item';\n\nimport './data-set-element-editor.js';\nimport '@openscd/open-scd/src/filtered-list.js';\nimport './sampled-value-control-element-editor.js';\nimport { FilteredList } from '@openscd/open-scd/src/filtered-list.js';\n\nimport {\n  compareNames,\n  identity,\n  find,\n} from '@openscd/open-scd/src/foundation.js';\nimport { smvIcon } from '@openscd/open-scd/src/icons/icons.js';\nimport { styles, updateElementReference } from './foundation.js';\n\n@customElement('sampled-value-control-editor')\nexport class SampledValueControlEditor extends LitElement {\n  /** The document being edited as provided to plugins by [[`OpenSCD`]]. */\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  @property({ type: Number })\n  editCount = -1;\n\n  @state()\n  selectedSampledValueControl?: Element;\n  @state()\n  selectedDataSet?: Element | null;\n\n  @query('.selectionlist') selectionList!: FilteredList;\n  @query('mwc-button') selectSampledValueControlButton!: Button;\n\n  /** Resets selected SMV and its DataSet, if not existing in new doc */\n  update(props: Map<string | number | symbol, unknown>): void {\n    if (props.has('doc') && this.selectedSampledValueControl) {\n      const newSampledValueControl = updateElementReference(\n        this.doc,\n        this.selectedSampledValueControl\n      );\n\n      this.selectedSampledValueControl = newSampledValueControl ?? undefined;\n      this.selectedDataSet = this.selectedSampledValueControl\n        ? updateElementReference(this.doc, this.selectedDataSet!)\n        : undefined;\n\n      if (\n        !newSampledValueControl &&\n        this.selectionList &&\n        this.selectionList.selected\n      )\n        (this.selectionList.selected as ListItem).selected = false;\n    }\n\n    super.update(props);\n  }\n\n  private selectSMVControl(evt: Event): void {\n    const id = ((evt.target as FilteredList).selected as ListItem).value;\n    const smvControl = find(this.doc, 'SampledValueControl', id);\n    if (!smvControl) return;\n\n    this.selectedSampledValueControl = smvControl;\n\n    if (smvControl) {\n      this.selectedDataSet =\n        smvControl.parentElement?.querySelector(\n          `DataSet[name=\"${smvControl.getAttribute('datSet')}\"]`\n        ) ?? null;\n      (evt.target as FilteredList).classList.add('hidden');\n      this.selectSampledValueControlButton.classList.remove('hidden');\n    }\n  }\n\n  private renderElementEditorContainer(): TemplateResult {\n    if (this.selectedSampledValueControl !== undefined)\n      return html`<div class=\"elementeditorcontainer\">\n        <data-set-element-editor\n          .element=${this.selectedDataSet!}\n        ></data-set-element-editor>\n        <sampled-value-control-element-editor\n          .editCount=${this.editCount}\n          .doc=${this.doc}\n          .element=${this.selectedSampledValueControl}\n        ></sampled-value-control-element-editor>\n      </div>`;\n\n    return html``;\n  }\n\n  private renderSelectionList(): TemplateResult {\n    return html`<filtered-list\n      activatable\n      @action=${this.selectSMVControl}\n      class=\"selectionlist\"\n      >${Array.from(this.doc.querySelectorAll('IED'))\n        .sort(compareNames)\n        .flatMap(ied => {\n          const ieditem = html`<mwc-list-item\n              class=\"listitem header\"\n              noninteractive\n              graphic=\"icon\"\n              value=\"${Array.from(ied.querySelectorAll('SampledValueControl'))\n                .map(element => {\n                  const id = identity(element) as string;\n                  return typeof id === 'string' ? id : '';\n                })\n                .join(' ')}\"\n            >\n              <span>${ied.getAttribute('name')}</span>\n              <mwc-icon slot=\"graphic\">developer_board</mwc-icon>\n            </mwc-list-item>\n            <li divider role=\"separator\"></li>`;\n\n          const sampledValueControls = Array.from(\n            ied.querySelectorAll('SampledValueControl')\n          ).map(\n            reportCb =>\n              html`<mwc-list-item\n                twoline\n                value=\"${identity(reportCb)}\"\n                graphic=\"icon\"\n                ><span>${reportCb.getAttribute('name')}</span\n                ><span slot=\"secondary\">${identity(reportCb)}</span>\n                <mwc-icon slot=\"graphic\">${smvIcon}</mwc-icon>\n              </mwc-list-item>`\n          );\n\n          return [ieditem, ...sampledValueControls];\n        })}</filtered-list\n    >`;\n  }\n\n  private renderToggleButton(): TemplateResult {\n    return html`<mwc-button\n      outlined\n      label=\"${get('publisher.selectbutton', { type: 'SMV' })}\"\n      @click=${() => {\n        this.selectionList.classList.remove('hidden');\n        this.selectSampledValueControlButton.classList.add('hidden');\n      }}\n    ></mwc-button>`;\n  }\n\n  render(): TemplateResult {\n    return html`${this.renderToggleButton()}\n      <div class=\"content\">\n        ${this.renderSelectionList()}${this.renderElementEditorContainer()}\n      </div>`;\n  }\n\n  static styles = css`\n    ${styles}\n\n    .elementeditorcontainer {\n      flex: 65%;\n      margin: 4px 8px 4px 4px;\n      background-color: var(--mdc-theme-surface);\n      overflow-y: scroll;\n      display: grid;\n      grid-gap: 12px;\n      padding: 8px 12px 16px;\n      grid-template-columns: repeat(3, 1fr);\n    }\n\n    data-set-element-editor {\n      grid-column: 1 / 2;\n    }\n\n    sampled-value-control-element-editor {\n      grid-column: 2 / 4;\n    }\n\n    @media (max-width: 950px) {\n      .elementeditorcontainer {\n        display: block;\n      }\n    }\n  `;\n}\n"]}