{"version":3,"file":"gse-control-element-editor.js","sourceRoot":"","sources":["../../../src/editors/publisher/gse-control-element-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n} from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-formfield';\nimport '@material/mwc-checkbox';\n\nimport '@openscd/open-scd/src/wizard-checkbox.js';\nimport '@openscd/open-scd/src/wizard-select.js';\nimport '@openscd/open-scd/src/wizard-textfield.js';\n\nimport { identity } from '@openscd/open-scd/src/foundation.js';\nimport { maxLength, patterns } from '../../wizards/foundation/limits.js';\nimport { typeNullable, typePattern } from '../../wizards/foundation/p-types.js';\nimport { ifDefined } from 'lit-html/directives/if-defined.js';\n\n@customElement('gse-control-element-editor')\nexport class GseControlElementEditor extends LitElement {\n  /** The document being edited as provided to plugins by [[`OpenSCD`]]. */\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  /** The element being edited as provided to plugins by [[`OpenSCD`]]. */\n  @property({ attribute: false })\n  element!: Element;\n  @property({ attribute: false })\n  get gSE(): Element | null | undefined {\n    const cbName = this.element.getAttribute('name');\n    const iedName = this.element.closest('IED')?.getAttribute('name');\n    const apName = this.element.closest('AccessPoint')?.getAttribute('name');\n    const ldInst = this.element.closest('LDevice')?.getAttribute('inst');\n\n    return this.element.ownerDocument.querySelector(\n      `:root > Communication > SubNetwork > ` +\n        `ConnectedAP[iedName=\"${iedName}\"][apName=\"${apName}\"] > ` +\n        `GSE[ldInst=\"${ldInst}\"][cbName=\"${cbName}\"]`\n    );\n  }\n\n  private renderGseContent(): TemplateResult {\n    const gSE = this.gSE;\n    if (!gSE)\n      return html`<div class=\"content\">\n        <h3>\n          <div>Communication Settings (GSE)</div>\n          <div class=\"headersubtitle\">No connection to SubNetwork</div>\n        </h3>\n      </div>`;\n\n    const minTime = gSE.querySelector('MinTime')?.innerHTML.trim() ?? null;\n    const maxTime = gSE.querySelector('MaxTime')?.innerHTML.trim() ?? null;\n\n    const hasInstType = Array.from(gSE.querySelectorAll('Address > P')).some(\n      pType => pType.getAttribute('xsi:type')\n    );\n\n    const attributes: Record<string, string | null> = {};\n\n    ['MAC-Address', 'APPID', 'VLAN-ID', 'VLAN-PRIORITY'].forEach(key => {\n      if (!attributes[key])\n        attributes[key] =\n          gSE.querySelector(`Address > P[type=\"${key}\"]`)?.innerHTML.trim() ??\n          null;\n    });\n\n    return html`<div class=\"content\">\n      <h3>Communication Settings (GSE)</h3>\n      <mwc-formfield label=\"${get('connectedap.wizard.addschemainsttype')}\"\n        ><mwc-checkbox\n          id=\"instType\"\n          ?checked=\"${hasInstType}\"\n          disabled\n        ></mwc-checkbox></mwc-formfield\n      >${Object.entries(attributes).map(\n        ([key, value]) =>\n          html`<wizard-textfield\n            label=\"${key}\"\n            ?nullable=${typeNullable[key]}\n            .maybeValue=${value}\n            pattern=\"${ifDefined(typePattern[key])}\"\n            required\n            disabled\n          ></wizard-textfield>`\n      )}<wizard-textfield\n        label=\"MinTime\"\n        .maybeValue=${minTime}\n        nullable\n        suffix=\"ms\"\n        type=\"number\"\n        disabled\n      ></wizard-textfield\n      ><wizard-textfield\n        label=\"MaxTime\"\n        .maybeValue=${maxTime}\n        nullable\n        suffix=\"ms\"\n        type=\"number\"\n        disabled\n      ></wizard-textfield>\n    </div>`;\n  }\n\n  private renderGseControlContent(): TemplateResult {\n    const [name, desc, type, appID, fixedOffs, securityEnabled] = [\n      'name',\n      'desc',\n      'type',\n      'appID',\n      'fixedOffs',\n      'securityEnabled',\n    ].map(attr => this.element?.getAttribute(attr));\n\n    return html`<div class=\"content\">\n      <wizard-textfield\n        label=\"name\"\n        .maybeValue=${name}\n        helper=\"${get('scl.name')}\"\n        required\n        validationMessage=\"${get('textfield.required')}\"\n        pattern=\"${patterns.asciName}\"\n        maxLength=\"${maxLength.cbName}\"\n        dialogInitialFocus\n        disabled\n      ></wizard-textfield>\n      <wizard-textfield\n        label=\"desc\"\n        .maybeValue=${desc}\n        nullable\n        helper=\"${get('scl.desc')}\"\n        disabled\n      ></wizard-textfield>\n      <wizard-select\n        label=\"type\"\n        .maybeValue=${type}\n        helper=\"${get('scl.type')}\"\n        nullable\n        required\n        disabled\n        >${['GOOSE', 'GSSE'].map(\n          type => html`<mwc-list-item value=\"${type}\">${type}</mwc-list-item>`\n        )}</wizard-select\n      >\n      <wizard-textfield\n        label=\"appID\"\n        .maybeValue=${appID}\n        helper=\"${get('scl.id')}\"\n        required\n        validationMessage=\"${get('textfield.nonempty')}\"\n        disabled\n      ></wizard-textfield>\n      <wizard-checkbox\n        label=\"fixedOffs\"\n        .maybeValue=${fixedOffs}\n        nullable\n        helper=\"${get('scl.fixedOffs')}\"\n        disabled\n      ></wizard-checkbox>\n      <wizard-select\n        label=\"securityEnabled\"\n        .maybeValue=${securityEnabled}\n        nullable\n        required\n        helper=\"${get('scl.securityEnable')}\"\n        disabled\n        >${['None', 'Signature', 'SignatureAndEncryption'].map(\n          type => html`<mwc-list-item value=\"${type}\">${type}</mwc-list-item>`\n        )}</wizard-select\n      >\n    </div>`;\n  }\n\n  render(): TemplateResult {\n    return html`<h2 style=\"display: flex;\">\n        <div style=\"flex:auto\">\n          <div>GSEControl</div>\n          <div class=\"headersubtitle\">${identity(this.element)}</div>\n        </div>\n      </h2>\n      <div class=\"parentcontent\">\n        ${this.renderGseControlContent()}${this.renderGseContent()}\n      </div>`;\n  }\n\n  static styles = css`\n    .parentcontent {\n      display: grid;\n      grid-gap: 12px;\n      box-sizing: border-box;\n      grid-template-columns: repeat(auto-fit, minmax(316px, auto));\n    }\n\n    .content {\n      border-left: thick solid var(--mdc-theme-on-primary);\n    }\n\n    .content > * {\n      display: block;\n      margin: 4px 8px 16px;\n    }\n\n    h2,\n    h3 {\n      color: var(--mdc-theme-on-surface);\n      font-family: 'Roboto', sans-serif;\n      font-weight: 300;\n      margin: 4px 8px 16px;\n      padding-left: 0.3em;\n    }\n\n    .headersubtitle {\n      font-size: 16px;\n      font-weight: 200;\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n    }\n\n    *[iconTrailing='search'] {\n      --mdc-shape-small: 28px;\n    }\n\n    @media (max-width: 950px) {\n      .content {\n        border-left: 0px solid var(--mdc-theme-on-primary);\n      }\n    }\n  `;\n}\n"]}