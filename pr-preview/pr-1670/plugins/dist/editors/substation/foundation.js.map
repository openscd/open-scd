{"version":3,"file":"foundation.js","sourceRoot":"","sources":["../../../src/editors/substation/foundation.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, LitElement, TemplateResult } from 'lit-element';\nimport { classMap } from 'lit-html/directives/class-map.js';\n\nimport './function-editor.js';\n\nimport { identity, isPublic } from '@openscd/open-scd/src/foundation.js';\n\nimport { getChildElementsByTagName } from '@openscd/xml';\n\nimport { newActionEvent } from '@openscd/core/foundation/deprecated/editor.js';\nimport {\n  circuitBreakerIcon,\n  disconnectorIcon,\n  currentTransformerIcon,\n  voltageTransformerIcon,\n  earthSwitchIcon,\n  generalConductingEquipmentIcon,\n} from '@openscd/open-scd/src/icons/icons.js';\nimport { typeStr } from '../../wizards/conductingequipment.js';\nimport { Select } from '@material/mwc-select';\n\nimport { WizardTextField } from '@openscd/open-scd/src/wizard-textfield.js';\nimport { get } from 'lit-translate';\n\nimport { BayEditor } from './bay-editor.js';\nimport { VoltageLevelEditor } from './voltage-level-editor.js';\nimport { SubstationEditor } from './substation-editor.js';\n\nfunction containsReference(element: Element, iedName: string): boolean {\n  return Array.from(element.getElementsByTagName('LNode'))\n    .filter(isPublic)\n    .some(lnode => lnode.getAttribute('iedName') === iedName);\n}\n\nfunction isReferencedItself(element: Element, iedName: string): boolean {\n  return (<Element[]>Array.from(element.children)).some(\n    child =>\n      child.tagName === 'LNode' && child.getAttribute('iedName') === iedName\n  );\n}\n\nfunction hasReferencedChildren(element: Element, iedName: string): boolean {\n  const threshold = element.tagName === 'Bay' ? 0 : 1;\n  return (\n    (<Element[]>Array.from(element.children)).filter(child =>\n      containsReference(child, iedName)\n    ).length > threshold\n  );\n}\n\nfunction hasOurs(element: Element, iedName: string): boolean {\n  return Array.from(element.getElementsByTagName('LNode'))\n    .filter(isPublic)\n    .some(lnode => lnode.getAttribute('iedName') === iedName);\n}\n\nfunction getOurs(element: Element, iedName: string): Element[] {\n  return Array.from(element.getElementsByTagName('LNode'))\n    .filter(isPublic)\n    .filter(lnode => lnode.getAttribute('iedName') === iedName);\n}\n\nfunction hasTheirs(element: Element, iedName: string): boolean {\n  const ours = getOurs(element, iedName);\n  const scl = element.closest('SCL')!;\n\n  return Array.from(scl.getElementsByTagName('LNode'))\n    .filter(isPublic)\n    .filter(lnode => lnode.getAttribute('iedName') === iedName)\n    .some(lnode => !ours.includes(lnode));\n}\n\nexport function attachedIeds(\n  element: Element,\n  remainingIeds: Set<Element>\n): Element[] {\n  const attachedIeds: Element[] = [];\n  for (const ied of remainingIeds) {\n    const iedName = ied.getAttribute('name')!;\n\n    if (element.tagName === 'SCL') {\n      if (!hasOurs(element, iedName) || hasReferencedChildren(element, iedName))\n        attachedIeds.push(ied);\n\n      continue;\n    }\n\n    if (hasTheirs(element, iedName)) continue;\n    if (\n      hasReferencedChildren(element, iedName) ||\n      isReferencedItself(element, iedName)\n    )\n      attachedIeds.push(ied);\n  }\n\n  for (const ied of attachedIeds) {\n    remainingIeds.delete(ied);\n  }\n\n  return attachedIeds;\n}\n\nexport function getAttachedIeds(\n  doc: XMLDocument\n): (element: Element) => Element[] {\n  return (element: Element) => {\n    const ieds = new Set(\n      Array.from(doc.querySelectorAll('IED')).filter(isPublic)\n    );\n\n    return attachedIeds(element, ieds);\n  };\n}\n\n/** Whether the LNode reference valid relatively (IED agnostic)  */\nfunction validRelativeReference(\n  ied: Element,\n  lNode: Element\n): Element | undefined {\n  const [ldInst, prefix, lnClass, lnInst] = [\n    'ldInst',\n    'prefix',\n    'lnClass',\n    'lnInst',\n  ].map(name => lNode.getAttribute(name));\n\n  return Array.from(ied.querySelectorAll('LN, LN0'))\n    .filter(isPublic)\n    .find(\n      anyLn =>\n        anyLn?.closest('LDevice')?.getAttribute('inst') === ldInst &&\n        (anyLn.getAttribute('prefix') ?? '') === (prefix ?? '') &&\n        (anyLn.getAttribute('lnClass') ?? '') === (lnClass ?? '') &&\n        (anyLn.getAttribute('inst') ?? '') === (lnInst ?? '')\n    );\n}\n\n/** Identity of LNode with iedName !== None is global and independent of parent*/\nfunction lNodeRegistry(doc: XMLDocument): (newLNode: Element) => boolean {\n  const lNodes = new Set(\n    Array.from(doc.querySelectorAll('LNode'))\n      .filter(isPublic)\n      .map(lNode => identity(lNode))\n  );\n\n  return (newLNode: Element) => {\n    if (lNodes.has(identity(newLNode))) return true;\n\n    lNodes.add(identity(newLNode));\n    return false;\n  };\n}\n\n/**\n * Clones - deep copy - substation element cloneEntity with removed single line diagram\n * @param cloneEntity - substation element to be cloned\n * @param newName - name of the clone\n * @param iedRedirect - redirection information for LNode elements (all LNodes's are removed for undefined)\n * @returns a deep cloned node without single line diagram information\n */\nexport function substationElementClone(\n  cloneEntity: Element,\n  newName: string,\n  iedRedirect?: Partial<Record<string, string>>\n): Element {\n  const usedLNodes = lNodeRegistry(cloneEntity.ownerDocument);\n\n  const clone: Element = <Element>cloneEntity.cloneNode(true);\n  clone.querySelectorAll('LNode').forEach(lNode => {\n    const oldIedName = lNode.getAttribute('iedName');\n\n    if (oldIedName === 'None') return; // non referenced LNode\n    if (!oldIedName) {\n      //iedName required\n      lNode.parentElement?.removeChild(lNode);\n      return;\n    }\n\n    // no or invalid user choice\n    if (!iedRedirect || !iedRedirect[oldIedName]) {\n      lNode.parentElement?.removeChild(lNode);\n      return;\n    }\n\n    // user decide to remove LNode\n    if (iedRedirect[oldIedName] === 'No') {\n      lNode.parentElement?.removeChild(lNode);\n      return;\n    }\n\n    lNode.setAttribute('iedName', iedRedirect[oldIedName]!);\n\n    // new LNode already in use\n    if (usedLNodes(lNode)) {\n      lNode.parentElement?.removeChild(lNode);\n      return;\n    }\n\n    const ied = cloneEntity.ownerDocument.querySelector(\n      `IED[name=\"${iedRedirect[oldIedName]}\"]`\n    );\n    if (!ied || !validRelativeReference(ied, lNode)) {\n      lNode.parentElement?.removeChild(lNode);\n      return;\n    }\n  });\n\n  clone\n    .querySelectorAll('Terminal:not([cNodeName=\"grounded\"])')\n    .forEach(terminal => terminal.parentElement?.removeChild(terminal));\n  // FIXME(JakobVogelsang): for the moment removes terminal as well.\n  // For later terminal keep might be the better choice\n\n  clone\n    .querySelectorAll('ConnectivityNode')\n    .forEach(condNode => condNode.parentElement?.removeChild(condNode));\n  // FIXME(JakobVogelsang): for the moment beeing connectivity node remove as well.\n  // For later connectivity keep might be the better choice to preserve substation structure\n\n  clone.setAttribute('name', newName);\n\n  return clone;\n}\n\nfunction cloneWithRedirect(evt: Event, cloneEntity: Element): void {\n  const dialog = (<LitElement>evt.target)?.parentElement;\n  if (!dialog) return;\n\n  const children = <(Select | WizardTextField)[]>(\n    Array.from(dialog.querySelectorAll('mwc-select, wizard-textfield'))\n  );\n  if (!children.every(child => child.checkValidity())) return;\n\n  const nameField = dialog.querySelector<WizardTextField>('wizard-textfield')!;\n\n  const iedRedirects = Array.from(\n    dialog.querySelectorAll<Select>('mwc-select')\n  );\n  const iedRedirect: Partial<Record<string, string>> = {};\n  iedRedirects.forEach(ied => {\n    if (iedRedirect[ied.label]) return;\n    iedRedirect[ied.label] = ied.value;\n  });\n\n  if (!cloneEntity.parentElement) return;\n\n  const element = substationElementClone(\n    cloneEntity,\n    nameField.value,\n    iedRedirect\n  );\n\n  dialog.dispatchEvent(\n    newActionEvent({\n      new: {\n        parent: cloneEntity.parentElement,\n        element,\n        reference: cloneEntity.nextSibling,\n      },\n    })\n  );\n}\n\nfunction someUnreferencedLNode(ied: Element, lNodes: Element[]): boolean {\n  const iedName = ied.getAttribute('name');\n  return !lNodes.some(lNode => {\n    const [ldInst, prefix, lnClass, lnInst] = [\n      'ldInst',\n      'prefix',\n      'lnClass',\n      'lnInst',\n    ].map(name => lNode.getAttribute(name));\n\n    return !Array.from(\n      ied.ownerDocument.querySelectorAll(\n        `LNode[iedName=\"${iedName}\"][ldInst=\"${ldInst}\"]`\n      )\n    )\n      .filter(isPublic)\n      .every(\n        otherLNode =>\n          (otherLNode.getAttribute('prefix') ?? '') === (prefix ?? '') &&\n          (otherLNode.getAttribute('lnClass') ?? '') === (lnClass ?? '') &&\n          (otherLNode.getAttribute('inst') ?? '') === (lnInst ?? '')\n      );\n  });\n}\n\n/** Whether at least on LNode is a valid pointer into IED */\nfunction someValidReference(ied: Element, lNodes: Element[]): boolean {\n  return lNodes.some(lNode => validRelativeReference(ied, lNode));\n}\n\nfunction validUnreferencedIEDs(ied: Element, cloneEntity: Element): Element[] {\n  const lNodes = Array.from(\n    cloneEntity.querySelectorAll(`LNode[iedName=\"${ied.getAttribute('name')}\"]`)\n  );\n\n  return Array.from(ied.ownerDocument.querySelectorAll('IED')).filter(\n    otherIED =>\n      ied !== otherIED &&\n      someValidReference(otherIED, lNodes) &&\n      someUnreferencedLNode(otherIED, lNodes)\n  );\n}\n\nfunction referencedIEDs(substationElement: Element): Set<Element> {\n  const usedIEDs = Array.from(\n    substationElement.querySelectorAll('LNode:not([iedName=\"None\"])')\n  )\n    .map(lNode =>\n      substationElement.ownerDocument.querySelector(\n        `IED[name=\"${lNode.getAttribute('iedName')}\"]`\n      )\n    )\n    .filter(ied => ied)\n    .filter(ied => isPublic(ied!)) as Element[];\n\n  return new Set(usedIEDs);\n}\n\n/** Function that returns unique name for a given element tag within parent scope\n * With given namesake the structure of the name of the namesake is use\n * @param parent - parent element that is the scope of name uniqueness\n * @param tagName - the element tag for which the name shall be unique\n * @param namesake - for predefined name structure\n */\nexport function uniqueSubstationElementName(\n  parent: Element,\n  tagName: string,\n  namesake?: string\n): string {\n  const siblingNames = getChildElementsByTagName(parent, tagName).map(\n    child => child.getAttribute('name') ?? child.tagName\n  );\n  if (!siblingNames.length) return tagName + '01';\n\n  const lastDigit = namesake ? namesake.match(/\\d+$/)?.[0] : undefined;\n\n  let newName = '';\n  for (let i = 0; i < siblingNames.length; i++) {\n    if (!lastDigit) newName = (namesake ?? tagName) + (i + 1);\n    else {\n      const newDigit = (Number.parseInt(lastDigit, 10) + (i + 1))\n        .toString()\n        .padStart(lastDigit.length, '0');\n      newName = namesake!.replace(lastDigit, newDigit);\n    }\n\n    if (!siblingNames.includes(newName)) return newName;\n  }\n\n  return newName;\n}\n\n/** A dialog that allows users of substation element clone function to add some configuration */\nexport function redirectDialog(cloneEntity: Element): TemplateResult {\n  const parent = cloneEntity.parentElement;\n  const tagName = cloneEntity.tagName;\n  const namesake = cloneEntity.getAttribute('name');\n\n  const newName =\n    parent && namesake\n      ? uniqueSubstationElementName(parent, tagName, namesake)\n      : parent\n      ? uniqueSubstationElementName(parent, tagName)\n      : '';\n\n  const entitySiblings = (\n    parent ? getChildElementsByTagName(parent, tagName) : []\n  )\n    .map(sibling => sibling.getAttribute('name'))\n    .filter(name => name);\n\n  return html` <mwc-dialog\n    stacked\n    heading=\"${get('substation.clone.redirect')}\"\n  >\n    <wizard-textfield\n      label=\"${get('substation.clone.newname')}\"\n      value=\"${newName}\"\n      .reservedValues=\"${entitySiblings}\"\n    ></wizard-textfield>\n    ${Array.from(referencedIEDs(cloneEntity)).map(ied => {\n      const validOtherIEDs = validUnreferencedIEDs(ied, cloneEntity).map(\n        ied => ied.getAttribute('name')!\n      );\n      const userChoice = ['no'].concat(validOtherIEDs);\n\n      return html`<mwc-select\n        required\n        fixedMenuPosition\n        value=\"${userChoice[0]}\"\n        label=\"${ied.getAttribute('name')!}\"\n        >${userChoice.map(\n          iedName => html`<mwc-list-item value=\"${iedName}\"\n            >${iedName}</mwc-list-item\n          >`\n        )}</mwc-select\n      >`;\n    })}\n    <mwc-button\n      slot=\"secondaryAction\"\n      dialogAction=\"close\"\n      label=\"${get('close')}\"\n      style=\"--mdc-theme-primary: var(--mdc-theme-error)\"\n    ></mwc-button>\n    <mwc-button\n      slot=\"primaryAction\"\n      dialogAction=\"close\"\n      label=\"${get('substation.clone.cloneclose')}\"\n      icon=\"content_copy\"\n      @click=${(evt: Event) => cloneWithRedirect(evt, cloneEntity)}\n    ></mwc-button>\n    <mwc-button\n      slot=\"primaryAction\"\n      label=\"${get('substation.clone.cloneproc')}\"\n      icon=\"content_copy\"\n      @click=${(evt: Event) => cloneWithRedirect(evt, cloneEntity)}\n    ></mwc-button>\n  </mwc-dialog>`;\n}\n\nexport function someAvailableRedirection(cloneEntity: Element): boolean {\n  return !Array.from(referencedIEDs(cloneEntity)).every(\n    ied => !validUnreferencedIEDs(ied, cloneEntity).length\n  );\n}\n\nexport async function cloneSubstationElement(\n  editor: BayEditor | VoltageLevelEditor | SubstationEditor\n): Promise<void> {\n  const cloneEntity = editor.element;\n  if (someAvailableRedirection(cloneEntity)) {\n    editor.cloneUI = true;\n    await editor.updateComplete;\n\n    editor.dialog.show();\n  } else {\n    const parent = editor.element.parentElement;\n    const namesake = editor.element.getAttribute('name') ?? undefined;\n    if (!parent) return;\n\n    const newName = uniqueSubstationElementName(\n      parent,\n      editor.element.tagName,\n      namesake\n    );\n\n    const element = substationElementClone(editor.element, newName);\n\n    editor.dispatchEvent(newActionEvent({ new: { parent, element } }));\n  }\n}\n\nexport type ElementEditor = Element & {\n  element: Element;\n};\nexport type ElementEditorClass<T extends ElementEditor> = new () => T;\n\n/**\n * Moves the element edited by `editor` to the place before the next `Child`\n * editor selected or to the end of the next `Parent` editor selected by mouse\n * click or keyboard (space or enter key).\n *\n * The move action can be aborted by clicking on something other than a `Child`\n * or `Parent` editor or by hitting the escape key on the keyboard.\n */\nexport function startMove<\n  E extends ElementEditor,\n  C extends ElementEditorClass<ElementEditor>,\n  P extends ElementEditorClass<ElementEditor>\n>(editor: E, childClass: C, parentClasses: P[]): void {\n  if (!editor.element) return;\n\n  editor.classList.add('moving');\n\n  const moveToTarget = (e: MouseEvent | KeyboardEvent) => {\n    if (\n      e instanceof KeyboardEvent &&\n      e.key !== 'Escape' &&\n      e.key !== ' ' &&\n      e.key !== 'Enter'\n    )\n      return;\n\n    e.preventDefault();\n    e.stopImmediatePropagation();\n    editor.classList.remove('moving');\n\n    window.removeEventListener('keydown', moveToTarget, true);\n    window.removeEventListener('click', moveToTarget, true);\n\n    if (e instanceof KeyboardEvent && e.key === 'Escape') return;\n\n    const targetEditor = e\n      .composedPath()\n      .find(\n        et =>\n          et instanceof childClass ||\n          checkInstanceOfParentClass(et, parentClasses)\n      );\n    if (targetEditor === undefined || targetEditor === editor) return;\n\n    const destination =\n      targetEditor instanceof childClass\n        ? {\n            parent: targetEditor.element.parentElement!,\n            reference: targetEditor.element,\n          }\n        : { parent: (<E>targetEditor).element, reference: null };\n\n    if (!destination.parent) return;\n\n    if (\n      editor.element.parentElement !== destination.parent ||\n      editor.element.nextElementSibling !== destination.reference\n    )\n      editor.dispatchEvent(\n        newActionEvent({\n          old: {\n            element: editor.element,\n            parent: editor.element.parentElement!,\n            reference: editor.element.nextSibling,\n          },\n          new: destination,\n        })\n      );\n  };\n\n  window.addEventListener('click', moveToTarget, true);\n  window.addEventListener('keydown', moveToTarget, true);\n}\n\n/**\n * Check if the eventTarget that triggered the event is one of the classes that\n * we accepted as target to use to move an element to.\n *\n * @param et - The Event Target.\n * @param classes - The list of Classes which are acceptable.\n */\nfunction checkInstanceOfParentClass<E extends ElementEditor>(\n  et: EventTarget,\n  classes: ElementEditorClass<E>[]\n): boolean {\n  const targetEditor = classes.find(clazz => et instanceof clazz);\n  return targetEditor !== undefined;\n}\n\n/**\n * Get the correct icon for a specific Conducting Equipment.\n * @param condEq - The Conducting Equipment to search the icon for.\n * @returns The icon.\n */\nexport function getIcon(condEq: Element): TemplateResult {\n  return typeIcons[typeStr(condEq)] ?? generalConductingEquipmentIcon;\n}\n/**\n * Creates a general-equipment template literal.\n * FIXME(ca-d): this cannot update since it is not a LitElement instance method.\n * @param doc - Project xml document.\n * @param element - scl general-equipment element.\n * @param showfunctions - Whether rendered as action pane (true).\n * @returns - template literal.\n */\nexport function renderGeneralEquipment(\n  doc: XMLDocument,\n  element: Element,\n  showfunctions: boolean\n): TemplateResult {\n  const generalEquipment = getChildElementsByTagName(\n    element,\n    'GeneralEquipment'\n  );\n\n  return generalEquipment.length\n    ? html` <div\n        class=\"${classMap({\n          content: true,\n          actionicon: !showfunctions,\n        })}\"\n      >\n        ${generalEquipment.map(\n          gEquipment =>\n            html`<general-equipment-editor\n              .doc=${doc}\n              .element=${gEquipment}\n              ?showfunctions=${showfunctions}\n            ></general-equipment-editor>`\n        )}\n      </div>`\n    : html``;\n}\n\nconst typeIcons: Partial<Record<string, TemplateResult>> = {\n  CBR: circuitBreakerIcon,\n  DIS: disconnectorIcon,\n  CTR: currentTransformerIcon,\n  VTR: voltageTransformerIcon,\n  ERS: earthSwitchIcon,\n};\n\n// Substation element hierarchy\nconst substationPath = [\n  ':root',\n  'Substation',\n  'VoltageLevel',\n  'Bay',\n  'ConductingEquipment',\n];\n\nexport type SubstationTag =\n  | 'Substation'\n  | 'VoltageLevel'\n  | 'Bay'\n  | 'ConductingEquipment';\n\n/** `Private`-safeguarded selectors for `Substation` and its descendants */\nexport const selectors = <Record<SubstationTag, string>>(\n  Object.fromEntries(\n    substationPath.map((e, i, a) => [e, a.slice(0, i + 1).join(' > ')])\n  )\n);\n\n/** Common `CSS` styles used by substation subeditors */\nexport const styles = css`\n  abbr {\n    text-decoration: none;\n    border-bottom: none;\n  }\n\n  .ptrContent.actionicon {\n    display: grid;\n    grid-gap: 12px;\n    padding: 8px 12px 16px;\n    box-sizing: border-box;\n    grid-template-columns: repeat(auto-fit, minmax(64px, auto));\n  }\n\n  .content.actionicon {\n    display: grid;\n    grid-gap: 12px;\n    padding: 8px 12px 16px;\n    box-sizing: border-box;\n    grid-template-columns: repeat(auto-fit, minmax(64px, auto));\n  }\n\n  #iedcontainer {\n    display: grid;\n    grid-gap: 12px;\n    padding: 8px 12px 16px;\n    box-sizing: border-box;\n    grid-template-columns: repeat(auto-fit, minmax(64px, auto));\n  }\n\n  .container.lnode {\n    display: grid;\n    grid-gap: 12px;\n    padding: 8px 12px 16px;\n    box-sizing: border-box;\n    grid-template-columns: repeat(auto-fit, minmax(64px, auto));\n  }\n\n  mwc-dialog {\n    display: flex;\n    flex-direction: column;\n  }\n\n  mwc-dialog > * {\n    display: block;\n    margin-top: 16px;\n  }\n\n  powertransformer-editor[showfunctions] {\n    margin: 4px 8px 16px;\n  }\n\n  general-equipment-editor[showfunctions] {\n    margin: 4px 8px 16px;\n  }\n\n  .substation-editor-icon {\n    width: 24px;\n    height: 24px;\n  }\n`;\n"]}