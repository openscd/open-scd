{"version":3,"file":"subscriber-list.js","sourceRoot":"","sources":["../../../../src/editors/subscription/goose/subscriber-list.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  property,\n  TemplateResult,\n} from 'lit-element';\nimport { nothing } from 'lit-html';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-icon';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item';\n\nimport '@openscd/open-scd/src/filtered-list.js';\nimport {\n  identity,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport {\n  createElement,\n} from '@openscd/xml';\n\nimport {\n  ComplexAction,\n  Create,\n  Delete,\n  Move,\n  newActionEvent,\n} from '@openscd/core/foundation/deprecated/editor.js';\nimport {\n  GOOSESelectEvent,\n  GooseSubscriptionEvent,\n  newGooseSubscriptionEvent,\n} from './foundation.js';\nimport { emptyInputsDeleteActions } from '@openscd/open-scd/src/foundation/ied.js';\nimport {\n  canCreateValidExtRef,\n  createExtRefElement,\n  existExtRef,\n  getExistingSupervision,\n  getExtRef,\n  getFirstSubscribedExtRef,\n  IEDSelectEvent,\n  instantiateSubscriptionSupervision,\n  ListElement,\n  removeSubscriptionSupervision,\n  styles,\n  SubscriberListContainer,\n  SubscribeStatus,\n  View,\n  ViewEvent,\n} from '../foundation.js';\n\n/** Defining view outside the class, which makes it persistent. */\nlet view: View = View.PUBLISHER;\n\n/** An sub element for subscribing and unsubscribing IEDs to GOOSE messages. */\n@customElement('subscriber-list-goose')\nexport class SubscriberList extends SubscriberListContainer {\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  @property({ type: Number })\n  editCount = -1;\n\n  /** Current selected GOOSE message (when in GOOSE Publisher view) */\n  currentSelectedGseControl: Element | undefined;\n\n  /** The name of the IED belonging to the current selected GOOSE */\n  currentGooseIedName: string | undefined | null;\n\n  constructor() {\n    super();\n    this.onIEDSelectEvent = this.onIEDSelectEvent.bind(this);\n    this.onGOOSESelectEvent = this.onGOOSESelectEvent.bind(this);\n    this.onGooseSubscriptionEvent = this.onGooseSubscriptionEvent.bind(this);\n    this.onViewChange = this.onViewChange.bind(this);\n\n    const parentDiv = this.closest('.container');\n    if (parentDiv) {\n      parentDiv.addEventListener('ied-select', this.onIEDSelectEvent);\n      parentDiv.addEventListener('goose-select', this.onGOOSESelectEvent);\n      parentDiv.addEventListener(\n        'goose-subscription',\n        this.onGooseSubscriptionEvent\n      );\n      parentDiv.addEventListener('view', this.onViewChange);\n    }\n  }\n\n  private async onIEDSelectEvent(event: IEDSelectEvent) {\n    if (!event.detail.ied) return;\n    this.currentSelectedIed = event.detail.ied!;\n\n    this.resetElements();\n\n    const subscribedInputs = this.currentSelectedIed.querySelectorAll(\n      `LN0 > Inputs, LN > Inputs`\n    );\n\n    Array.from(this.doc.querySelectorAll('GSEControl'))\n      .filter(cb => cb.hasAttribute('datSet'))\n      .forEach(control => {\n        const ied = control.closest('IED')!;\n\n        if (\n          ied.getAttribute('name') ==\n          this.currentSelectedIed?.getAttribute('name')\n        )\n          return;\n\n        /** If no Inputs is available, it's automatically available. */\n        if (subscribedInputs.length == 0) {\n          this.availableElements.push({ element: control });\n          return;\n        }\n\n        let numberOfLinkedExtRefs = 0;\n        const dataSet = ied.querySelector(\n          `DataSet[name=\"${control.getAttribute('datSet')}\"]`\n        );\n\n        if (!dataSet) return;\n\n        dataSet!.querySelectorAll('FCDA').forEach(fcda => {\n          subscribedInputs.forEach(inputs => {\n            if (getExtRef(inputs, fcda, control)) {\n              numberOfLinkedExtRefs++;\n            }\n          });\n        });\n\n        if (numberOfLinkedExtRefs == 0) {\n          this.availableElements.push({ element: control });\n          return;\n        }\n\n        if (numberOfLinkedExtRefs >= dataSet!.querySelectorAll('FCDA').length) {\n          this.subscribedElements.push({ element: control });\n        } else {\n          this.availableElements.push({ element: control, partial: true });\n        }\n      });\n\n    this.requestUpdate();\n  }\n\n  private async onGOOSESelectEvent(event: GOOSESelectEvent) {\n    if (!event.detail.dataset || !event.detail.gseControl) return;\n\n    this.currentSelectedGseControl = event.detail.gseControl;\n    this.currentUsedDataset = event.detail.dataset;\n    this.currentGooseIedName = this.currentSelectedGseControl\n      ?.closest('IED')\n      ?.getAttribute('name');\n\n    this.resetElements();\n\n    Array.from(this.doc.querySelectorAll(':root > IED'))\n      .filter(ied => ied.getAttribute('name') != this.currentGooseIedName)\n      .forEach(ied => {\n        const inputElements = ied.querySelectorAll(`LN0 > Inputs, LN > Inputs`);\n\n        let numberOfLinkedExtRefs = 0;\n\n        /**\n         * If no Inputs element is found, we can safely say it's not subscribed.\n         */\n        if (!inputElements) {\n          this.availableElements.push({ element: ied });\n          return;\n        }\n\n        /**\n         * Count all the linked ExtRefs.\n         */\n        this.currentUsedDataset!.querySelectorAll('FCDA').forEach(fcda => {\n          inputElements.forEach(inputs => {\n            if (getExtRef(inputs, fcda, this.currentSelectedGseControl)) {\n              numberOfLinkedExtRefs++;\n            }\n          });\n        });\n\n        /**\n         * Make a distinction between not subscribed at all,\n         * partially subscribed and fully subscribed.\n         */\n        if (numberOfLinkedExtRefs == 0) {\n          this.availableElements.push({ element: ied });\n          return;\n        }\n\n        if (\n          numberOfLinkedExtRefs >=\n          this.currentUsedDataset!.querySelectorAll('FCDA').length\n        ) {\n          this.subscribedElements.push({ element: ied });\n        } else {\n          this.availableElements.push({ element: ied, partial: true });\n        }\n      });\n\n    this.requestUpdate();\n  }\n\n  private async onGooseSubscriptionEvent(event: GooseSubscriptionEvent) {\n    let iedToSubscribe = event.detail.element;\n\n    if (view == View.SUBSCRIBER) {\n      const dataSetName = event.detail.element.getAttribute('datSet');\n      this.currentUsedDataset =\n        event.detail.element.parentElement?.querySelector(\n          `DataSet[name=\"${dataSetName}\"]`\n        );\n      this.currentSelectedGseControl = event.detail.element;\n      this.currentGooseIedName = event.detail.element\n        .closest('IED')\n        ?.getAttribute('name');\n      iedToSubscribe = this.currentSelectedIed!;\n    }\n\n    switch (event.detail.subscribeStatus) {\n      case SubscribeStatus.Full: {\n        this.unsubscribe(iedToSubscribe);\n        break;\n      }\n      case SubscribeStatus.Partial: {\n        this.subscribe(iedToSubscribe);\n        break;\n      }\n      case SubscribeStatus.None: {\n        this.subscribe(iedToSubscribe);\n        break;\n      }\n    }\n  }\n\n  private async onViewChange(event: ViewEvent) {\n    view = event.detail.view;\n\n    this.currentSelectedIed = undefined;\n    this.currentSelectedGseControl = undefined;\n\n    this.resetElements();\n    this.requestUpdate();\n  }\n\n  private async subscribe(ied: Element): Promise<void> {\n    if (!ied.querySelector('LN0')) return;\n\n    let inputsElement = ied.querySelector('LN0 > Inputs');\n    if (!inputsElement)\n      inputsElement = createElement(ied.ownerDocument, 'Inputs', {});\n\n    const complexAction: ComplexAction = {\n      actions: [],\n      title: get(`subscription.connect`),\n    };\n\n    this.currentUsedDataset!.querySelectorAll('FCDA').forEach(fcda => {\n      if (\n        !existExtRef(inputsElement!, fcda, this.currentSelectedGseControl) &&\n        canCreateValidExtRef(fcda, this.currentSelectedGseControl)\n      ) {\n        const extRef = createExtRefElement(\n          this.currentSelectedGseControl,\n          fcda\n        );\n\n        if (inputsElement?.parentElement)\n          complexAction.actions.push({\n            new: { parent: inputsElement!, element: extRef },\n          });\n        else inputsElement?.appendChild(extRef);\n      }\n    });\n\n    // we need to extend the actions array with the actions for the instantiation of the LGOS\n    const supervisionActions = instantiateSubscriptionSupervision(\n      this.currentSelectedGseControl,\n      ied\n    );\n    if (inputsElement.parentElement) {\n      complexAction.actions.concat(supervisionActions);\n    } else {\n      /** If the IED doesn't have a Inputs element, just append it to the first LN0 element. */\n      const inputAction: (Create | Move)[] = [\n        {\n          new: { parent: ied.querySelector('LN0')!, element: inputsElement },\n        },\n      ];\n      complexAction.actions = inputAction.concat(supervisionActions);\n    }\n    this.dispatchEvent(newActionEvent(complexAction));\n  }\n\n  private async unsubscribe(ied: Element): Promise<void> {\n    const actions: Delete[] = [];\n    ied.querySelectorAll('LN0 > Inputs, LN > Inputs').forEach(inputs => {\n      this.currentUsedDataset!.querySelectorAll('FCDA').forEach(fcda => {\n        const extRef = getExtRef(inputs, fcda, this.currentSelectedGseControl);\n        if (extRef) actions.push({ old: { parent: inputs, element: extRef } });\n      });\n    });\n\n    // Check if empty Input Element should also be removed.\n    actions.push(...emptyInputsDeleteActions(actions));\n\n    // we need to extend the actions array with the actions for removing the supervision\n    actions.push(\n      ...removeSubscriptionSupervision(this.currentSelectedGseControl, ied)\n    );\n\n    this.dispatchEvent(\n      newActionEvent({\n        title: get('subscription.disconnect'),\n        actions: actions,\n      })\n    );\n  }\n\n  renderSubscriber(status: SubscribeStatus, element: Element): TemplateResult {\n    let firstSubscribedExtRef: Element | null = null;\n    let supervisionNode: Element | null = null;\n    if (status !== SubscribeStatus.None) {\n      if (view === View.PUBLISHER) {\n        firstSubscribedExtRef = getFirstSubscribedExtRef(\n          this.currentSelectedGseControl!,\n          element\n        );\n        supervisionNode = getExistingSupervision(firstSubscribedExtRef!);\n      } else {\n        firstSubscribedExtRef = getFirstSubscribedExtRef(\n          element,\n          this.currentSelectedIed!\n        );\n        supervisionNode = getExistingSupervision(firstSubscribedExtRef!);\n      }\n    }\n    return html` <mwc-list-item\n      @click=${() => {\n        this.dispatchEvent(\n          newGooseSubscriptionEvent(element, status ?? SubscribeStatus.None)\n        );\n      }}\n      graphic=\"avatar\"\n      ?hasMeta=${supervisionNode !== null}\n    >\n      <span\n        >${view == View.PUBLISHER\n          ? element.getAttribute('name')\n          : element.getAttribute('name') +\n            ` (${element.closest('IED')?.getAttribute('name')})`}</span\n      >\n      <mwc-icon slot=\"graphic\"\n        >${status == SubscribeStatus.Full ? html`clear` : html`add`}</mwc-icon\n      >\n      ${supervisionNode !== null\n        ? html`<mwc-icon title=\"${identity(supervisionNode)}\" slot=\"meta\"\n            >monitor_heart</mwc-icon\n          >`\n        : nothing}\n    </mwc-list-item>`;\n  }\n\n  renderUnSubscribers(elements: ListElement[]): TemplateResult {\n    return html`<mwc-list-item\n        noninteractive\n        value=\"${elements\n          .map(element => {\n            const id = identity(element.element) as string;\n            return typeof id === 'string' ? id : '';\n          })\n          .join(' ')}\"\n      >\n        <span>${get('subscription.subscriber.availableToSubscribe')}</span>\n      </mwc-list-item>\n      <li divider role=\"separator\"></li>\n      ${elements.length > 0\n        ? elements.map(element =>\n            this.renderSubscriber(SubscribeStatus.None, element.element)\n          )\n        : html`<mwc-list-item graphic=\"avatar\" noninteractive>\n            <span>${get('subscription.none')}</span>\n          </mwc-list-item>`}`;\n  }\n\n  renderPartiallySubscribers(elements: ListElement[]): TemplateResult {\n    return html`<mwc-list-item\n        noninteractive\n        value=\"${elements\n          .map(element => {\n            const id = identity(element.element) as string;\n            return typeof id === 'string' ? id : '';\n          })\n          .join(' ')}\"\n      >\n        <span>${get('subscription.subscriber.partiallySubscribed')}</span>\n      </mwc-list-item>\n      <li divider role=\"separator\"></li>\n      ${elements.length > 0\n        ? elements.map(element =>\n            this.renderSubscriber(SubscribeStatus.Partial, element.element)\n          )\n        : html`<mwc-list-item graphic=\"avatar\" noninteractive>\n            <span>${get('subscription.none')}</span>\n          </mwc-list-item>`}`;\n  }\n\n  renderFullSubscribers(): TemplateResult {\n    return html`<mwc-list-item\n        noninteractive\n        value=\"${this.subscribedElements\n          .map(element => {\n            const id = identity(element.element) as string;\n            return typeof id === 'string' ? id : '';\n          })\n          .join(' ')}\"\n      >\n        <span>${get('subscription.subscriber.subscribed')}</span>\n      </mwc-list-item>\n      <li divider role=\"separator\"></li>\n      ${this.subscribedElements.length > 0\n        ? this.subscribedElements.map(element =>\n            this.renderSubscriber(SubscribeStatus.Full, element.element)\n          )\n        : html`<mwc-list-item graphic=\"avatar\" noninteractive>\n            <span>${get('subscription.none')}</span>\n          </mwc-list-item>`}`;\n  }\n\n  renderTitle(): TemplateResult {\n    const gseControlName =\n      this.currentSelectedGseControl?.getAttribute('name') ?? undefined;\n\n    return view == View.PUBLISHER\n      ? html`<h1>\n          ${get('subscription.goose.publisher.subscriberTitle', {\n            selected: gseControlName\n              ? this.currentGooseIedName + ' > ' + gseControlName\n              : 'GOOSE',\n          })}\n        </h1>`\n      : html`<h1>\n          ${get('subscription.goose.subscriber.publisherTitle', {\n            selected: this.currentSelectedIed\n              ? this.currentSelectedIed.getAttribute('name')!\n              : 'IED',\n          })}\n        </h1>`;\n  }\n\n  protected firstUpdated(): void {\n    this.currentSelectedIed = undefined;\n  }\n\n  render(): TemplateResult {\n    return html`\n      <section tabindex=\"0\">\n        ${this.renderTitle()}\n        ${this.availableElements.length != 0 ||\n        this.subscribedElements.length != 0\n          ? html`<div class=\"wrapper\">\n              <filtered-list>\n                ${this.renderFullSubscribers()}\n                ${this.renderPartiallySubscribers(\n                  this.availableElements.filter(element => element.partial)\n                )}\n                ${this.renderUnSubscribers(\n                  this.availableElements.filter(element => !element.partial)\n                )}\n              </filtered-list>\n            </div>`\n          : html`<mwc-list>\n              <mwc-list-item noninteractive>\n                <span>${\n                  view == View.PUBLISHER\n                    ? get('subscription.subscriber.noControlBlockSelected')\n                    : get('subscription.subscriber.noIedSelected')\n                }</span>\n              </mwc-list-item>\n            </mwc-list>\n          </div>`}\n      </section>\n    `;\n  }\n\n  static styles = css`\n    ${styles}\n\n    .wrapper {\n      height: 100vh;\n      overflow-y: scroll;\n    }\n  `;\n}\n"]}