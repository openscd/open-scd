{"version":3,"file":"add-ln-dialog.js","sourceRoot":"","sources":["../../../src/editors/ied/add-ln-dialog.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  css,\r\n  customElement,\r\n  html,\r\n  LitElement,\r\n  property,\r\n  query,\r\n  state,\r\n  TemplateResult,\r\n} from 'lit-element';\r\nimport { translate } from 'lit-translate';\r\n\r\nimport { Dialog } from '@material/mwc-dialog';\r\nimport '@material/mwc-dialog';\r\nimport '@material/mwc-textfield';\r\nimport '@material/mwc-button';\r\nimport '@material/mwc-select';\r\nimport '@material/mwc-list/mwc-list-item';\r\n\r\nimport '../../components/tooltip';\r\nimport { OscdTooltip } from '../../components/tooltip';\r\nimport { getLNodeTypes } from './foundation';\r\n\r\nexport interface LNData {\r\n  lnType: string;\r\n  lnClass: string;\r\n  amount: number;\r\n  prefix?: string;\r\n}\r\n\r\n/** Dialog for adding a new LN to a LDevice. */\r\n@customElement('add-ln-dialog')\r\nexport class AddLnDialog extends LitElement {\r\n  @property({ attribute: false })\r\n  doc!: XMLDocument;\r\n\r\n  @property({ type: Function })\r\n  onConfirm!: (data: LNData) => void;\r\n\r\n  @query('#addLnDialog')\r\n  dialog!: Dialog;\r\n\r\n  @query('oscd-tooltip-4c6027dd')\r\n  tooltip!: OscdTooltip;\r\n\r\n  @state()\r\n  lnType: string = '';\r\n\r\n  @state()\r\n  amount: number = 1;\r\n\r\n  @state()\r\n  filterText = '';\r\n\r\n  @state()\r\n  prefix: string = '';\r\n\r\n  private get lNodeTypes(): Array<{\r\n    id: string;\r\n    lnClass: string;\r\n    desc?: string;\r\n  }> {\r\n    if (!this.doc) return [];\r\n    return getLNodeTypes(this.doc).map(lnType => ({\r\n      id: lnType.getAttribute('id') || '',\r\n      lnClass: lnType.getAttribute('lnClass') || '',\r\n      desc: lnType.getAttribute('desc') || undefined,\r\n    }));\r\n  }\r\n\r\n  private get filteredLNodeTypes() {\r\n    const filter = this.filterText.trim().toLowerCase();\r\n    if (!filter) return this.lNodeTypes;\r\n    return this.lNodeTypes.filter(\r\n      t =>\r\n        t.lnClass.toLowerCase().includes(filter) ||\r\n        t.id.toLowerCase().includes(filter) ||\r\n        (t.desc?.toLowerCase().includes(filter) ?? false)\r\n    );\r\n  }\r\n\r\n  public show(): void {\r\n    this.lnType = '';\r\n    this.amount = 1;\r\n    this.filterText = '';\r\n    this.prefix = '';\r\n    this.dialog.show();\r\n  }\r\n\r\n  private close(): void {\r\n    this.dialog.close();\r\n  }\r\n\r\n  private isPrefixValid(prefix: string): boolean {\r\n    if (prefix === '') return true;\r\n    if (prefix.length > 8) return false;\r\n    return /^[A-Za-z][0-9A-Za-z_]*$/.test(prefix);\r\n  }\r\n\r\n  private handleCreate(): void {\r\n    const selectedType = this.lNodeTypes.find(t => t.id === this.lnType);\r\n    if (!selectedType) return;\r\n    const data: LNData = {\r\n      lnType: selectedType.id,\r\n      lnClass: selectedType.lnClass,\r\n      amount: this.amount,\r\n      ...(this.prefix && { prefix: this.prefix }),\r\n    };\r\n\r\n    this.onConfirm(data);\r\n    this.close();\r\n  }\r\n\r\n  private onListItemEnter(e: MouseEvent, id: string): void {\r\n    const target = e.currentTarget as HTMLElement;\r\n    const idSpan = target.querySelector('[data-ln-id]') as HTMLElement;\r\n\r\n    const isOverflowing = idSpan.scrollWidth > idSpan.clientWidth;\r\n    if (!isOverflowing || !this.tooltip) return;\r\n\r\n    this.tooltip.show(id, e.clientX, e.clientY);\r\n  }\r\n\r\n  private onListItemMove(e: MouseEvent): void {\r\n    if (!this.tooltip || !this.tooltip.visible) return;\r\n    this.tooltip.updatePosition(e.clientX, e.clientY);\r\n  }\r\n\r\n  private onListItemLeave(): void {\r\n    if (this.tooltip) {\r\n      this.tooltip.hide();\r\n    }\r\n  }\r\n\r\n  render(): TemplateResult {\r\n    return html`\r\n      <mwc-dialog\r\n        id=\"addLnDialog\"\r\n        heading=${translate('iededitor.addLnDialog.title')}\r\n        @closed=${this.close}\r\n      >\r\n        <div class=\"dialog-content\">\r\n          <div class=\"ln-list-container\">\r\n            <mwc-textfield\r\n              label=\"${translate('iededitor.addLnDialog.filter')}\"\r\n              icon=\"search\"\r\n              type=\"text\"\r\n              .value=${this.filterText}\r\n              @input=${(e: Event) => {\r\n                e.stopPropagation();\r\n                this.filterText = (e.target as HTMLInputElement).value;\r\n              }}\r\n              style=\"margin-bottom: 8px; width: 100%;\"\r\n            ></mwc-textfield>\r\n            <div class=\"ln-list-scroll\">\r\n              <mwc-list\r\n                style=\"width: 100%;\"\r\n                @click=${(e: Event) => e.stopPropagation()}\r\n              >\r\n                ${this.filteredLNodeTypes.length === 0\r\n                  ? html`<mwc-list-item disabled\r\n                      >${translate(\r\n                        'iededitor.addLnDialog.noResults'\r\n                      )}</mwc-list-item\r\n                    >`\r\n                  : this.filteredLNodeTypes.map(\r\n                      t => html`\r\n                        <mwc-list-item\r\n                          .selected=${this.lnType === t.id}\r\n                          type=\"button\"\r\n                          @click=${(e: Event) => {\r\n                            e.stopPropagation();\r\n                            this.lnType = t.id;\r\n                          }}\r\n                          value=${t.id}\r\n                          dialogAction=\"none\"\r\n                          style=\"cursor: pointer;\"\r\n                          @mouseenter=${(e: MouseEvent) =>\r\n                            this.onListItemEnter(e, t.id)}\r\n                          @mousemove=${(e: MouseEvent) =>\r\n                            this.onListItemMove(e)}\r\n                          @mouseleave=${() => this.onListItemLeave()}\r\n                        >\r\n                          <span class=\"ln-list-id\" data-ln-id>${t.id}</span>\r\n                          <span class=\"ln-list-desc\">${t.desc || ''}</span>\r\n                        </mwc-list-item>\r\n                      `\r\n                    )}\r\n              </mwc-list>\r\n            </div>\r\n          </div>\r\n          <mwc-textfield\r\n            label=\"${translate('iededitor.addLnDialog.prefix')}\"\r\n            type=\"text\"\r\n            maxlength=\"8\"\r\n            .value=${this.prefix}\r\n            @input=${(e: Event) => {\r\n              e.stopPropagation();\r\n              this.prefix = (e.target as HTMLInputElement).value;\r\n            }}\r\n            pattern=\"[A-Za-z][0-9A-Za-z_]*\"\r\n            style=\"width: 100%; margin-top: 12px;\"\r\n            data-testid=\"prefix\"\r\n          ></mwc-textfield>\r\n          <mwc-textfield\r\n            label=${translate('iededitor.addLnDialog.amount')}\r\n            type=\"number\"\r\n            min=\"1\"\r\n            data-testid=\"amount\"\r\n            .value=${this.amount}\r\n            @input=${(e: Event) => {\r\n              e.stopPropagation();\r\n              this.amount = Number((e.target as HTMLInputElement).value);\r\n            }}\r\n            @click=${(e: Event) => e.stopPropagation()}\r\n            @mousedown=${(e: Event) => e.stopPropagation()}\r\n            @mouseup=${(e: Event) => e.stopPropagation()}\r\n            style=\"width: 100%; margin-top: 12px;\"\r\n          ></mwc-textfield>\r\n        </div>\r\n        <mwc-button\r\n          slot=\"secondaryAction\"\r\n          @click=${this.close}\r\n          style=\"--mdc-theme-primary: var(--mdc-theme-error)\"\r\n        >\r\n          ${translate('close')}\r\n        </mwc-button>\r\n        <mwc-button\r\n          slot=\"primaryAction\"\r\n          icon=\"add\"\r\n          trailingIcon\r\n          data-testid=\"add-ln-button\"\r\n          @click=${this.handleCreate}\r\n          ?disabled=${!this.lnType ||\r\n          this.amount < 1 ||\r\n          this.amount % 1 != 0 ||\r\n          !this.isPrefixValid(this.prefix)}\r\n        >\r\n          ${translate('add')}\r\n        </mwc-button>\r\n        <oscd-tooltip-4c6027dd role=\"tooltip\"></oscd-tooltip-4c6027dd>\r\n      </mwc-dialog>\r\n    `;\r\n  }\r\n\r\n  static styles = css`\r\n    .dialog-content {\r\n      margin-top: 16px;\r\n      width: 400px;\r\n      max-width: 100vw;\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    .ln-list-scroll {\r\n      width: 100%;\r\n      height: 240px;\r\n      overflow-y: auto;\r\n      border: 1px solid #ccc;\r\n      border-radius: 4px;\r\n      background: var(--mdc-theme-surface, #fff);\r\n    }\r\n\r\n    mwc-list-item {\r\n      --mdc-list-item-graphic-size: 0;\r\n      min-height: 56px;\r\n      height: 56px;\r\n      max-height: 56px;\r\n      padding-top: 0;\r\n      padding-bottom: 0;\r\n    }\r\n\r\n    mwc-list-item[selected] {\r\n      background: var(--mdc-theme-primary, #6200ee);\r\n    }\r\n\r\n    mwc-list-item[selected] .ln-list-id,\r\n    mwc-list-item[selected] .ln-list-desc {\r\n      color: var(--mdc-theme-on-primary, #fff);\r\n    }\r\n\r\n    mwc-list-item > span.ln-list-id,\r\n    mwc-list-item > span.ln-list-desc {\r\n      display: block;\r\n      width: 100%;\r\n    }\r\n\r\n    .ln-list-id {\r\n      font-size: 1em;\r\n      line-height: 1.2;\r\n      color: var(--mdc-theme-on-surface, #222);\r\n      white-space: nowrap;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n    }\r\n\r\n    .ln-list-desc {\r\n      font-size: 0.95em;\r\n      color: var(--mdc-theme-text-secondary-on-background, #666);\r\n      line-height: 1.1;\r\n      margin-top: 2px;\r\n      white-space: nowrap;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n    }\r\n  `;\r\n}\r\n"]}