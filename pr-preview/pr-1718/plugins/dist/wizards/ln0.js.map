{"version":3,"file":"ln0.js","sourceRoot":"","sources":["../../src/wizards/ln0.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, TemplateResult } from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-list/mwc-list-item';\nimport '@openscd/open-scd/src/wizard-textfield.js';\nimport '@openscd/open-scd/src/wizard-select.js';\nimport {\n  getValue,\n  Wizard,\n  WizardActor,\n  WizardInputElement,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport { cloneElement } from '@openscd/xml';\n\nimport { SimpleAction } from '@openscd/core/foundation/deprecated/editor.js';\nimport { patterns } from './foundation/limits.js';\n\nfunction getLNodeTypeOptions(element: Element): string[] {\n  const doc = element.ownerDocument;\n  const lNodeTypes = Array.from(\n    doc.querySelectorAll('DataTypeTemplates > LNodeType[lnClass=\"LLN0\"]')\n  );\n  return lNodeTypes.map(lnt => lnt.getAttribute('id')!).filter(id => id);\n}\n\nexport function renderLN0Wizard(\n  lnodeTypeIds: string[],\n  lnType: string | null,\n  desc: string | null,\n  lnClass: string | null,\n  inst: string | null\n): TemplateResult[] {\n  return [\n    html`<wizard-select\n      label=\"lnType\"\n      .maybeValue=${lnType}\n      required\n      helper=\"${get('ln0.wizard.lnTypeHelper')}\"\n      >${lnodeTypeIds.map(\n        id => html`<mwc-list-item value=\"${id}\">${id}</mwc-list-item>`\n      )}</wizard-select\n    >`,\n    html`<wizard-textfield\n      label=\"desc\"\n      .maybeValue=${desc}\n      nullable\n      helper=\"${get('ln0.wizard.descHelper')}\"\n    ></wizard-textfield>`,\n    html`<wizard-textfield\n      label=\"lnClass\"\n      readonly\n      required\n      .maybeValue=${lnClass}\n      helper=\"${get('ln0.wizard.lnClassHelper')}\"\n    ></wizard-textfield>`,\n    html`<wizard-textfield\n      label=\"inst\"\n      .maybeValue=${inst}\n      readonly\n      helper=\"${get('ln0.wizard.instHelper')}\"\n    ></wizard-textfield>`,\n  ];\n}\n\nfunction updateAction(element: Element): WizardActor {\n  return (inputs: WizardInputElement[]): SimpleAction[] => {\n    const ldAttrs: Record<string, string | null> = {};\n    const ldKeys = ['lnType', 'desc', 'lnClass', 'inst'];\n    ldKeys.forEach(key => {\n      ldAttrs[key] = getValue(inputs.find(i => i.label === key)!);\n    });\n\n    if (ldKeys.some(key => ldAttrs[key] !== element.getAttribute(key))) {\n      const newElement = cloneElement(element, ldAttrs);\n      return [\n        {\n          old: { element },\n          new: { element: newElement },\n        },\n      ];\n    }\n    return [];\n  };\n}\n\nexport function editLN0Wizard(element: Element): Wizard {\n  const lnodeTypeIds = getLNodeTypeOptions(element);\n\n  return [\n    {\n      title: get('ln0.wizard.title.edit'),\n      element,\n      primary: {\n        icon: 'edit',\n        label: get('save'),\n        action: updateAction(element),\n      },\n      content: renderLN0Wizard(\n        lnodeTypeIds,\n        element.getAttribute('lnType'),\n        element.getAttribute('desc'),\n        element.getAttribute('lnClass'),\n        element.getAttribute('inst')\n      ),\n    },\n  ];\n}\n"]}