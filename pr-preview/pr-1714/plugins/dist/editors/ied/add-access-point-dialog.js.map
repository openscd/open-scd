{"version":3,"file":"add-access-point-dialog.js","sourceRoot":"","sources":["../../../src/editors/ied/add-access-point-dialog.ts"],"names":[],"mappings":";AAAA,OAAO,EACL,GAAG,EACH,IAAI,EACJ,UAAU,EACV,QAAQ,EACR,KAAK,EAEL,KAAK,EACL,aAAa,GACd,MAAM,aAAa,CAAC;AACrB,OAAO,EAAE,GAAG,EAAE,SAAS,EAAE,MAAM,eAAe,CAAC;AAG/C,OAAO,sBAAsB,CAAC;AAC9B,OAAO,sBAAsB,CAAC;AAC9B,OAAO,yBAAyB,CAAC;AACjC,OAAO,sBAAsB,CAAC;AAC9B,OAAO,yBAAyB,CAAC;AACjC,OAAO,sBAAsB,CAAC;AAC9B,OAAO,kCAAkC,CAAC;AAE1C,OAAO,EACL,2BAA2B,EAC3B,yBAAyB,GAC1B,MAAM,iBAAiB,CAAC;AAUzB,qDAAqD;AAE9C,IAAM,oBAAoB,GAA1B,MAAM,oBAAqB,SAAQ,UAAU;IAA7C;;QAeG,WAAM,GAAG,EAAE,CAAC;QAGZ,mBAAc,GAAG,KAAK,CAAC;QAGvB,mBAAc,GAAG,EAAE,CAAC;QAGpB,iBAAY,GAAG,EAAE,CAAC;IA6L5B,CAAC;IA3LC,IAAI,IAAI;QACN,OAAO,IAAI,CAAC,MAAM,EAAE,IAAI,IAAI,KAAK,CAAC;IACpC,CAAC;IAEO,cAAc,CAAC,IAAY;QACjC,MAAM,aAAa,GAAG,2BAA2B,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC5D,OAAO,CAAC,aAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IACvC,CAAC;IAED,IAAY,sBAAsB;QAChC,OAAO,yBAAyB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC7C,CAAC;IAEM,IAAI;QACT,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;IACrB,CAAC;IAEO,KAAK;QACX,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;QACjB,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;QAC5B,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;QACzB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;IACzB,CAAC;IAEO,KAAK;QACX,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;QACpB,IAAI,CAAC,KAAK,EAAE,CAAC;IACf,CAAC;IAEO,YAAY;QAClB,IAAI,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,EAAE;YACpC,MAAM,IAAI,GAA4B;gBACpC,IAAI,EAAE,IAAI,CAAC,MAAM;gBACjB,cAAc,EAAE,IAAI,CAAC,cAAc;gBACnC,cAAc,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,SAAS;gBACrE,YAAY,EACV,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,YAAY;oBACtC,CAAC,CAAC,IAAI,CAAC,YAAY;oBACnB,CAAC,CAAC,SAAS;aAChB,CAAC;YACF,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YACrB,IAAI,CAAC,KAAK,EAAE,CAAC;SACd;IACH,CAAC;IAEO,cAAc,CAAC,KAAa;QAClC,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,EAAE,CAAC;QAC7B,IAAI,CAAC,OAAO;YAAE,OAAO,EAAE,CAAC;QACxB,IAAI,CAAC,4BAA4B,CAAC,IAAI,CAAC,OAAO,CAAC;YAC7C,OAAO,GAAG,CAAC,gDAAgD,CAAC,CAAC;QAC/D,IAAI,OAAO,CAAC,MAAM,GAAG,EAAE;YACrB,OAAO,GAAG,CAAC,iDAAiD,CAAC,CAAC;QAChE,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC;YAC/B,OAAO,GAAG,CAAC,gDAAgD,CAAC,CAAC;QAC/D,OAAO,EAAE,CAAC;IACZ,CAAC;IAEO,qBAAqB;QAC3B,OAAO,IAAI,CAAA;;gBAEC,SAAS,CAAC,+CAA+C,CAAC;;;sBAGpD,IAAI,CAAC,cAAc;qBACpB,IAAI,CAAC,cAAc;oBACpB,CAAC,CAAQ,EAAE,EAAE;YACrB,IAAI,CAAC,cAAc,GAAI,CAAC,CAAC,MAA2B,CAAC,OAAO,CAAC;YAC7D,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc;gBACvC,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC,CAAC;gBAChC,CAAC,CAAC,EAAE,CAAC;QACT,CAAC;;;QAGH,IAAI,CAAC,cAAc;YACnB,CAAC,CAAC,IAAI,CAAA;;sBAEQ,SAAS,CACf,kDAAkD,CACnD;uBACQ,IAAI,CAAC,cAAc;wBAClB,CAAC,CAAQ,EAAE,EAAE;gBACrB,CAAC,CAAC,eAAe,EAAE,CAAC;gBACpB,IAAI,CAAC,cAAc,GAAI,CAAC,CAAC,MAA4B,CAAC,KAAK,CAAC;YAC9D,CAAC;uBACQ,CAAC,CAAQ,EAAE,EAAE,CAAC,CAAC,CAAC,eAAe,EAAE;wBAChC,CAAC,CAAQ,EAAE,EAAE,CAAC,CAAC,CAAC,eAAe,EAAE;;;gBAGzC,IAAI,CAAC,sBAAsB,CAAC,GAAG,CAC/B,CAAC,EAAU,EAAE,EAAE,CACb,IAAI,CAAA,wBAAwB,EAAE,IAAI,EAAE,kBAAkB,CACzD;;;sBAGO,SAAS,CAAC,6CAA6C,CAAC;uBACvD,IAAI,CAAC,YAAY;uBACjB,CAAC,CAAQ,EAAE,EAAE;gBACpB,IAAI,CAAC,YAAY,GAAI,CAAC,CAAC,MAA2B,CAAC,KAAK,CAAC;YAC3D,CAAC;;;WAGJ;YACH,CAAC,CAAC,EAAE;KACP,CAAC;IACJ,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAA;;;kBAGG,SAAS,CAAC,sCAAsC,CAAC;kBACjD,IAAI,CAAC,KAAK;;;;;oBAKR,SAAS,CAAC,uCAAuC,CAAC;qBACjD,IAAI,CAAC,MAAM;iCACC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC;iCAChC,CAAC,KAAa,EAAE,EAAE;YACrC,MAAM,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;YACzC,OAAO;gBACL,KAAK,EAAE,KAAK,KAAK,EAAE;gBACnB,WAAW,EAAE,KAAK,KAAK,EAAE;aAC1B,CAAC;QACJ,CAAC;;;;;qBAKQ,SAAS,CAAC,uCAAuC,CAAC;;;qBAGlD,CAAC,CAAQ,EAAE,EAAE;YACpB,IAAI,CAAC,MAAM,GAAI,CAAC,CAAC,MAA2B,CAAC,KAAK,CAAC;QACrD,CAAC;;YAED,IAAI,CAAC,qBAAqB,EAAE;;;;mBAIrB,IAAI,CAAC,KAAK;;;YAGjB,SAAS,CAAC,OAAO,CAAC;;;;;;mBAMX,IAAI,CAAC,YAAY;;sBAEd,CAAC,IAAI,CAAC,MAAM;YACxB,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,KAAK;YAChC,CAAC,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC;;YAE3C,SAAS,CAAC,KAAK,CAAC;;;KAGvB,CAAC;IACJ,CAAC;;AAEM,2BAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;GAuBlB,CAAC;AAlNF;IADC,QAAQ,EAAE;iDACO;AAGlB;IADC,QAAQ,EAAE;iDACG;AAGd;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC;uDACuB;AAEjB;IAAlC,KAAK,CAAC,0BAA0B,CAAC;oDAAiB;AAEjC;IAAjB,KAAK,CAAC,SAAS,CAAC;yDAAyB;AAG1C;IADC,KAAK,EAAE;oDACY;AAGpB;IADC,KAAK,EAAE;4DACuB;AAG/B;IADC,KAAK,EAAE;4DACoB;AAG5B;IADC,KAAK,EAAE;0DACkB;AAxBf,oBAAoB;IADhC,aAAa,CAAC,yBAAyB,CAAC;GAC5B,oBAAoB,CAqNhC;SArNY,oBAAoB","sourcesContent":["import {\r\n  css,\r\n  html,\r\n  LitElement,\r\n  property,\r\n  state,\r\n  TemplateResult,\r\n  query,\r\n  customElement,\r\n} from 'lit-element';\r\nimport { get, translate } from 'lit-translate';\r\n\r\nimport { Dialog } from '@material/mwc-dialog';\r\nimport '@material/mwc-dialog';\r\nimport '@material/mwc-button';\r\nimport '@material/mwc-textfield';\r\nimport '@material/mwc-switch';\r\nimport '@material/mwc-formfield';\r\nimport '@material/mwc-select';\r\nimport '@material/mwc-list/mwc-list-item';\r\n\r\nimport {\r\n  getExistingAccessPointNames,\r\n  getAccessPointsWithServer,\r\n} from './foundation.js';\r\nimport { TextField } from '@material/mwc-textfield';\r\n\r\nexport interface AccessPointCreationData {\r\n  name: string;\r\n  createServerAt: boolean;\r\n  serverAtApName?: string;\r\n  serverAtDesc?: string;\r\n}\r\n\r\n/** A dialog component for adding new AccessPoints */\r\n@customElement('add-access-point-dialog')\r\nexport class AddAccessPointDialog extends LitElement {\r\n  @property()\r\n  doc!: XMLDocument;\r\n\r\n  @property()\r\n  ied!: Element;\r\n\r\n  @property({ type: Function })\r\n  onConfirm!: (data: AccessPointCreationData) => void;\r\n\r\n  @query('#createAccessPointDialog') dialog!: Dialog;\r\n\r\n  @query('#apName') apNameField!: TextField;\r\n\r\n  @state()\r\n  private apName = '';\r\n\r\n  @state()\r\n  private createServerAt = false;\r\n\r\n  @state()\r\n  private serverAtApName = '';\r\n\r\n  @state()\r\n  private serverAtDesc = '';\r\n\r\n  get open() {\r\n    return this.dialog?.open ?? false;\r\n  }\r\n\r\n  private isApNameUnique(name: string): boolean {\r\n    const existingNames = getExistingAccessPointNames(this.ied);\r\n    return !existingNames.includes(name);\r\n  }\r\n\r\n  private get accessPointsWithServer(): string[] {\r\n    return getAccessPointsWithServer(this.ied);\r\n  }\r\n\r\n  public show(): void {\r\n    this.reset();\r\n    this.dialog.show();\r\n  }\r\n\r\n  private reset(): void {\r\n    this.apName = '';\r\n    this.createServerAt = false;\r\n    this.serverAtApName = '';\r\n    this.serverAtDesc = '';\r\n  }\r\n\r\n  private close(): void {\r\n    this.dialog.close();\r\n    this.reset();\r\n  }\r\n\r\n  private handleCreate(): void {\r\n    if (this.apNameField.checkValidity()) {\r\n      const data: AccessPointCreationData = {\r\n        name: this.apName,\r\n        createServerAt: this.createServerAt,\r\n        serverAtApName: this.createServerAt ? this.serverAtApName : undefined,\r\n        serverAtDesc:\r\n          this.createServerAt && this.serverAtDesc\r\n            ? this.serverAtDesc\r\n            : undefined,\r\n      };\r\n      this.onConfirm(data);\r\n      this.close();\r\n    }\r\n  }\r\n\r\n  private getApNameError(value: string): string {\r\n    const trimmed = value.trim();\r\n    if (!trimmed) return '';\r\n    if (!/^[A-Za-z0-9][0-9A-Za-z_]*$/.test(trimmed))\r\n      return get('iededitor.addAccessPointDialog.nameFormatError');\r\n    if (trimmed.length > 32)\r\n      return get('iededitor.addAccessPointDialog.nameTooLongError');\r\n    if (!this.isApNameUnique(trimmed))\r\n      return get('iededitor.addAccessPointDialog.nameUniqueError');\r\n    return '';\r\n  }\r\n\r\n  private renderServerAtSection(): TemplateResult {\r\n    return html`\r\n      <mwc-formfield\r\n        label=${translate('iededitor.addAccessPointDialog.createServerAt')}\r\n      >\r\n        <mwc-switch\r\n          ?selected=${this.createServerAt}\r\n          ?checked=${this.createServerAt}\r\n          @change=${(e: Event) => {\r\n            this.createServerAt = (e.target as HTMLInputElement).checked;\r\n            this.serverAtApName = this.createServerAt\r\n              ? this.accessPointsWithServer[0]\r\n              : '';\r\n          }}\r\n        ></mwc-switch>\r\n      </mwc-formfield>\r\n      ${this.createServerAt\r\n        ? html`\r\n            <mwc-select\r\n              label=${translate(\r\n                'iededitor.addAccessPointDialog.selectAccessPoint'\r\n              )}\r\n              .value=${this.serverAtApName}\r\n              @change=${(e: Event) => {\r\n                e.stopPropagation();\r\n                this.serverAtApName = (e.target as HTMLSelectElement).value;\r\n              }}\r\n              @click=${(e: Event) => e.stopPropagation()}\r\n              @closed=${(e: Event) => e.stopPropagation()}\r\n              style=\"width: 100%; margin-bottom: 16px;\"\r\n            >\r\n              ${this.accessPointsWithServer.map(\r\n                (ap: string) =>\r\n                  html`<mwc-list-item value=${ap}>${ap}</mwc-list-item>`\r\n              )}\r\n            </mwc-select>\r\n            <mwc-textfield\r\n              label=${translate('iededitor.addAccessPointDialog.serverAtDesc')}\r\n              .value=${this.serverAtDesc}\r\n              @input=${(e: Event) => {\r\n                this.serverAtDesc = (e.target as HTMLInputElement).value;\r\n              }}\r\n              style=\"width: 100%; margin-bottom: 16px;\"\r\n            ></mwc-textfield>\r\n          `\r\n        : ''}\r\n    `;\r\n  }\r\n\r\n  render(): TemplateResult {\r\n    return html`\r\n      <mwc-dialog\r\n        id=\"createAccessPointDialog\"\r\n        heading=${translate('iededitor.addAccessPointDialog.title')}\r\n        @closed=${this.close}\r\n      >\r\n        <div class=\"dialog-content\">\r\n          <mwc-textfield\r\n            id=\"apName\"\r\n            label=${translate('iededitor.addAccessPointDialog.apName')}\r\n            .value=${this.apName}\r\n            .validationMessage=${this.getApNameError(this.apName)}\r\n            .validityTransform=${(value: string) => {\r\n              const error = this.getApNameError(value);\r\n              return {\r\n                valid: error === '',\r\n                customError: error !== '',\r\n              };\r\n            }}\r\n            pattern=\"[A-Za-z0-9][0-9A-Za-z_]*\"\r\n            maxLength=\"32\"\r\n            required\r\n            autoValidate\r\n            helper=${translate('iededitor.addAccessPointDialog.apName')}\r\n            dialogInitialFocus\r\n            style=\"width: 100%; margin-bottom: 16px;\"\r\n            @input=${(e: Event) => {\r\n              this.apName = (e.target as HTMLInputElement).value;\r\n            }}\r\n          ></mwc-textfield>\r\n          ${this.renderServerAtSection()}\r\n        </div>\r\n        <mwc-button\r\n          slot=\"secondaryAction\"\r\n          @click=${this.close}\r\n          style=\"--mdc-theme-primary: var(--mdc-theme-error)\"\r\n        >\r\n          ${translate('close')}\r\n        </mwc-button>\r\n        <mwc-button\r\n          slot=\"primaryAction\"\r\n          icon=\"add\"\r\n          trailingIcon\r\n          @click=${this.handleCreate}\r\n          data-testid=\"add-access-point-button\"\r\n          ?disabled=${!this.apName ||\r\n          !this.apNameField.validity.valid ||\r\n          (this.createServerAt && !this.serverAtApName)}\r\n        >\r\n          ${translate('add')}\r\n        </mwc-button>\r\n      </mwc-dialog>\r\n    `;\r\n  }\r\n\r\n  static styles = css`\r\n    .dialog-content {\r\n      margin-top: 16px;\r\n      width: 320px;\r\n      max-width: 100vw;\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    mwc-formfield {\r\n      display: block;\r\n    }\r\n\r\n    mwc-select,\r\n    mwc-textfield {\r\n      width: 100%;\r\n      min-width: 0;\r\n      max-width: 100%;\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    mwc-formfield {\r\n      margin-bottom: 12px;\r\n    }\r\n  `;\r\n}\r\n"]}