{"version":3,"file":"ldevice-container.js","sourceRoot":"","sources":["../../../src/editors/ied/ldevice-container.ts"],"names":[],"mappings":";AAAA,OAAO,EACL,GAAG,EACH,aAAa,EACb,IAAI,EACJ,QAAQ,EAER,KAAK,EACL,KAAK,GAEN,MAAM,aAAa,CAAC;AACrB,OAAO,EAAE,OAAO,EAAE,MAAM,UAAU,CAAC;AACnC,OAAO,EAAE,GAAG,EAAE,SAAS,EAAE,MAAM,eAAe,CAAC;AAI/C,OAAO,EAAE,cAAc,EAAE,MAAM,eAAe,CAAC;AAC/C,OAAO,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAC7C,OAAO,EAAE,iBAAiB,EAAE,MAAM,0CAA0C,CAAC;AAC7E,OAAO,EACL,uBAAuB,EACvB,oBAAoB,EACpB,gBAAgB,EAChB,kBAAkB,EAClB,cAAc,GACf,MAAM,qCAAqC,CAAC;AAE7C,OAAO,EAAE,OAAO,EAAE,MAAM,iCAAiC,CAAC;AAC1D,OAAO,EAAE,SAAS,EAAE,MAAM,iBAAiB,CAAC;AAC5C,OAAO,EAAE,eAAe,EAAE,MAAM,4DAA4D,CAAC;AAG7F,OAAO,sCAAsC,CAAC;AAC9C,OAAO,mBAAmB,CAAC;AAC3B,OAAO,oBAAoB,CAAC;AAE5B,gEAAgE;AAEzD,IAAM,gBAAgB,GAAtB,MAAM,gBAAiB,SAAQ,SAAS;IAAxC;;QAEL,sBAAiB,GAAa,EAAE,CAAC;IAwInC,CAAC;IAhIS,cAAc;QACpB,MAAM,MAAM,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACrD,IAAI,MAAM;YAAE,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,CAAC;IACzD,CAAC;IAEO,MAAM;QACZ,MAAM,UAAU,GACd,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,oBAAoB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACvE,MAAM,IAAI,GAAG,uBAAuB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACnD,MAAM,MAAM,GAAG,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAEhD,OAAO,IAAI,CAAA,GAAG,UAAU,GAAG,IAAI,CAAC,CAAC,CAAC,IAAI,CAAA,YAAY,IAAI,EAAE,CAAC,CAAC,CAAC,OAAO,GAAG,MAAM;YACzE,CAAC,CAAC,IAAI,CAAA,YAAY,MAAM,EAAE;YAC1B,CAAC,CAAC,OAAO,EAAE,CAAC;IAChB,CAAC;IAES,YAAY;QACpB,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAES,OAAO,CAAC,kBAAkC;QAClD,KAAK,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;QAElC,gGAAgG;QAChG,IAAI,kBAAkB,CAAC,GAAG,CAAC,mBAAmB,CAAC,EAAE;YAC/C,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;SAClC;IACH,CAAC;IAGD,IAAY,UAAU;QACpB,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,iBAAiB,CAAC,CAAC,CAAC,MAAM,CACxE,OAAO,CAAC,EAAE;YACR,MAAM,OAAO,GAAG,OAAO,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;YACtD,OAAO,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QAClD,CAAC,CACF,CAAC;IACJ,CAAC;IAEO,WAAW,CAAC,IAAY;QAC9B,MAAM,OAAO,GAAG,eAAe,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QACpD,MAAM,OAAO,GAAG,EAAE,CAAC;QAEnB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpC,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACnC,IAAI,CAAC,IAAI;gBAAE,MAAM;YACjB,MAAM,OAAO,GAAG;gBACd,OAAO,EAAE,IAAI,CAAC,OAAO;gBACrB,MAAM,EAAE,IAAI,CAAC,MAAM;gBACnB,IAAI,EAAE,IAAI;gBACV,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;aAChD,CAAC;YACF,MAAM,EAAE,GAAG,aAAa,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;YAClD,OAAO,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,EAAE,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;SACnE;QAED,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;IAC9C,CAAC;IAED,MAAM;QACJ,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;QAEnC,OAAO,IAAI,CAAA,wBAAwB,IAAI,CAAC,MAAM,EAAE;8BACtB,iBAAiB;mCACZ,GAAG,CAAC,MAAM,CAAC;;;mBAG3B,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE;;;kCAGZ,SAAS,CAAC,6BAA6B,CAAC;;;mBAGvD,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE;;;QAGxC,UAAU,CAAC,MAAM,GAAG,CAAC;YACrB,CAAC,CAAC,IAAI,CAAA;;qBAEO,GAAG,CAAC,+BAA+B,CAAC;;;;;;;uBAOlC,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,EAAE;;kBAE/B;YACV,CAAC,CAAC,OAAO;;UAEP,IAAI,CAAC,YAAY,EAAE,EAAE;YACrB,CAAC,CAAC,UAAU,CAAC,GAAG,CACZ,EAAE,CAAC,EAAE,CAAC,IAAI,CAAA;6BACK,IAAI,CAAC,SAAS;uBACpB,IAAI,CAAC,GAAG;2BACJ,EAAE;yBACJ,IAAI,CAAC,KAAK;6BACN,CAAC,GAAG,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC;gCAC9B,CACnB;YACH,CAAC,CAAC,OAAO;;;eAGJ,IAAI,CAAC,GAAG;qBACF,CAAC,IAAY,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;;mBAE1C,CAAC;IAClB,CAAC;;AAEM,uBAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;GAiBlB,CAAC;AAvIF;IADC,QAAQ,EAAE;2DACsB;AAGjC;IADC,KAAK,CAAC,eAAe,CAAC;sDACqB;AAG5C;IADC,KAAK,CAAC,eAAe,CAAC;qDACG;AAgC1B;IADC,KAAK,EAAE;kDAQP;AA/CU,gBAAgB;IAD5B,aAAa,CAAC,mBAAmB,CAAC;GACtB,gBAAgB,CA0I5B;SA1IY,gBAAgB","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  property,\n  PropertyValues,\n  query,\n  state,\n  TemplateResult,\n} from 'lit-element';\nimport { nothing } from 'lit-html';\nimport { get, translate } from 'lit-translate';\n\nimport { IconButtonToggle } from '@material/mwc-icon-button-toggle';\n\nimport { newEditEventV2 } from '@openscd/core';\nimport { createElement } from '@openscd/xml';\nimport { logicalDeviceIcon } from '@openscd/open-scd/src/icons/ied-icons.js';\nimport {\n  getDescriptionAttribute,\n  getInstanceAttribute,\n  getNameAttribute,\n  getLdNameAttribute,\n  newWizardEvent,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport { wizards } from '../../wizards/wizard-library.js';\nimport { Container } from './foundation.js';\nimport { lnInstGenerator } from '@openenergytools/scl-lib/dist/generator/lnInstGenerator.js';\nimport { AddLnDialog, LNData } from './add-ln-dialog.js';\n\nimport '@openscd/open-scd/src/action-pane.js';\nimport './ln-container.js';\nimport './add-ln-dialog.js';\n\n/** [[`IED`]] plugin subeditor for editing `LDevice` element. */\n@customElement('ldevice-container')\nexport class LDeviceContainer extends Container {\n  @property()\n  selectedLNClasses: string[] = [];\n\n  @query('#toggleButton')\n  toggleButton!: IconButtonToggle | undefined;\n\n  @query('add-ln-dialog')\n  addLnDialog!: AddLnDialog;\n\n  private openEditWizard(): void {\n    const wizard = wizards['LDevice'].edit(this.element);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  private header(): TemplateResult {\n    const nameOrInst =\n      getNameAttribute(this.element) ?? getInstanceAttribute(this.element);\n    const desc = getDescriptionAttribute(this.element);\n    const ldName = getLdNameAttribute(this.element);\n\n    return html`${nameOrInst}${desc ? html` &mdash; ${desc}` : nothing}${ldName\n      ? html` &mdash; ${ldName}`\n      : nothing}`;\n  }\n\n  protected firstUpdated(): void {\n    this.requestUpdate();\n  }\n\n  protected updated(_changedProperties: PropertyValues): void {\n    super.updated(_changedProperties);\n\n    // When the LN Classes filter is updated, we also want to trigger rendering for the LN Elements.\n    if (_changedProperties.has('selectedLNClasses')) {\n      this.requestUpdate('lnElements');\n    }\n  }\n\n  @state()\n  private get lnElements(): Element[] {\n    return Array.from(this.element.querySelectorAll(':scope > LN,LN0')).filter(\n      element => {\n        const lnClass = element.getAttribute('lnClass') ?? '';\n        return this.selectedLNClasses.includes(lnClass);\n      }\n    );\n  }\n\n  private handleAddLN(data: LNData) {\n    const getInst = lnInstGenerator(this.element, 'LN');\n    const inserts = [];\n\n    for (let i = 0; i < data.amount; i++) {\n      const inst = getInst(data.lnClass);\n      if (!inst) break;\n      const lnAttrs = {\n        lnClass: data.lnClass,\n        lnType: data.lnType,\n        inst: inst,\n        ...(data.prefix ? { prefix: data.prefix } : {}),\n      };\n      const ln = createElement(this.doc, 'LN', lnAttrs);\n      inserts.push({ parent: this.element, node: ln, reference: null });\n    }\n\n    this.dispatchEvent(newEditEventV2(inserts));\n  }\n\n  render(): TemplateResult {\n    const lnElements = this.lnElements;\n\n    return html`<action-pane .label=\"${this.header()}\">\n      <mwc-icon slot=\"icon\">${logicalDeviceIcon}</mwc-icon>\n      <abbr slot=\"action\" title=\"${get('edit')}\">\n        <mwc-icon-button\n          icon=\"edit\"\n          @click=${() => this.openEditWizard()}\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=${translate('iededitor.addLnDialog.title')}>\n        <mwc-icon-button\n          icon=\"playlist_add\"\n          @click=${() => this.addLnDialog.show()}\n        ></mwc-icon-button>\n      </abbr>\n      ${lnElements.length > 0\n        ? html`<abbr\n            slot=\"action\"\n            title=\"${get('iededitor.toggleChildElements')}\"\n          >\n            <mwc-icon-button-toggle\n              on\n              id=\"toggleButton\"\n              onIcon=\"keyboard_arrow_up\"\n              offIcon=\"keyboard_arrow_down\"\n              @click=${() => this.requestUpdate()}\n            ></mwc-icon-button-toggle>\n          </abbr>`\n        : nothing}\n      <div id=\"lnContainer\">\n        ${this.toggleButton?.on\n          ? lnElements.map(\n              ln => html`<ln-container\n                .editCount=${this.editCount}\n                .doc=${this.doc}\n                .element=${ln}\n                .nsdoc=${this.nsdoc}\n                .ancestors=${[...this.ancestors, this.element]}\n              ></ln-container> `\n            )\n          : nothing}\n      </div>\n      <add-ln-dialog\n        .doc=${this.doc}\n        .onConfirm=${(data: LNData) => this.handleAddLN(data)}\n      ></add-ln-dialog>\n    </action-pane>`;\n  }\n\n  static styles = css`\n    #lnContainer {\n      display: grid;\n      grid-gap: 12px;\n      box-sizing: border-box;\n      grid-template-columns: repeat(auto-fit, minmax(316px, auto));\n    }\n\n    abbr {\n      text-decoration: none;\n    }\n\n    @media (max-width: 387px) {\n      #lnContainer {\n        grid-template-columns: repeat(auto-fit, minmax(196px, auto));\n      }\n    }\n  `;\n}\n"]}