{"version":3,"file":"conducting-equipment-editor.js","sourceRoot":"","sources":["../../../src/editors/substation/conducting-equipment-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  query,\n  TemplateResult,\n} from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport '@material/mwc-fab';\nimport '@material/mwc-icon';\nimport '@material/mwc-icon-button';\nimport '@material/mwc-menu';\nimport { Menu } from '@material/mwc-menu';\nimport { IconButton } from '@material/mwc-icon-button';\nimport { ListItem } from '@material/mwc-list/mwc-list-item';\n\nimport '@openscd/open-scd/src/action-icon.js';\nimport '@openscd/open-scd/src/action-pane.js';\nimport './eq-function-editor.js';\nimport './l-node-editor.js';\nimport './sub-equipment-editor.js';\nimport { startMove, getIcon, styles } from './foundation.js';\nimport {\n  newWizardEvent,\n  SCLTag,\n  tags,\n} from '@openscd/open-scd/src/foundation.js';\n\nimport {\n  getChildElementsByTagName,\n} from '@openscd/xml';\n\nimport { newActionEvent } from '@openscd/core/foundation/deprecated/editor.js';\nimport { BayEditor } from './bay-editor.js';\nimport { emptyWizard, wizards } from '../../wizards/wizard-library.js';\n\nfunction childTags(element: Element | null | undefined): SCLTag[] {\n  if (!element) return [];\n\n  return tags[<SCLTag>element.tagName].children.filter(\n    child => wizards[child].create !== emptyWizard\n  );\n}\n\n/** [[`SubstationEditor`]] subeditor for a `ConductingEquipment` element. */\n@customElement('conducting-equipment-editor')\nexport class ConductingEquipmentEditor extends LitElement {\n  /** The document being edited as provided to editor by [[`Zeroline`]]. */\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  @property({ type: Number })\n  editCount = -1;\n  /** SCL element ConductingEquipment */\n  @property({ attribute: false })\n  element!: Element;\n  /** ConductingEquipment name attribute */\n  @property({ type: String })\n  get name(): string {\n    return this.element.getAttribute('name') ?? '';\n  }\n  /** Whether `EqFunction`, `SubEqFunction` and `SubEquipment` are rendered */\n  @property({ type: Boolean })\n  showfunctions = false;\n\n  @query('mwc-menu') addMenu!: Menu;\n  @query('mwc-icon-button[icon=\"playlist_add\"]') addButton!: IconButton;\n\n  private openEditWizard(): void {\n    const wizard = wizards['ConductingEquipment'].edit(this.element);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  private openLNodeWizard(): void {\n    const wizard = wizards['LNode'].create(this.element);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  private openCreateWizard(tagName: string): void {\n    const wizard = wizards[<SCLTag>tagName].create(this.element!);\n\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  remove(): void {\n    if (this.element)\n      this.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent: this.element.parentElement!,\n            element: this.element,\n            reference: this.element.nextSibling,\n          },\n        })\n      );\n  }\n\n  updated(): void {\n    if (this.addMenu && this.addButton)\n      this.addMenu.anchor = <HTMLElement>this.addButton;\n  }\n\n  private renderLNodes(): TemplateResult {\n    const lNodes = getChildElementsByTagName(this.element, 'LNode');\n\n    return lNodes.length\n      ? html`<div class=\"container lnode\">\n          ${lNodes.map(\n            lNode =>\n              html`<l-node-editor\n                .editCount=${this.editCount}\n                .doc=${this.doc}\n                .element=${lNode}\n              ></l-node-editor>`\n          )}\n        </div>`\n      : html``;\n  }\n\n  renderEqFunctions(): TemplateResult {\n    if (!this.showfunctions) return html``;\n\n    const eqFunctions = getChildElementsByTagName(this.element, 'EqFunction');\n    return html` ${eqFunctions.map(\n      eqFunction =>\n        html`<eq-function-editor\n          .editCount=${this.editCount}\n          .doc=${this.doc}\n          .element=${eqFunction}\n          ?showfunctions=${this.showfunctions}\n        ></eq-function-editor>`\n    )}`;\n  }\n\n  private renderSubEquipments(): TemplateResult {\n    if (!this.showfunctions) return html``;\n\n    const subEquipments = getChildElementsByTagName(\n      this.element,\n      'SubEquipment'\n    );\n\n    return html` ${subEquipments.map(\n      subEquipment =>\n        html`<sub-equipment-editor\n          .editCount=${this.editCount}\n          .doc=${this.doc}\n          .element=${subEquipment}\n        ></sub-equipment-editor>`\n    )}`;\n  }\n\n  private renderAddButtons(): TemplateResult[] {\n    return childTags(this.element).map(\n      child =>\n        html`<mwc-list-item value=\"${child}\"\n          ><span>${child}</span></mwc-list-item\n        >`\n    );\n  }\n\n  renderContentPane(): TemplateResult {\n    return html`<mwc-icon class=\"substation-editor-icon\" slot=\"icon\"\n        >${getIcon(this.element)}</mwc-icon\n      >\n      <abbr slot=\"action\" title=\"${get('lnode.tooltip')}\">\n        <mwc-icon-button\n          slot=\"action\"\n          mini\n          @click=\"${() => this.openLNodeWizard()}\"\n          icon=\"account_tree\"\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=\"${get('edit')}\">\n        <mwc-icon-button\n          slot=\"action\"\n          mini\n          icon=\"edit\"\n          @click=\"${() => this.openEditWizard()}}\"\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=\"${get('move')}\">\n        <mwc-icon-button\n          slot=\"action\"\n          mini\n          @click=\"${() =>\n            startMove(this, ConductingEquipmentEditor, [BayEditor])}\"\n          icon=\"forward\"\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=\"${get('remove')}\">\n        <mwc-icon-button\n          slot=\"action\"\n          mini\n          icon=\"delete\"\n          @click=\"${() => this.remove()}}\"\n        ></mwc-icon-button> </abbr\n      ><abbr slot=\"action\" style=\"position:relative;\" title=\"${get('add')}\">\n        <mwc-icon-button\n          icon=\"playlist_add\"\n          @click=${() => (this.addMenu.open = true)}\n        ></mwc-icon-button\n        ><mwc-menu\n          corner=\"BOTTOM_RIGHT\"\n          menuCorner=\"END\"\n          @action=${(e: Event) => {\n            const tagName = (<ListItem>(<Menu>e.target).selected).value;\n            this.openCreateWizard(tagName);\n          }}\n          >${this.renderAddButtons()}</mwc-menu\n        >\n      </abbr>`;\n  }\n\n  renderContentIcon(): TemplateResult {\n    return html`<mwc-icon slot=\"icon\">${getIcon(this.element)}</mwc-icon>\n      <mwc-fab\n        slot=\"action\"\n        mini\n        @click=\"${() => this.openLNodeWizard()}\"\n        icon=\"account_tree\"\n      ></mwc-fab>\n      <mwc-fab\n        slot=\"action\"\n        mini\n        icon=\"edit\"\n        @click=\"${() => this.openEditWizard()}}\"\n      ></mwc-fab>\n      <mwc-fab\n        slot=\"action\"\n        mini\n        @click=\"${() =>\n          startMove(this, ConductingEquipmentEditor, [BayEditor])}\"\n        icon=\"forward\"\n      ></mwc-fab>\n      <mwc-fab\n        slot=\"action\"\n        mini\n        icon=\"delete\"\n        @click=\"${() => this.remove()}}\"\n      ></mwc-fab>`;\n  }\n\n  render(): TemplateResult {\n    if (this.showfunctions)\n      return html`<action-pane label=\"${this.name}\"\n        >${this.renderContentPane()}${this.renderLNodes()}${this.renderEqFunctions()}${this.renderSubEquipments()}</action-pane\n        ></action-pane\n      >`;\n\n    return html`<action-icon label=\"${this.name}\"\n      >${this.renderContentIcon()}</action-icon\n    >`;\n  }\n\n  static styles = css`\n    ${styles}\n\n    :host(.moving) {\n      opacity: 0.3;\n    }\n\n    abbr {\n      text-decoration: none;\n      border-bottom: none;\n    }\n  `;\n}\n"]}