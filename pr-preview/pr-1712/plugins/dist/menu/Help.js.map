{"version":3,"file":"Help.js","sourceRoot":"","sources":["../../src/menu/Help.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,MAAM,aAAa,CAAC;AAC/C,OAAO,EAAE,UAAU,EAAE,MAAM,iCAAiC,CAAC;AAC7D,OAAO,KAAK,MAAM,MAAM,QAAQ,CAAC;AAEjC,OAAO,oBAAoB,CAAC;AAE5B,OAAO,sCAAsC,CAAC;AAC9C,OAAO,EAAE,cAAc,EAAU,MAAM,qCAAqC,CAAC;AAC7E,OAAO,EAAE,WAAW,EAAE,MAAM,sCAAsC,CAAC;AAGnE,MAAM,wBAAwB,GAAG,0DAA0D,CAAC;AAC5F,MAAM,qBAAqB,GAAE,WAAW,CAAC;AACzC,MAAM,cAAc,GAAG,IAAI,CAAC;AAE5B,SAAS,QAAQ,CAAC,OAAe;IAC/B,OAAO,IAAI,CAAA;;;aAGA,WAAW;;;;aAIX,OAAO;;;;;;;;;;;;;;;;WAgBT,CAAC;AACZ,CAAC;AAED,KAAK,UAAU,cAAc,CAAC,IAAc;IAC1C,MAAM,OAAO,GAAG,MAAM,CAAC,MAAM,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;IAC7D,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;QACrB,OAAO,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,OAAO,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC;KACvE;IAED,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;IACtD,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,sBAAsB,IAAI,KAAK,CAAC,CAAC;IACzD,MAAM,EAAE,GAAG,MAAM,GAAG,CAAC,IAAI,EAAE,CAAC;IAC5B,MAAM,mBAAmB,GAAG,sIAAsI,CAAA;IAClK,MAAM,UAAU,GAAG,EAAE,CAAC,OAAO,CAC3B,IAAI,MAAM,CAAC,MAAM,qBAAqB,SAAS,wBAAwB,CAAC,MAAM,KAAK,EAAE,GAAG,CAAC,EACzF,mBAAmB,CACpB,CAAC;IAEF,MAAM,MAAM,GAAG,IAAI,CAAA;MACf,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,CAAA,EAAE;MACpD,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;SACjC,CAAC;IACR,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CACxB,EAAE,CAAC,QAAQ,CAAE,IAAI,MAAM,CAAC,MAAM,wBAAwB,CAAC,MAAM,KAAK,EAAE,GAAG,CAAC,CAAC,CAE1E,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,cAAc,EAAE,GAAG,CAAC,CAAC,CAAC;IAE1D,OAAO,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC;AACnC,CAAC;AAED,MAAM,UAAU,cAAc;IAC5B,OAAO;QACL;YACE,KAAK,EAAE,MAAM;YACb,OAAO,EAAE;gBACP,IAAI,CAAA;kBACM,CAAC,MAAM,CAAC;kBACR,cAAc;wBACR;aACjB;SACF;KACF,CAAC;AACJ,CAAC;AAED,MAAM,CAAC,OAAO,OAAO,UAAW,SAAQ,UAAU;IAChD,KAAK,CAAC,GAAG;QACP,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;IACvD,CAAC;CACF","sourcesContent":["import { html, LitElement } from 'lit-element';\nimport { unsafeHTML } from 'lit-html/directives/unsafe-html';\nimport * as marked from 'marked';\n\nimport '@material/mwc-icon';\n\nimport '@openscd/open-scd/src/finder-list.js';\nimport { newWizardEvent, Wizard } from '@openscd/open-scd/src/foundation.js';\nimport { openSCDIcon } from '@openscd/open-scd/src/icons/icons.js';\nimport { Directory } from '@openscd/open-scd/src/finder-list.js';\n\nconst GITHUB_WIKI_LINK_PATTERN = /https:\\/\\/github\\.com\\/openscd\\/open-scd\\/wiki\\/([^)]*)/g;\nconst MD_LINK_TITLE_PATTERN ='([^\\\\]]*)';\nconst HYPHEN_PATTERN = /-/g;\n\nfunction aboutBox(version: string) {\n  return html`<div>\n      <div style=\"display:flex\">\n        <mwc-icon slot=\"graphic\" style=\"--mdc-icon-size:25px\"\n          >${openSCDIcon}</mwc-icon\n        >\n        <div style=\"padding:10px\">\n          <h2 style=\"margin-bottom:2px\">OpenSCD</h2>\n          V${version}\n        </div>\n      </div>\n    </div>\n    <div>\n      <h3>Licences</h3>\n      <p style=\"padding-bottom:5px\">\n        The IEC&thinsp;61850 XSD and NSD code components used are distributed\n        under their\n        <a href=\"/CC-EULA.pdf\">end user licence agreement</a>. <br />This\n        project's source code is licensed under the\n        <a href=\"/LICENSE.md\">Apache&thinsp;2.0 license</a> and available on\n        <a href=\"https://github.com/openscd\">GitHub</a>.\n      </p>\n      <p>&copy; 2020-2021 OMICRON electronics GmbH</p>\n      <h3>Help</h3>\n    </div>`;\n}\n\nasync function getLinkedPages(path: string[]): Promise<Directory> {\n  const edition = await (await fetch('/manifest.json')).json();\n  if (path.length === 0) {\n    return { path, header: aboutBox(edition.version), entries: ['Home'] };\n  }\n\n  const page = path[path.length - 1].replace(/ /g, '-');\n  const res = await fetch(`/openscd/public/md/${page}.md`);\n  const md = await res.text();\n  const MD_LINK_REPLACEMENT = `<a style=\"cursor: help; color: var(--mdc-theme-primary)\"  href=\"https://github.com/openscd/open-scd/wiki/$2\" target=\"_blank\" >$1</a>`\n  const unlinkedMd = md.replace(\n    new RegExp(`\\\\[${MD_LINK_TITLE_PATTERN}\\\\]\\\\(${GITHUB_WIKI_LINK_PATTERN.source}\\\\)`, 'g'),\n    MD_LINK_REPLACEMENT\n  );\n\n  const header = html`<div style=\"padding: 8px;\">\n    ${page === 'Home' ? aboutBox(edition.version) : html``}\n    ${unsafeHTML(marked.parse(unlinkedMd))}\n  </div>`;\n  const entries = Array.from(\n    md.matchAll( new RegExp(`\\\\(${GITHUB_WIKI_LINK_PATTERN.source}\\\\)`, 'g'))\n\n  ).map(([_, child]) => child.replace(HYPHEN_PATTERN, ' '));\n\n  return { path, header, entries };\n}\n\nexport function aboutBoxWizard(): Wizard {\n  return [\n    {\n      title: 'Help',\n      content: [\n        html`<finder-list\n          .path=${['Home']}\n          .read=${getLinkedPages}\n        ></finder-list>`,\n      ],\n    },\n  ];\n}\n\nexport default class HelpPlugin extends LitElement {\n  async run(): Promise<void> {\n    this.dispatchEvent(newWizardEvent(aboutBoxWizard()));\n  }\n}\n"]}